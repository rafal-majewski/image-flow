var bn=Object.defineProperty;var Ne=a=>{throw TypeError(a)};var _n=(a,t,e)=>t in a?bn(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var v=(a,t,e)=>_n(a,typeof t!="symbol"?t+"":t,e),xn=(a,t,e)=>t.has(a)||Ne("Cannot "+e);var Et=(a,t,e)=>(xn(a,t,"read from private field"),e?e.call(a):t.get(a)),Dt=(a,t,e)=>t.has(a)?Ne("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);import{t as M,a as E,n as Cn,c as de,d as qe}from"../chunks/7jJxD1YU.js";import"../chunks/v4DbhfZw.js";import{b as En,h as lt,o as Rn,z as h,a8 as Mn,j as Sn,r as Be,s as re,k as oe,c as Ft,X as yn,m as Qe,a as Ze,p as kn,an as se,$ as je,N as Pe,ao as De,ad as An,ap as Fe,aq as ce,ar as On,_ as Nn,as as qn,d as Bn,at as he,au as Pn,V as Dn,Q as Fn,T as Ln,a1 as zn,av as $e,v as Un,aw as Tn,ax as Gn,ay as Wn,az as Yn,aA as Xn,aB as Kn,C as rt,I as d,J as u,D as m,F as Y,G as ot,am as Le,ak as St,ac as O,f as dt,u as Hn,aC as j,ab as Vn}from"../chunks/B2bjRoan.js";import{d as gt,s as tn,e as Jn}from"../chunks/Sbfvohkh.js";import{i as Q,b as en,c as nn}from"../chunks/BzIaRVEm.js";import{s as Qn}from"../chunks/B8KPF8bS.js";import{o as Zn}from"../chunks/91qYvWjJ.js";let ze=!1;function jn(){ze||(ze=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var t;if(!a.defaultPrevented)for(const e of a.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function Ot(a,t){return t}function $n(a,t,e,n){for(var r=[],o=t.length,s=0;s<o;s++)On(t[s].e,r,!0);var i=o>0&&r.length===0&&e!==null;if(i){var l=e.parentNode;Nn(l),l.append(e),n.clear(),Mt(a,t[0].prev,t[o-1].next)}qn(r,()=>{for(var I=0;I<o;I++){var c=t[I];i||(n.delete(c.k),Mt(a,c.prev,c.next)),Bn(c.e,!i)}})}function It(a,t,e,n,r,o=null){var s=a,i={flags:t,items:new Map,first:null},l=(t&$e)!==0;if(l){var I=a;s=lt?re(Ln(I)):I.appendChild(zn())}lt&&Rn();var c=null,_=!1,p=Mn(()=>{var w=e();return Fn(w)?w:w==null?[]:je(w)});En(()=>{var w=h(p),g=w.length;if(_&&g===0)return;_=g===0;let x=!1;if(lt){var k=s.data===Sn;k!==(g===0)&&(s=Be(),re(s),oe(!1),x=!0)}if(lt){for(var y=null,D,N=0;N<g;N++){if(Ft.nodeType===8&&Ft.data===yn){s=Ft,x=!0,oe(!1);break}var b=w[N],f=n(b,N);D=an(Ft,i,y,null,b,f,N,r,t,e),i.items.set(f,D),y=D}g>0&&re(Be())}lt||ta(w,i,s,r,t,n,e),o!==null&&(g===0?c?Qe(c):c=Ze(()=>o(s)):c!==null&&kn(c,()=>{c=null})),x&&oe(!0),h(p)}),lt&&(s=Ft)}function ta(a,t,e,n,r,o,s){var ft,C,P,$;var i=(r&Tn)!==0,l=(r&(he|ce))!==0,I=a.length,c=t.items,_=t.first,p=_,w,g=null,x,k=[],y=[],D,N,b,f;if(i)for(f=0;f<I;f+=1)D=a[f],N=o(D,f),b=c.get(N),b!==void 0&&((ft=b.a)==null||ft.measure(),(x??(x=new Set)).add(b));for(f=0;f<I;f+=1){if(D=a[f],N=o(D,f),b=c.get(N),b===void 0){var F=p?p.e.nodes_start:e;g=an(F,t,g,g===null?t.first:g.next,D,N,f,n,r,s),c.set(N,g),k=[],y=[],p=g.next;continue}if(l&&ea(b,D,f,r),(b.e.f&se)!==0&&(Qe(b.e),i&&((C=b.a)==null||C.unfix(),(x??(x=new Set)).delete(b))),b!==p){if(w!==void 0&&w.has(b)){if(k.length<y.length){var T=y[0],q;g=T.prev;var it=k[0],Z=k[k.length-1];for(q=0;q<k.length;q+=1)Ue(k[q],T,e);for(q=0;q<y.length;q+=1)w.delete(y[q]);Mt(t,it.prev,Z.next),Mt(t,g,it),Mt(t,Z,T),p=T,g=Z,f-=1,k=[],y=[]}else w.delete(b),Ue(b,p,e),Mt(t,b.prev,b.next),Mt(t,b,g===null?t.first:g.next),Mt(t,g,b),g=b;continue}for(k=[],y=[];p!==null&&p.k!==N;)(p.e.f&se)===0&&(w??(w=new Set)).add(p),y.push(p),p=p.next;if(p===null)continue;b=p}k.push(b),g=b,p=b.next}if(p!==null||w!==void 0){for(var B=w===void 0?[]:je(w);p!==null;)(p.e.f&se)===0&&B.push(p),p=p.next;var V=B.length;if(V>0){var ut=(r&$e)!==0&&I===0?e:null;if(i){for(f=0;f<V;f+=1)(P=B[f].a)==null||P.measure();for(f=0;f<V;f+=1)($=B[f].a)==null||$.fix()}$n(t,B,ut,c)}}i&&Un(()=>{var vt;if(x!==void 0)for(b of x)(vt=b.a)==null||vt.apply()}),Pe.first=t.first&&t.first.e,Pe.last=g&&g.e}function ea(a,t,e,n){(n&he)!==0&&De(a.v,t),(n&ce)!==0?De(a.i,e):a.i=e}function an(a,t,e,n,r,o,s,i,l,I){var c=(l&he)!==0,_=(l&Pn)===0,p=c?_?An(r):Fe(r):r,w=(l&ce)===0?s:Fe(s),g={i:w,v:p,k:o,a:null,e:null,prev:e,next:n};try{return g.e=Ze(()=>i(a,p,w,I),lt),g.e.prev=e&&e.e,g.e.next=n&&n.e,e===null?t.first=g:(e.next=g,e.e.next=g.e),n!==null&&(n.prev=g,n.e.prev=g.e),g}finally{}}function Ue(a,t,e){for(var n=a.next?a.next.e.nodes_start:e,r=t?t.e.nodes_start:e,o=a.e.nodes_start;o!==n;){var s=Dn(o);r.before(o),o=s}}function Mt(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const Te=[...` 	
\r\f¬†\v\uFEFF`];function na(a,t,e){var n=""+a;if(e){for(var r in e)if(e[r])n=n?n+" "+r:r;else if(n.length)for(var o=r.length,s=0;(s=n.indexOf(r,s))>=0;){var i=s+o;(s===0||Te.includes(n[s-1]))&&(i===n.length||Te.includes(n[i]))?n=(s===0?"":n.substring(0,s))+n.substring(i+1):s=i}}return n===""?null:n}function Ge(a,t=!1){var e=t?" !important;":";",n="";for(var r in a){var o=a[r];o!=null&&o!==""&&(n+=" "+r+": "+o+e)}return n}function aa(a,t){if(t){var e="",n,r;return Array.isArray(t)?(n=t[0],r=t[1]):n=t,n&&(e+=Ge(n)),r&&(e+=Ge(r,!0)),e=e.trim(),e===""?null:e}return String(a)}function ra(a,t,e,n,r,o){var s=a.__className;if(lt||s!==e){var i=na(e,n,o);(!lt||i!==a.getAttribute("class"))&&(i==null?a.removeAttribute("class"):a.className=i),a.__className=e}else if(o&&r!==o)for(var l in o){var I=!!o[l];(r==null||I!==!!r[l])&&a.classList.toggle(l,I)}return o}function ie(a,t={},e,n){for(var r in e){var o=e[r];t[r]!==o&&(e[r]==null?a.style.removeProperty(r):a.style.setProperty(r,o,n))}}function kt(a,t,e,n){var r=a.__style;if(lt||r!==t){var o=aa(t,n);(!lt||o!==a.getAttribute("style"))&&(o==null?a.removeAttribute("style"):a.style.cssText=o),a.__style=t}else n&&(Array.isArray(n)?(ie(a,e==null?void 0:e[0],n[0]),ie(a,e==null?void 0:e[1],n[1],"important")):ie(a,e,n));return n}const oa=Symbol("is custom element"),sa=Symbol("is html");function H(a){if(lt){var t=!1,e=()=>{if(!t){if(t=!0,a.hasAttribute("value")){var n=a.value;J(a,"value",null),a.value=n}if(a.hasAttribute("checked")){var r=a.checked;J(a,"checked",null),a.checked=r}}};a.__on_r=e,Gn(e),jn()}}function _t(a,t){var e=ge(a);e.value===(e.value=t??void 0)||a.value===t&&(t!==0||a.nodeName!=="PROGRESS")||(a.value=t??"")}function yt(a,t){var e=ge(a);e.checked!==(e.checked=t??void 0)&&(a.checked=t)}function We(a,t){t?a.hasAttribute("selected")||a.setAttribute("selected",""):a.removeAttribute("selected")}function J(a,t,e,n){var r=ge(a);lt&&(r[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||r[t]!==(r[t]=e)&&(t==="loading"&&(a[Yn]=e),e==null?a.removeAttribute(t):typeof e!="string"&&ia(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function ge(a){return a.__attributes??(a.__attributes={[oa]:a.nodeName.includes("-"),[sa]:a.namespaceURI===Wn})}var Ye=new Map;function ia(a){var t=Ye.get(a.nodeName);if(t)return t;Ye.set(a.nodeName,t=[]);for(var e,n=a,r=Element.prototype;r!==n;){e=Kn(n);for(var o in e)e[o].set&&t.push(o);n=Xn(n)}return t}function ua(a,t){t.onAddGeneratorOperatableNodeRequest()}function la(a,t){t.onAddMapperOperatableNodeRequest()}function da(a,t){t.onAddFromFileLoaderNodeRequest()}function ca(a,t){t.onAddFromUrlLoaderNodeRequest()}function ha(a,t){t.onAddCombinerOperatableNodeRequest()}var ga=M('<dialog open class="svelte-1ui4dgg"><menu><li><button>Add a from file loader</button></li> <li><button>Add a from URL loader</button></li> <li><ul><li><button>Add a generator operatable</button></li> <li><button>Add a mapper operatable</button></li> <li><button>Add a combiner operatable</button></li></ul></li></menu></dialog>');function va(a,t){rt(t,!0);var e=ga();let n;var r=d(e),o=d(r),s=d(o);s.__click=[da,t],u(o);var i=m(o,2),l=d(i);l.__click=[ca,t],u(i);var I=m(i,2),c=d(I),_=d(c),p=d(_);p.__click=[ua,t],u(_);var w=m(_,2),g=d(w);g.__click=[la,t],u(w);var x=m(w,2),k=d(x);k.__click=[ha,t],u(x),u(c),u(I),u(r),u(e),Y(()=>n=kt(e,"",n,{top:`calc(${t.position.y??""}px + 50%)`,left:`calc(${t.position.x??""}px + 50%)`})),E(a,e),ot()}gt(["click"]);var pa=Cn('<svg xmlns="http://www.w3.org/2000/svg" class="svelte-vva1zu"><line stroke="black" stroke-width="2"></line></svg>');function ue(a,t){rt(t,!0);const e=Le(()=>((t.sourcePosition.x-t.targetPosition.x)**2+(t.sourcePosition.y-t.targetPosition.y)**2)**.5),n=Le(()=>Math.atan2(t.targetPosition.y-t.sourcePosition.y,t.targetPosition.x-t.sourcePosition.x));var r=pa();J(r,"height",2);let o;var s=d(r);J(s,"x1",0),J(s,"y1",1),J(s,"y2",1),u(r),Y(()=>{J(r,"viewBox",`0 0 ${h(e)??""} 2`),J(r,"width",h(e)),o=kt(r,"",o,{rotate:`${h(n)??""}rad`,top:`${t.sourcePosition.y??""}px`,left:`${t.sourcePosition.x??""}px`}),J(s,"x2",h(e))}),E(a,r),ot()}class rn{constructor(t){v(this,"name");this.name=t}}const ma="movingCamera";class fa extends rn{constructor(){super(ma)}}const Ia=new fa;function wa(a,t,e){return{x:a.x-t.x-t.width/2+e.x,y:a.y-t.y-t.height/2+e.y}}function ba(a,t){t.edge.delete()}var _a=M('<div><!> <button class="svelte-x0wqt4">üóëÔ∏è</button></div>');function xa(a,t){rt(t,!0);var e=_a(),n=d(e);ue(n,{get sourcePosition(){return t.edge.input.position},get targetPosition(){return t.edge.output.position}});var r=m(n,2);r.__click=[ba,t];let o;u(e),Y(()=>o=kt(r,"",o,{top:`${(t.edge.input.position.y+t.edge.output.position.y)/2}px`,left:`${(t.edge.input.position.x+t.edge.output.position.x)/2}px`})),E(a,e),ot()}gt(["click"]);class Qt extends rn{constructor(e,n){super(n);v(this,"data");this.data=e}}const Ca="movingNode";class Ea extends Qt{constructor(t){super({node:t},Ca)}}const Ra="addingNode";class Ma extends Qt{constructor(t){super({position:t},Ra)}}const Sa="settingEdgeInput";class on extends Qt{constructor(t,e,n){super({index:t,mouseCursorInBoardPosition:e,output:n},Sa)}}const ya="settingEdgeOutput";class sn extends Qt{constructor(t,e){super({input:t,mouseCursorInBoardPosition:e},ya)}}function ka(){return Math.random().toString(36).substring(2,15)}class Xe{constructor(t,e,n,r,o){v(this,"id");v(this,"image");v(this,"index");v(this,"input");v(this,"output");this.id=t,this.image=e,this.index=n,this.input=r,this.output=o}delete(){this.input.deleteOutputEdge(this),this.output.unsetInputEdge(this.index),this.output.invalidateInputImages()}deleteLeft(){this.input.deleteOutputEdge(this)}setImage(t){this.image=t,this.output.validateInputEdges()}unsetImage(){this.image=null,this.output.invalidateInputImages()}}var Lt,zt,Ut;class Aa{constructor(t,e,n,r){v(this,"displayer");v(this,"id");Dt(this,Lt,St());v(this,"name");Dt(this,zt,St());Dt(this,Ut,St());this.displayer=(...o)=>(o[1].node=this,t(...o)),this.id=ka(),this.inputEdges=new Array(e).fill(null),this.name=n,this.outputEdges=[],this.position=r}get inputEdges(){return h(Et(this,Lt))}set inputEdges(t){O(Et(this,Lt),t)}get outputEdges(){return h(Et(this,zt))}set outputEdges(t){O(Et(this,zt),t)}deleteOutputEdge(t){this.outputEdges=this.outputEdges.filter(e=>e!==t)}get position(){return h(Et(this,Ut))}set position(t){O(Et(this,Ut),t)}clearInputEdgeLeft(t){this.inputEdges[t]!==void 0&&this.inputEdges[t]!==null&&this.inputEdges[t].deleteLeft()}setInputEdge(t,e){this.inputEdges=this.inputEdges.with(t,e)}unsetInputEdge(t){this.inputEdges=this.inputEdges.with(t,null)}validateInputEdges(){if(this.inputEdges.every(t=>t!==null)){const t=this.inputEdges.map(e=>e.image);t.every(e=>e!==null)&&this.validateInputImages(t)}}addOutputEdge(t){this.outputEdges=[...this.outputEdges,t]}handleEdgeBuilder(t){this.useEdgeBuilder(t.handleInput(this))}delete(){for(const t of this.outputEdges)t.delete();for(const t of this.inputEdges)t!==null&&t.delete()}}Lt=new WeakMap,zt=new WeakMap,Ut=new WeakMap;var Tt;class ve extends Aa{constructor(e,n,r,o,s){super(e,n,r,o);Dt(this,Tt,St());this.state=s}get state(){return h(Et(this,Tt))}set state(e){O(Et(this,Tt),e)}useEdgeBuilder(e){this.state.useEdgeBuilder(e)}}Tt=new WeakMap;class pe{constructor(t){v(this,"status");this.status=t}}function Oa(a,t){t.node.delete(),t.onDeleteRequest(t.node)}function Na(a,t){a.button===0&&t.onMouseLeftButtonDown(t.node,{x:a.clientX,y:a.clientY})}function qa(a,t){a.button===0&&t.onMouseLeftButtonUp(t.node)}function Ba(a,t){t.onSetOutputRequest(t.node,{x:a.clientX,y:a.clientY})}var Pa=M("<li><button>üîå</button> <!></li>"),Da=M('<section role="none"><div class="svelte-1vplcxm"><header> </header> <button>üóëÔ∏è</button></div> <ol></ol> <!> <div class="svelte-1vplcxm"><button>üîå</button></div></section>');function me(a,t){rt(t,!0);function e(g,x){t.onSetInputRequest(g,t.node,x)}var n=Da();n.__mousedown=[Na,t],n.__mouseup=[qa,t];let r,o;var s=d(n),i=d(s),l=d(i,!0);u(i);var I=m(i,2);I.__click=[Oa,t],u(s);var c=m(s,2);It(c,21,()=>t.node.inputEdges,Ot,(g,x,k)=>{var y=Pa(),D=d(y);D.__click=f=>{e(k,{x:f.clientX,y:f.clientY})};var N=m(D,2);{var b=f=>{var F=de(),T=dt(F);{var q=Z=>{var B=qe("‚åõ");E(Z,B)},it=Z=>{var B=qe("üñºÔ∏è");E(Z,B)};Q(T,Z=>{h(x).image===null?Z(q):Z(it,!1)})}E(f,F)};Q(N,f=>{h(x)!==null&&f(b)})}u(y),Y(()=>D.disabled=t.boardMode!==null&&t.boardMode.name==="settingEdgeInput"),E(g,y)}),u(c);var _=m(c,2);Qn(_,()=>t.children);var p=m(_,2),w=d(p);w.__click=[Ba,t],u(p),u(n),Y(g=>{r=ra(n,1,"svelte-1vplcxm",null,r,g),o=kt(n,"",o,{top:`${t.node.position.y??""}px`,left:`${t.node.position.x??""}px`}),tn(l,t.node.name),w.disabled=t.boardMode!==null&&t.boardMode.name==="settingEdgeOutput"},[()=>({started:t.node.state.status==="started",doned:t.node.state.status==="doned",unconfigured:t.node.state.status==="unconfigured"})]),E(a,n),ot()}gt(["mousedown","mouseup","click"]);function Fa(a,t,e){O(t,h(t)*e)}function La(a,t,e){O(t,h(t)/e)}function za(a,t){O(t,a.currentTarget.valueAsNumber,!0)}var Ua=M('<section><div><canvas class="svelte-qio82b"></canvas></div> <div><button>+</button> <button>-</button> <input type="number" min="0"></div></section>');function fe(a,t){rt(t,!0);let e;Zn(()=>{const g=e.getContext("2d");Hn(()=>{e.width=t.image.width,e.height=t.image.height,g.putImageData(t.image,0,0)})});let n=St(1);const r=1.1;var o=Ua(),s=d(o);let i;var l=d(s);let I;en(l,g=>e=g,()=>e),u(s);var c=m(s,2),_=d(c);_.__click=[Fa,n,r];var p=m(_,2);p.__click=[La,n,r];var w=m(p,2);H(w),w.__change=[za,n],u(c),u(o),Y((g,x)=>{i=kt(s,"",i,{width:`${g??""}px`,height:`${x??""}px`}),I=kt(l,"",I,{scale:h(n)}),_t(w,h(n))},[()=>Math.round(t.image.width*h(n)),()=>Math.round(t.image.height*h(n))]),E(a,o),ot()}gt(["click","change"]);class Ie extends pe{constructor(t){super(t)}}class Zt extends Ie{invalidateInputImages(t){return this}validateInputImages(t,e){return this}constructor(){super("started")}startLoading(t){return new Zt}doneLoading(t,e){for(const n of e)n.setImage(t);return new un(t)}useEdgeBuilder(t){t.buildWithoutImage()}}class un extends Ie{constructor(e){super("doned");v(this,"image");this.image=e}invalidateInputImages(e){return this}startLoading(e){for(const n of e)n.unsetImage();return new Zt}validateInputImages(e){return this}useEdgeBuilder(e){e.buildWithImage(this.image)}}function Ta(a,t){const e=a.currentTarget.files[0];t.node.setFile(e)}var Ga=M('<input type="file" accept="image/*"> <!>',1);function Wa(a,t){rt(t,!0),me(a,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetInputRequest(){return t.onSetInputRequest},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(e,n)=>{var r=Ga(),o=dt(r);o.__change=[Ta,t];var s=m(o,2);{var i=l=>{fe(l,{get image(){return t.node.state.image}})};Q(s,l=>{t.node.state instanceof un&&l(i)})}E(e,r)},$$slots:{default:!0}}),ot()}gt(["change"]);async function Ya(a){const t=new FileReader;await new Promise((s,i)=>{t.onload=s,t.onerror=i,t.readAsDataURL(a)});const e=new Image;e.src=t.result,await new Promise((s,i)=>{e.onload=s,e.onerror=i});const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)}class Xa extends Ie{constructor(){super("unconfigured")}invalidateInputImages(t){return this}startLoading(t){return new Zt}validateInputImages(t){return this}useEdgeBuilder(t){t.buildWithoutImage()}}class Ka extends ve{invalidateInputImages(){}validateInputImages(t){}constructor(t){super(Wa,0,"From file loader",t,new Xa)}async setFile(t){const e=this.state.startLoading(this.outputEdges);this.state=e;const n=await Ya(t);this.state===e&&(this.state=e.doneLoading(n,this.outputEdges))}}class st extends pe{constructor(t){super(t)}}class X extends st{constructor(e,n,r,o,s){super("started");v(this,"generator");v(this,"inputImages");v(this,"operator");v(this,"outputImage");v(this,"stepCount");this.generator=e,this.inputImages=n,this.operator=r,this.outputImage=o,this.stepCount=s}doAnimatedStep(e){const n=this.generator.next();if(n.done){for(const r of e)r.setImage(n.value);return new G(this.inputImages,this.operator,n.value,this.stepCount)}else return new X(this.generator,this.inputImages,this.operator,n.value,this.stepCount)}doManualSteps(e){return this}invalidateInputImages(e){return new et(this.operator,this.stepCount)}makeAnimated(e,n){return new K(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}useEdgeBuilder(e){e.buildWithoutImage()}makeInstant(e){let n=this.generator.next();for(;!n.done;)n=this.generator.next();for(const r of e)r.setImage(n.value);return new at(this.inputImages,this.operator,n.value)}makeManual(e){return this}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new G(this.inputImages,this.operator,r.value,this.stepCount)}else return new X(n,this.inputImages,this.operator,r.value,this.stepCount)}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new G(this.inputImages,e,o.value,this.stepCount)}else return new X(r,this.inputImages,e,o.value,this.stepCount)}setStepCount(e){return new X(this.generator,this.inputImages,this.operator,this.outputImage,e)}unsetOperator(e){return new ct(this.inputImages,this.stepCount)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new G(e,this.operator,o.value,this.stepCount)}else return new X(r,e,this.operator,o.value,this.stepCount)}}class et extends st{constructor(e,n){super("unconfigured");v(this,"operator");v(this,"stepCount");this.operator=e,this.stepCount=n}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new nt(e,n,this.operator)}makeInstant(e){return new wt(this.operator)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new et(e,this.stepCount)}setStepCount(e){return new et(this.operator,e)}unsetOperator(e){return new mt(this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new G(e,this.operator,o.value,this.stepCount)}else return new X(r,e,this.operator,o.value,this.stepCount)}}class G extends st{constructor(e,n,r,o){super("doned");v(this,"inputImages");v(this,"operator");v(this,"outputImage");v(this,"stepCount");this.inputImages=e,this.operator=n,this.outputImage=r,this.stepCount=o}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new et(this.operator,this.stepCount)}makeAnimated(e,n){return new W(this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e){return new at(this.inputImages,this.operator,this.outputImage)}makeManual(e){return this}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new G(this.inputImages,this.operator,r.value,this.stepCount)}else{for(const o of e)o.unsetImage();return new X(n,this.inputImages,this.operator,r.value,this.stepCount)}}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new G(this.inputImages,e,o.value,this.stepCount)}else{for(const s of n)s.unsetImage();return new X(r,this.inputImages,e,o.value,this.stepCount)}}setStepCount(e){return new G(this.inputImages,this.operator,this.outputImage,e)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}unsetOperator(e){for(const n of e)n.unsetImage();return new ct(this.inputImages,this.stepCount)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new G(e,this.operator,o.value,this.stepCount)}else{for(const s of n)s.unsetImage();return new X(r,e,this.operator,o.value,this.stepCount)}}}class ct extends st{constructor(e,n){super("unconfigured");v(this,"inputImages");v(this,"stepCount");this.inputImages=e,this.stepCount=n}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new mt(this.stepCount)}makeAnimated(e,n){return new ht(this.inputImages,e,n)}makeInstant(e){return new At(this.inputImages)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new G(this.inputImages,e,o.value,this.stepCount)}else return new X(r,this.inputImages,e,o.value,this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}setStepCount(e){return new ct(this.inputImages,e)}unsetOperator(e){return this}validateInputImages(e,n){return new ct(e,this.stepCount)}}class At extends st{constructor(e){super("unconfigured");v(this,"inputImages");this.inputImages=e}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new qt}makeAnimated(e,n){return new ht(this.inputImages,e,n)}makeInstant(e){return this}makeManual(e){return new ct(this.inputImages,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}useEdgeBuilder(e){e.buildWithoutImage()}setOperator(e,n){const r=e.operate(this.inputImages);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new at(this.inputImages,e,o.value)}setStepCount(e){return this}unsetOperator(e){return this}validateInputImages(e,n){return new At(e)}}class qt extends st{constructor(){super("unconfigured")}useEdgeBuilder(t){t.buildWithoutImage()}doAnimatedStep(t){return this}doManualSteps(t){return this}invalidateInputImages(t){return this}makeAnimated(t,e){return new bt(t,e)}makeInstant(t){return this}makeManual(t){return new mt(t)}resetOutputImage(t){return this}setIntervalInterval(t,e){return this}setOperator(t,e){return new wt(t)}setStepCount(t){return this}unsetOperator(t){return this}validateInputImages(t,e){return new At(t)}}class wt extends st{constructor(e){super("unconfigured");v(this,"operator");this.operator=e}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new nt(e,n,this.operator)}makeInstant(e){return this}makeManual(e){return new et(this.operator,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new wt(e)}setStepCount(e){return this}unsetOperator(e){return new qt}validateInputImages(e,n){const r=this.operator.operate(e);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new at(e,this.operator,o.value)}useEdgeBuilder(e){e.buildWithoutImage()}}class at extends st{constructor(e,n,r){super("doned");v(this,"inputImages");v(this,"operator");v(this,"outputImage");this.inputImages=e,this.operator=n,this.outputImage=r}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new wt(this.operator)}makeAnimated(e,n){return new W(this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e){return this}makeManual(e){return new G(this.inputImages,this.operator,this.outputImage,e)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}resetOutputImage(e){const n=this.operator.operate(this.inputImages);let r=n.next();for(;!r.done;)r=n.next();for(const o of e)o.setImage(r.value);return new at(this.inputImages,this.operator,r.value)}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new at(this.inputImages,e,o.value)}setStepCount(e){return this}unsetOperator(e){for(const n of e)n.unsetImage();return new At(this.inputImages)}validateInputImages(e,n){const r=this.operator.operate(e);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new at(e,this.operator,o.value)}}class K extends st{constructor(e,n,r,o,s,i){super("started");v(this,"generator");v(this,"inputImages");v(this,"intervalId");v(this,"intervalIntervalSeconds");v(this,"operator");v(this,"outputImage");this.generator=e,this.inputImages=n,this.intervalId=r,this.intervalIntervalSeconds=o,this.operator=s,this.outputImage=i}doAnimatedStep(e){const n=this.generator.next();if(n.done){for(const r of e)r.setImage(n.value);return new W(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,n.value)}else return new K(this.generator,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,n.value)}doManualSteps(e){return this}invalidateInputImages(e){return new nt(this.intervalId,this.intervalIntervalSeconds,this.operator)}makeAnimated(e,n){return this}useEdgeBuilder(e){e.buildWithoutImage()}makeInstant(e){let n=this.generator.next();for(;!n.done;)n=this.generator.next();for(const r of e)r.setImage(n.value);return new at(this.inputImages,this.operator,n.value)}makeManual(e){return new X(this.generator,this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new W(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}else return new K(n,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}setIntervalInterval(e,n){return clearInterval(this.intervalId),new K(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new W(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}else return new K(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}setStepCount(e){return this}unsetOperator(e){return new ht(this.inputImages,this.intervalId,this.intervalIntervalSeconds)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new W(e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}else return new K(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}}class ht extends st{constructor(e,n,r){super("unconfigured");v(this,"inputImages");v(this,"intervalId");v(this,"intervalIntervalSeconds");this.inputImages=e,this.intervalId=n,this.intervalIntervalSeconds=r}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new bt(this.intervalId,this.intervalIntervalSeconds)}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new At(this.inputImages)}makeManual(e){return clearInterval(this.intervalId),new ct(this.inputImages,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new ht(this.inputImages,e,n)}useEdgeBuilder(e){e.buildWithoutImage()}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new W(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}else return new K(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}setStepCount(e){return this}unsetOperator(e){return this}validateInputImages(e,n){return new ht(e,this.intervalId,this.intervalIntervalSeconds)}}class W extends st{constructor(e,n,r,o,s){super("doned");v(this,"inputImages");v(this,"intervalId");v(this,"intervalIntervalSeconds");v(this,"operator");v(this,"outputImage");this.inputImages=e,this.intervalId=n,this.intervalIntervalSeconds=r,this.operator=o,this.outputImage=s}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new nt(this.intervalId,this.intervalIntervalSeconds,this.operator)}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new at(this.inputImages,this.operator,this.outputImage)}makeManual(e){return clearInterval(this.intervalId),new G(this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new W(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}else{for(const o of e)o.unsetImage();return new K(n,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}}setIntervalInterval(e,n){return clearInterval(this.intervalId),new W(this.inputImages,e,n,this.operator,this.outputImage)}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new W(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}else{for(const s of n)s.unsetImage();return new K(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}}setStepCount(e){return this}unsetOperator(e){for(const n of e)n.unsetImage();return new ht(this.inputImages,this.intervalId,this.intervalIntervalSeconds)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new W(e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}else{for(const s of n)s.unsetImage();return new K(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}}}class nt extends st{constructor(e,n,r){super("unconfigured");v(this,"intervalId");v(this,"intervalIntervalSeconds");v(this,"operator");this.intervalId=e,this.intervalIntervalSeconds=n,this.operator=r}useEdgeBuilder(e){e.buildWithoutImage()}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new wt(this.operator)}makeManual(e){return new et(this.operator,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new nt(e,n,this.operator)}setOperator(e,n){return new nt(this.intervalId,this.intervalIntervalSeconds,e)}setStepCount(e){return this}unsetOperator(e){return new bt(this.intervalId,this.intervalIntervalSeconds)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new W(e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}else return new K(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}}class bt extends st{constructor(e,n){super("unconfigured");v(this,"intervalId");v(this,"intervalIntervalSeconds");this.intervalId=e,this.intervalIntervalSeconds=n}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new qt}makeManual(e){return new mt(e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new bt(e,n)}setOperator(e,n){return new nt(this.intervalId,this.intervalIntervalSeconds,e)}setStepCount(e){return this}unsetOperator(e){return this}validateInputImages(e,n){return new ht(e,this.intervalId,this.intervalIntervalSeconds)}useEdgeBuilder(e){e.buildWithoutImage()}}class mt extends st{constructor(e){super("unconfigured");v(this,"stepCount");this.stepCount=e}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new bt(e,n)}makeInstant(e){return new qt}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new et(e,this.stepCount)}setStepCount(e){return new mt(e)}unsetOperator(e){return this}validateInputImages(e,n){return new ct(e,this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}}function Ha(a,t){if(a.currentTarget.value==="none")t.onUnsetOperatorRequest();else{const e=t.operators.find(n=>n.id===a.currentTarget.value);t.onSetOperatorRequest(e)}}function Va(a,t){t.onDoManualStepsRequest()}function Ja(a,t){t.onSetStepCountRequest(Number.parseInt(a.currentTarget.value,10))}function Qa(a,t){t.onSetIntervalIntervalRequest(Number.parseFloat(a.currentTarget.value))}function Za(a,t){t.onResetOutputImageRequest()}var ja=M("<option> </option>"),$a=M('<label>Step count: <input type="number" min="1" step="1"></label> <button>Do steps</button>',1),tr=M('<label>Interval (seconds): <input type="number" min="0.0001" step="0.0001"></label>'),er=M("<div><!> <!> <button>Reset</button></div>"),nr=M('<section><select><option>No operator</option><!></select> <!> <!> <fieldset><legend>Mode</legend> <div><label><input type="radio" value="manual"> Manual</label> <label><input type="radio" value="animated"> Animated</label> <label><input type="radio" value="instant"> Instant</label></div> <!></fieldset></section>');function ar(a,t){rt(t,!0);var e=nr(),n=d(e);n.__change=[Ha,t];var r=d(n);r.value=(r.__value="none")==null?"":"none";var o=m(r);It(o,17,()=>t.operators,b=>b.id,(b,f)=>{var F=ja(),T={},q=d(F,!0);u(F),Y(()=>{T!==(T=h(f).id)&&(F.value=(F.__value=h(f).id)==null?"":h(f).id),We(F,(t.state instanceof K||t.state instanceof W||t.state instanceof nt||t.state instanceof at||t.state instanceof wt||t.state instanceof X||t.state instanceof G||t.state instanceof et)&&t.state.operator.id===h(f).id),tn(q,h(f).name)}),E(b,F)}),u(n);var s=m(n,2);{var i=b=>{var f=de(),F=dt(f);nn(F,()=>t.state.operator.displayer,(T,q)=>{q(T,{get onSetOperatorRequest(){return t.onSetOperatorRequest},get nodeId(){return t.nodeId}})}),E(b,f)};Q(s,b=>{(t.state instanceof K||t.state instanceof W||t.state instanceof nt||t.state instanceof nt||t.state instanceof at||t.state instanceof wt||t.state instanceof wt||t.state instanceof X||t.state instanceof G||t.state instanceof et||t.state instanceof et)&&b(i)})}var l=m(s,2);{var I=b=>{fe(b,{get image(){return t.state.outputImage}})};Q(l,b=>{(t.state instanceof K||t.state instanceof W||t.state instanceof at||t.state instanceof X||t.state instanceof G)&&b(I)})}var c=m(l,2),_=m(d(c),2),p=d(_),w=d(p);H(w),w.__change=function(...b){var f;(f=t.onMakeManualRequest)==null||f.apply(this,b)},j(),u(p);var g=m(p,2),x=d(g);H(x),x.__change=function(...b){var f;(f=t.onMakeAnimatedRequest)==null||f.apply(this,b)},j(),u(g);var k=m(g,2),y=d(k);H(y),y.__change=function(...b){var f;(f=t.onMakeInstantRequest)==null||f.apply(this,b)},j(),u(k),u(_);var D=m(_,2);{var N=b=>{var f=er(),F=d(f);{var T=B=>{var V=$a(),ut=dt(V),ft=m(d(ut));H(ft),ft.__change=[Ja,t],u(ut);var C=m(ut,2);C.__click=[Va,t],Y(()=>_t(ft,t.state.stepCount)),E(B,V)};Q(F,B=>{(t.state instanceof X||t.state instanceof G||t.state instanceof mt||t.state instanceof et||t.state instanceof ct)&&B(T)})}var q=m(F,2);{var it=B=>{var V=tr(),ut=m(d(V));H(ut),ut.__change=[Qa,t],u(V),Y(()=>_t(ut,t.state.intervalIntervalSeconds)),E(B,V)};Q(q,B=>{(t.state instanceof K||t.state instanceof W||t.state instanceof bt||t.state instanceof nt||t.state instanceof ht)&&B(it)})}var Z=m(q,2);Z.__click=[Za,t],u(f),E(b,f)};Q(D,b=>{(t.state instanceof X||t.state instanceof G||t.state instanceof mt||t.state instanceof et||t.state instanceof ct||t.state instanceof K||t.state instanceof W||t.state instanceof bt||t.state instanceof nt||t.state instanceof ht)&&b(N)})}u(c),u(e),Y(()=>{We(r,t.state instanceof bt||t.state instanceof ht||t.state instanceof qt||t.state instanceof At||t.state instanceof mt||t.state instanceof ct),J(w,"name",`${t.nodeId??""}-mode`),yt(w,t.state instanceof X||t.state instanceof G||t.state instanceof mt||t.state instanceof et||t.state instanceof ct),J(x,"name",`${t.nodeId??""}-mode`),yt(x,t.state instanceof K||t.state instanceof W||t.state instanceof bt||t.state instanceof nt||t.state instanceof ht),J(y,"name",`${t.nodeId??""}-mode`),yt(y,t.state instanceof at||t.state instanceof qt||t.state instanceof wt||t.state instanceof At)}),E(a,e),ot()}gt(["change","click"]);function rr(a,t){rt(t,!0);function e(){t.node.makeManual()}function n(){t.node.makeAnimated()}function r(){t.node.makeInstant()}function o(_){t.node.setOperator(_)}function s(){t.node.resetOutputImage()}function i(){t.node.doManualSteps()}function l(){t.node.unsetOperator()}function I(_){t.node.setStepCount(_)}function c(_){t.node.setIntervalInterval(_)}me(a,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetInputRequest(){return t.onSetInputRequest},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(_,p)=>{ar(_,{get state(){return t.node.state},get operators(){return t.node.operators},get nodeId(){return t.node.id},onMakeManualRequest:e,onMakeAnimatedRequest:n,onMakeInstantRequest:r,onSetOperatorRequest:o,onResetOutputImageRequest:s,onDoManualStepsRequest:i,onUnsetOperatorRequest:l,onSetStepCountRequest:I,onSetIntervalIntervalRequest:c})},$$slots:{default:!0}}),ot()}class we extends ve{constructor(e,n,r,o){super(rr,e,n,o,new mt(1));v(this,"operators");this.operators=r}doManualSteps(){this.state=this.state.doManualSteps(this.outputEdges)}makeAnimated(){const n=setInterval(()=>{this.state=this.state.doAnimatedStep(this.outputEdges)},1);this.state=this.state.makeAnimated(n,.001)}makeInstant(){this.state=this.state.makeInstant(this.outputEdges)}makeManual(){this.state=this.state.makeManual(1)}resetOutputImage(){this.state=this.state.resetOutputImage(this.outputEdges)}setIntervalInterval(e){const n=setInterval(()=>{this.state=this.state.doAnimatedStep(this.outputEdges)},e*1e3);this.state=this.state.setIntervalInterval(n,e)}setOperator(e){this.state=this.state.setOperator(e,this.outputEdges)}setStepCount(e){this.state=this.state.setStepCount(e)}unsetOperator(){this.state=this.state.unsetOperator(this.outputEdges)}invalidateInputImages(){this.state=this.state.invalidateInputImages(this.outputEdges)}validateInputImages(e){this.state=this.state.validateInputImages(e,this.outputEdges)}}const or=[];class sr extends we{constructor(t){super(0,"Generator",or,t)}}function ir(a){return{red:a,green:a,blue:a}}function Kt(a,t){return{red:a.data[t],green:a.data[t+1],blue:a.data[t+2]}}function be(a,t){return{red:a.data[t],green:a.data[t+1],blue:a.data[t+2],alpha:a.data[t+3]}}class ln{constructor(t,e,n){v(this,"displayer");v(this,"id");v(this,"name");this.displayer=(...r)=>(r[1].operator=this,t(...r)),this.id=e,this.name=n}}class Bt extends ln{constructor(t,e,n){super(t,e,n)}}function ur(a,t){t.onSetOperatorRequest(t.operator.withNewMixFactor(a.currentTarget.valueAsNumber))}function lr(a,t){t.onSetOperatorRequest(t.operator.withNewRadius(a.currentTarget.valueAsNumber))}var dr=M('<section><label>Mix factor <input type="number" min="0" max="1" step="0.01"></label> <label>Radius <input type="number" min="0" max="100" step="0.1"></label></section>');function cr(a,t){rt(t,!0);var e=dr(),n=d(e),r=m(d(n));H(r),r.__change=[ur,t],u(n);var o=m(n,2),s=m(d(o));H(s),s.__change=[lr,t],u(o),u(e),Y(()=>{_t(r,t.operator.mixFactor),_t(s,t.operator.radius)}),E(a,e),ot()}gt(["change"]);class Ht extends Bt{constructor(e,n){super(cr,"average-blurring","Average blurring");v(this,"mixFactor");v(this,"radius");this.mixFactor=e,this.radius=n}*operate(e){const n=new ImageData(e[0].width,e[0].height);for(let r=0;r<e[0].data.length;r+=4){yield n;const o=be(e[0],r);let s=ir(0);const i={x:r/4%e[0].width,y:Math.floor(r/4/e[0].width)};let l=0;for(let I=Math.floor(i.y-this.radius);I<=Math.ceil(i.y+this.radius);I+=1)if(I>=0&&I<e[0].height){for(let c=Math.floor(i.x-this.radius);c<=Math.ceil(i.x+this.radius);c+=1)if(c>=0&&c<e[0].width&&((c-i.x)**2+(I-i.y)**2)**.5<=this.radius){const _=(I*e[0].width+c)*4,p=Kt(e[0],_);s={red:s.red+p.red,green:s.green+p.green,blue:s.blue+p.blue},l+=1}}s={red:s.red/l,green:s.green/l,blue:s.blue/l},n.data[r]=s.red*this.mixFactor+o.red*(1-this.mixFactor),n.data[r+1]=s.green*this.mixFactor+o.green*(1-this.mixFactor),n.data[r+2]=s.blue*this.mixFactor+o.blue*(1-this.mixFactor),n.data[r+3]=o.alpha}return n}withNewMixFactor(e){return new Ht(e,this.radius)}withNewRadius(e){return new Ht(this.mixFactor,e)}}function hr(){return{red:0,green:0,blue:0}}function gr(a,t,e){return{red:a,green:t,blue:e}}function vr(a,t){return{...a,alpha:t}}function Vt(a,t,e){a.data[t]=e.red,a.data[t+1]=e.green,a.data[t+2]=e.blue,a.data[t+3]=e.alpha}class dn{constructor(t,e){v(this,"id");v(this,"name");this.id=t,this.name=e}}function Ke(a){return a.toReversed().map(t=>t.toReversed())}class pr extends dn{constructor(){super("convoluting","Convoluting")}applyRotation(t){return console.log(t,Ke(t)),Ke(t)}}const He=new pr;class mr extends dn{constructor(){super("correlating","Correlating")}applyRotation(t){return t}}const le=new mr;var fr=(a,t)=>{t(0)},Ir=M('<td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td> <td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td>',1),wr=(a,t)=>{t(0)},br=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td> <td colspan="1" rowspan="1" class="svelte-ztduc8"></td>',1),_r=M('<td colspan="2" rowspan="1" class="svelte-ztduc8"></td>'),xr=M('<!> <td colspan="2" rowspan="1" class="svelte-ztduc8"></td>',1),Cr=(a,t)=>{t(0)},Er=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td>'),Rr=M('<td colspan="4" rowspan="4" class="kernel-cell svelte-ztduc8"><input type="number" class="svelte-ztduc8"> <input type="radio" class="svelte-ztduc8"></td>'),Mr=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td>'),Sr=M('<tr class="svelte-ztduc8"><!><!><!></tr> <tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td><td colspan="1" rowspan="2" class="svelte-ztduc8"></td><td colspan="1" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td></tr> <tr class="svelte-ztduc8"></tr> <tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><td colspan="1" class="svelte-ztduc8"></td><td colspan="1" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td></tr>',1),yr=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td> <td colspan="1" rowspan="1" class="svelte-ztduc8"></td>',1),kr=M('<td colspan="2" rowspan="1" class="svelte-ztduc8"></td>'),Ar=M('<!> <td colspan="2" rowspan="1" class="svelte-ztduc8"></td>',1),Or=(a,t,e)=>{t(e.operator.kernel.length)},Nr=M('<td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td> <td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td>',1),qr=(a,t)=>{t()},Br=(a,t)=>{t()},Pr=M('<section><fieldset><legend>Kernel</legend> <table class="svelte-ztduc8"><tbody><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="2" rowspan="2" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"></tr><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td></tr><!><tr class="svelte-ztduc8"><!><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="1" rowspan="1" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="2" rowspan="2" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"></tr></tbody></table></fieldset> <fieldset><legend>Kernel interpretation</legend> <label><input type="radio" value="correlating"> Correlating</label> <label><input type="radio" value="convoluting"> Convoluting</label></fieldset></section>');function Dr(a,t){rt(t,!0);function e(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x,y:t.operator.anchorPosition.y+(R>t.operator.anchorPosition.y?0:1)},[...t.operator.kernel.slice(0,R),t.operator.kernel[0].map(()=>0),...t.operator.kernel.slice(R,t.operator.kernel.length)]))}function n(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x+(R>t.operator.anchorPosition.x?0:1),y:t.operator.anchorPosition.y},t.operator.kernel.map(A=>[...A.slice(0,R),0,...A.slice(R,A.length)])))}function r(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x,y:t.operator.anchorPosition.y-(R>t.operator.anchorPosition.y?0:1)},[...t.operator.kernel.slice(0,R),...t.operator.kernel.slice(R+1,t.operator.kernel.length)]))}function o(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x-(R>t.operator.anchorPosition.x?0:1),y:t.operator.anchorPosition.y},t.operator.kernel.map(A=>[...A.slice(0,R),...A.slice(R+1,A.length)])))}function s(R,A){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.with(R.y,t.operator.kernel[R.y].with(R.x,A))))}function i(R){t.onSetOperatorRequest(t.operator.withNewAnchorPosition(R))}function l(){t.onSetOperatorRequest(t.operator.withNewRotationApplier(le))}function I(){t.onSetOperatorRequest(t.operator.withNewRotationApplier(He))}var c=Pr(),_=d(c),p=m(d(_),2),w=d(p),g=d(w),x=m(d(g)),k=d(x);k.__click=[fr,n],u(x);var y=m(x);It(y,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=Ir(),z=dt(L),tt=d(z);tt.__click=()=>{o(S)},u(z);var pt=m(z,2),U=d(pt);U.__click=()=>{n(S+1)},u(pt),Y(()=>tt.disabled=t.operator.kernel[0].length===1),E(R,L)}),j(),u(g);var D=m(g,2),N=d(D),b=d(N);b.__click=[wr,e],u(N);var f=m(N);It(f,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=xr(),z=dt(L);{var tt=U=>{var xt=br();j(2),E(U,xt)},pt=U=>{var xt=_r();E(U,xt)};Q(z,U=>{S===0?U(tt):U(pt,!1)})}j(2),E(R,L)});var F=m(f,3),T=d(F);T.__click=[Cr,e],u(F),u(D);var q=m(D);It(q,17,()=>t.operator.kernel,Ot,(R,A,S)=>{var L=Sr(),z=dt(L),tt=d(z);{var pt=Ct=>{var Pt=Er();E(Ct,Pt)};Q(tt,Ct=>{S===0&&Ct(pt)})}var U=m(tt);It(U,17,()=>h(A),Ot,(Ct,Pt,ne)=>{var ae=Rr(),Gt=d(ae);H(Gt),Gt.__change=wn=>{s({x:ne,y:S},wn.currentTarget.valueAsNumber)};var Wt=m(Gt,2);H(Wt),Wt.__change=()=>{i({x:ne,y:S})},u(ae),Y(()=>{_t(Gt,h(Pt)),J(Wt,"name",`${t.nodeId??""}-anchor`),yt(Wt,t.operator.anchorPosition.x===ne&&t.operator.anchorPosition.y===S)}),E(Ct,ae)});var xt=m(U);{var mn=Ct=>{var Pt=Mr();E(Ct,Pt)};Q(xt,Ct=>{S===0&&Ct(mn)})}u(z);var $t=m(z,2),te=d($t),Re=d(te);Re.__click=()=>{r(S)},u(te);var Me=m(te,3),Se=d(Me);Se.__click=()=>{r(S)},u(Me),u($t);var ye=m($t,4),ee=d(ye),fn=d(ee);fn.__click=()=>{e(S+1)},u(ee);var ke=m(ee),Ae=m(ke),Oe=m(Ae),In=d(Oe);In.__click=()=>{e(S+1)},u(Oe),u(ye),Y(()=>{Re.disabled=t.operator.kernel.length===1,Se.disabled=t.operator.kernel.length===1,J(ke,"rowspan",S===t.operator.kernel.length-1?1:2),J(Ae,"rowspan",S===t.operator.kernel.length-1?1:2)}),E(R,L)});var it=m(q),Z=d(it);It(Z,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=Ar(),z=dt(L);{var tt=U=>{var xt=yr();j(2),E(U,xt)},pt=U=>{var xt=kr();E(U,xt)};Q(z,U=>{S===0?U(tt):U(pt,!1)})}j(2),E(R,L)}),j(2),u(it);var B=m(it),V=m(d(B)),ut=d(V);ut.__click=[Or,e,t],u(V);var ft=m(V);It(ft,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=Nr(),z=dt(L),tt=d(z);tt.__click=()=>{o(S)},u(z);var pt=m(z,2),U=d(pt);U.__click=()=>{n(S+1)},u(pt),Y(()=>tt.disabled=t.operator.kernel[0].length===1),E(R,L)}),j(),u(B),j(),u(w),u(p),u(_);var C=m(_,2),P=m(d(C),2),$=d(P);H($),$.__change=[qr,l],j(),u(P);var vt=m(P,2),Rt=d(vt);H(Rt),Rt.__change=[Br,I],j(),u(vt),u(C),u(c),Y(()=>{J($,"name",`${t.nodeId??""}-kernel-interpretation`),yt($,t.operator.rotationApplier===le),J(Rt,"name",`${t.nodeId??""}-kernel-interpretation`),yt(Rt,t.operator.rotationApplier===He)}),E(a,c),ot()}gt(["click","change"]);function Fr(a){return{red:Math.max(0,Math.min(a.red,255)),green:Math.max(0,Math.min(a.green,255)),blue:Math.max(0,Math.min(a.blue,255))}}class Nt extends Bt{constructor(e,n,r){super(Dr,"convoluting-or-correlating","Convoluting / Correlating");v(this,"rotationApplier");v(this,"anchorPosition");v(this,"kernel");this.anchorPosition=e,this.kernel=n,this.rotationApplier=r}*operate(e){const n=this.rotationApplier.applyRotation(this.kernel),r=new ImageData(e[0].width-(n[0].length-1),e[0].height-(n.length-1));for(let o=this.anchorPosition.y;o<e[0].height+1-n.length+this.anchorPosition.y;o+=1)for(let s=this.anchorPosition.x;s<e[0].width+1-n[0].length+this.anchorPosition.x;s+=1){yield r;let i=hr();const l={x:s-this.anchorPosition.x,y:o-this.anchorPosition.y};for(let c=-this.anchorPosition.y;c<n.length-this.anchorPosition.y;c+=1)for(let _=-this.anchorPosition.x;_<n[0].length-this.anchorPosition.x;_+=1){const p={x:s+_,y:o+c},w=(p.y*e[0].width+p.x)*4,g=Kt(e[0],w),x={x:_+this.anchorPosition.x,y:c+this.anchorPosition.y};i=gr(i.red+g.red*n[x.y][x.x],i.green+g.green*n[x.y][x.x],i.blue+g.blue*n[x.y][x.x])}const I=(l.y*r.width+l.x)*4;Vt(r,I,vr(Fr(i),255))}return r}withNewAnchorPositionAndNewKernel(e,n){return new Nt(e,n,this.rotationApplier)}withNewAnchorPosition(e){return new Nt(e,this.kernel,this.rotationApplier)}withNewKernel(e){return new Nt(this.anchorPosition,e,this.rotationApplier)}withNewRotationApplier(e){return new Nt(this.anchorPosition,this.kernel,e)}}class cn{constructor(t,e){v(this,"id");v(this,"name");this.id=t,this.name=e}}class _e extends cn{constructor(){super("classic","Classic")}compute(t,e){return e<2+(1-t)?0:e<=3?255:0}}function Lr(a){return{red:a,green:a,blue:a}}function Ve(a,t){return(a%t+t)%t}class hn extends cn{constructor(){super("fuzzy","Fuzzy")}compute(t,e){return e<2+(1-t)?255*Math.max(0,1-(2+(1-t)-e)):e<=3?255:255*Math.max(0,1-(e-3))}}function zr(a,t){t.onSetOperatorRequest(t.operator.withNewColorComponentComputer(new _e))}function Ur(a,t){t.onSetOperatorRequest(t.operator.withNewColorComponentComputer(new hn))}function Tr(a,t){t.onSetOperatorRequest(t.operator.withNewMixFactor(a.currentTarget.valueAsNumber))}var Gr=M('<section><fieldset><legend>Color component computer</legend> <div><label><input type="radio" name="component-computer" value="classic"> Classic</label> <label><input type="radio" name="component-computer" value="fuzzy"> Fuzzy</label></div></fieldset> <label>Mix factor <input type="number" min="0" max="1" step="0.01"></label></section>');function Wr(a,t){rt(t,!0);var e=Gr(),n=d(e),r=m(d(n),2),o=d(r),s=d(o);H(s),s.__change=[zr,t],j(),u(o);var i=m(o,2),l=d(i);H(l),l.__change=[Ur,t],j(),u(i),u(r),u(n);var I=m(n,2),c=m(d(I));H(c),c.__change=[Tr,t],u(I),u(e),Y(()=>{yt(s,t.operator.componentComputer instanceof _e),yt(l,t.operator.componentComputer instanceof hn),_t(c,t.operator.mixFactor)}),E(a,e),ot()}gt(["change"]);class Jt extends Bt{constructor(e,n){super(Wr,"game-of-life","Game of Life");v(this,"componentComputer");v(this,"mixFactor");this.componentComputer=e,this.mixFactor=n}*operate(e){let n=new ImageData(e[0].data,e[0].width,e[0].height);for(;;){yield n;const r=new ImageData(e[0].width,e[0].height);for(let o=0;o<r.data.length;o+=4){const s={x:o/4%r.width,y:Math.floor(o/4/r.width)};let i=Lr(0);for(let c=-1;c<=1;c+=1)for(let _=-1;_<=1;_+=1){if(_===0&&c===0)continue;const p={x:Ve(s.x+_,r.width),y:Ve(s.y+c,r.height)},w=(p.x+p.y*r.width)*4,g=Kt(n,w);i={red:i.red+g.red/255,green:i.green+g.green/255,blue:i.blue+g.blue/255}}const l=Kt(n,o),I={red:this.componentComputer.compute(l.red/255,i.red),green:this.componentComputer.compute(l.green/255,i.green),blue:this.componentComputer.compute(l.blue/255,i.blue)};r.data[o]=n.data[o]*(1-this.mixFactor)+I.red*this.mixFactor,r.data[o+1]=n.data[o+1]*(1-this.mixFactor)+I.green*this.mixFactor,r.data[o+2]=n.data[o+2]*(1-this.mixFactor)+I.blue*this.mixFactor,r.data[o+3]=n.data[o+3]}n=r}}withNewColorComponentComputer(e){return new Jt(e,this.mixFactor)}withNewMixFactor(e){return new Jt(this.componentComputer,e)}}function Yr(a,t){return a.red*t.red+a.green*t.green+a.blue*t.blue}function Xr(a,t){return{red:a,green:a,blue:a,alpha:t}}function xe(a,t,e){return{red:a,green:t,blue:e}}function Kr(a,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(xe(a.currentTarget.valueAsNumber,t.operator.multiplier.green,t.operator.multiplier.blue)))}function Hr(a,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(xe(t.operator.multiplier.red,a.currentTarget.valueAsNumber,t.operator.multiplier.blue)))}function Vr(a,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(xe(t.operator.multiplier.red,t.operator.multiplier.green,a.currentTarget.valueAsNumber)))}var Jr=M('<section><fieldset><legend>Multiplier components</legend> <div class="svelte-gtjobo"><label>Red <input type="number" min="0" max="1" step="0.01"></label> <label>Green <input type="number" min="0" max="1" step="0.01"></label> <label>Blue <input type="number" min="0" max="1" step="0.01"></label></div></fieldset></section>');function Qr(a,t){rt(t,!0);var e=Jr(),n=d(e),r=m(d(n),2),o=d(r),s=m(d(o));H(s),s.__change=[Kr,t],u(o);var i=m(o,2),l=m(d(i));H(l),l.__change=[Hr,t],u(i);var I=m(i,2),c=m(d(I));H(c),c.__change=[Vr,t],u(I),u(r),u(n),u(e),Y(()=>{_t(s,t.operator.multiplier.red),_t(l,t.operator.multiplier.green),_t(c,t.operator.multiplier.blue)}),E(a,e),ot()}gt(["change"]);class Ce extends Bt{constructor(e){super(Qr,"grayscaling","Grayscaling");v(this,"multiplier");this.multiplier=e}*operate(e){const n=new ImageData(e[0].width,e[0].height);for(let r=0;r<e[0].data.length;r+=4){yield n;const o=be(e[0],r),s=Yr(o,this.multiplier);Vt(n,r,Xr(s,o.alpha))}return n}withNewMultiplier(e){return new Ce(e)}}var Zr=M("<section></section>");function jr(a,t){var e=Zr();E(a,e)}class $r extends Bt{constructor(e){super(jr,"nearest-neighbor-scaling","Nearest neighbor scaling");v(this,"outputImageDimensions");this.outputImageDimensions=e}*operate(e){const n=new ImageData(this.outputImageDimensions.width,this.outputImageDimensions.height),r={x:this.outputImageDimensions.width/e[0].width,y:this.outputImageDimensions.height/e[0].height};for(let o=0;o<n.data.length;o+=4){yield n;const s=o/4,i={x:s%n.width,y:Math.floor(s/n.width)},l={x:Math.round((i.x-(r.x-1)/2)/r.x),y:Math.round((i.y-(r.y-1)/2)/r.y)},c=(l.y*e[0].width+l.x)*4;n.data[o]=e[0].data[c],n.data[o+1]=e[0].data[c+1],n.data[o+2]=e[0].data[c+2],n.data[o+3]=e[0].data[c+3]}return n}}function Yt(a){return Math.max(0,Math.min(255,a))}function Xt(a,t,e,n){return{red:a,green:t,blue:e,alpha:n}}var to=M("<section></section>");function eo(a,t){var e=to();E(a,e)}class no extends Bt{constructor(){super(eo,"dithering","Dithering ")}*operate(t){const e=new Array(t[0].height).fill(null).map((o,s)=>new Array(t[0].width).fill(null).map((i,l)=>be(t[0],4*(s*t[0].width+l)))),n=new ImageData(t[0].data,t[0].width,t[0].height),r=[[0,0,7/16],[3/16,5/16,1/16]];for(let o=0;o<t[0].height;o+=1)for(let s=0;s<t[0].width;s+=1){yield n;const i=e[o][s],l=Xt(Math.round(Yt(i.red)/255)*255,Math.round(Yt(i.green)/255)*255,Math.round(Yt(i.blue)/255)*255,Yt(i.alpha)),I=Xt(i.red-l.red,i.green-l.green,i.blue-l.blue,i.alpha-l.alpha);Vt(n,4*(o*t[0].width+s),l),e[o][s]=l;for(let c=0;c<r.length;c+=1)for(let _=-1;_<r[c].length-1;_+=1){const p={y:c,x:_+1},w={y:o+c,x:s+_};if(w.y>=0&&w.y<t[0].height&&w.x>=0&&w.x<t[0].width){const g=e[w.y][w.x],x=Xt(g.red+I.red*r[p.y][p.x],g.green+I.green*r[p.y][p.x],g.blue+I.blue*r[p.y][p.x],g.alpha+I.alpha*r[p.y][p.x]);e[w.y][w.x]=x,Vt(n,4*(w.y*t[0].width+w.x),Xt(Math.max(0,Math.min(Math.round(x.red),255)),Math.max(0,Math.min(Math.round(x.green),255)),Math.max(0,Math.min(Math.round(x.blue),255)),Math.max(0,Math.min(Math.round(x.alpha),255))))}}}return n}}const ao=[new Ce({red:.21,green:.72,blue:.07}),new $r({width:300,height:300}),new Jt(new _e,.5),new Ht(1,10),new Nt({x:0,y:0},[[1]],le),new no];class ro extends we{constructor(t){super(1,"Mapper",ao,t)}}class gn{constructor(t,e){v(this,"index");v(this,"output");this.index=t,this.output=e}}class oo extends gn{constructor(e,n,r){super(e,r);v(this,"input");this.input=n}buildWithImage(e){const n=new Xe(`${this.input.id}-${this.index}-${this.output.id}`,e,this.index,this.input,this.output);this.input.addOutputEdge(n),this.output.clearInputEdgeLeft(this.index),this.output.setInputEdge(this.index,n),this.output.validateInputEdges()}buildWithoutImage(){const e=new Xe(`${this.input.id}-${this.index}-${this.output.id}`,null,this.index,this.input,this.output);this.input.addOutputEdge(e),this.output.clearInputEdgeLeft(this.index),this.output.setInputEdge(this.index,e),this.output.invalidateInputImages()}}class Je extends gn{constructor(t,e){super(t,e)}handleInput(t){return new oo(this.index,t,this.output)}}class Ee extends pe{constructor(t){super(t)}}class jt extends Ee{invalidateInputImages(t){return this}validateInputImages(t,e){return this}constructor(){super("started")}startLoading(t){return new jt}doneLoading(t,e){for(const n of e)n.setImage(t);return new vn(t)}useEdgeBuilder(t){t.buildWithoutImage()}}class vn extends Ee{constructor(e){super("doned");v(this,"image");this.image=e}invalidateInputImages(e){return this}startLoading(e){for(const n of e)n.unsetImage();return new jt}validateInputImages(e){return this}useEdgeBuilder(e){e.buildWithImage(this.image)}}function so(a,t){t.node.setUrl(a.currentTarget.value)}var io=M('<input type="url" placeholder="Image URL"> <!>',1);function uo(a,t){rt(t,!0),me(a,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetInputRequest(){return t.onSetInputRequest},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(e,n)=>{var r=io(),o=dt(r);o.__change=[so,t];var s=m(o,2);{var i=l=>{fe(l,{get image(){return t.node.state.image}})};Q(s,l=>{t.node.state instanceof vn&&l(i)})}E(e,r)},$$slots:{default:!0}}),ot()}gt(["change"]);async function lo(a){const t=new Image;t.crossOrigin="Anonymous",t.src=a,await new Promise((o,s)=>{t.onload=o,t.onerror=s});const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)}class co extends Ee{constructor(){super("unconfigured")}invalidateInputImages(t){return this}startLoading(t){return new jt}validateInputImages(t){return this}useEdgeBuilder(t){t.buildWithoutImage()}}class ho extends ve{invalidateInputImages(){}validateInputImages(t){}constructor(t){super(uo,0,"From URL loader",t,new co)}async setUrl(t){const e=this.state.startLoading(this.outputEdges);this.state=e;const n=await lo(t);this.state===e&&(this.state=e.doneLoading(n,this.outputEdges))}}class pn extends ln{constructor(t,e,n){super(t,e,n)}}var go=M("<section></section>");function vo(a){var t=go();E(a,t)}class po extends pn{constructor(){super(vo,"add","Add")}*operate(t){const e=new ImageData(Math.max(t[0].width,t[1].width),Math.max(t[0].height,t[1].height));for(let n=0;n<e.height;n+=1)for(let r=0;r<e.width;r+=1){const o=r<t[0].width&&n<t[0].height,s=r<t[1].width&&n<t[1].height,i=4*(n*t[0].width+r),l=4*(n*t[1].width+r),I=4*(n*e.width+r),c=o?t[0].data[i]:0,_=o?t[0].data[i+1]:0,p=o?t[0].data[i+2]:0,w=o?t[0].data[i+3]:0,g=s?t[1].data[l]:0,x=s?t[1].data[l+1]:0,k=s?t[1].data[l+2]:0,y=s?t[1].data[l+3]:0;e.data[I]=Math.min(c+g,255),e.data[I+1]=Math.min(_+x,255),e.data[I+2]=Math.min(p+k,255),e.data[I+3]=Math.min(w+y,255)}return e}}var mo=M("<section></section>");function fo(a){var t=mo();E(a,t)}class Io extends pn{constructor(){super(fo,"subtract","Subtract")}*operate(t){const e=new ImageData(Math.max(t[0].width,t[1].width),Math.max(t[0].height,t[1].height));for(let n=0;n<e.height;n+=1)for(let r=0;r<e.width;r+=1){const o=r<t[0].width&&n<t[0].height,s=r<t[1].width&&n<t[1].height,i=4*(n*t[0].width+r),l=4*(n*t[1].width+r),I=4*(n*e.width+r),c=o?t[0].data[i]:0,_=o?t[0].data[i+1]:0,p=o?t[0].data[i+2]:0,w=o?t[0].data[i+3]:0,g=s?t[1].data[l]:0,x=s?t[1].data[l+1]:0,k=s?t[1].data[l+2]:0,y=s?t[1].data[l+3]:0;e.data[I]=Math.max(0,c-g),e.data[I+1]=Math.max(0,_-x),e.data[I+2]=Math.max(0,p-k),e.data[I+3]=Math.max(0,w-y)}return e}}const wo=[new po,new Io];class bo extends we{constructor(t){super(2,"Combiner",wo,t)}}function _o(a,t,e,n){if(h(t)!==null)switch(h(t).name){case"movingCamera":{O(e,{x:h(e).x-a.movementX/window.devicePixelRatio,y:h(e).y-a.movementY/window.devicePixelRatio},!0);break}case"movingNode":{h(t).data.node.position={x:h(t).data.node.position.x+a.movementX/window.devicePixelRatio,y:h(t).data.node.position.y+a.movementY/window.devicePixelRatio};break}case"settingEdgeOutput":{O(t,new sn(h(t).data.input,n({x:a.clientX,y:a.clientY})));break}case"settingEdgeInput":{O(t,new on(h(t).data.index,n({x:a.clientX,y:a.clientY}),h(t).data.output));break}}}function xo(a,t){if(h(t)!==null&&a.button===0)switch(h(t).name){case"movingNode":{O(t,null);break}case"movingCamera":{O(t,null);break}}}var Co=M("<li><!></li>"),Eo=M("<li><!></li> <!>",1),Ro=M("<li><!></li>"),Mo=M("<li><!></li>"),So=M('<section role="none" class="svelte-1knjshy"><div class="svelte-1knjshy"><!> <ul class="svelte-1knjshy"><!> <!></ul></div></section>');function yo(a,t){rt(t,!0);let e,n=St(Vn({x:0,y:0}));function r(C){const P=e.getBoundingClientRect();return wa(C,P,h(n))}let o=St([]),s=St(null);function i(C){if(h(s)!==null&&h(s).name==="addingNode"){const P=new C(h(s).data.position);O(o,[...h(o),P]),O(s,null)}}function l(){i(ro)}function I(){i(sr)}function c(){i(Ka)}function _(){i(ho)}function p(){i(bo)}function w(C){C.target===e&&h(s)===null&&(C.preventDefault(),O(s,new Ma(r({x:C.clientX,y:C.clientY}))))}function g(C){C.target===e&&C.button===0&&O(s,Ia)}function x(){h(s)!==null&&O(s,null)}function k(C,P){h(s)===null?O(s,new sn(C,r(P))):h(s).name==="settingEdgeInput"&&(C.handleEdgeBuilder(new Je(h(s).data.index,h(s).data.output)),O(s,null))}function y(C,P,$){h(s)===null?O(s,new on(C,r($),P)):h(s).name==="settingEdgeOutput"&&(h(s).data.input.handleEdgeBuilder(new Je(C,P)),O(s,null))}function D(C){h(s)===null&&O(s,new Ea(C))}function N(){}function b(C){if(O(o,h(o).filter(P=>P!==C)),h(s)!==null)switch(h(s).name){case"settingEdgeOutput":{h(s).data.input===C&&O(s,null);break}case"settingEdgeInput":{h(s).data.output===C&&O(s,null);break}case"movingNode":{h(s).data.node===C&&O(s,null);break}}}var f=So();f.__contextmenu=w,f.__mousemove=[_o,s,n,r],f.__mousedown=g,f.__mouseup=[xo,s];let F;var T=d(f);let q;var it=d(T);{var Z=C=>{va(C,{get position(){return h(s).data.position},onAddMapperOperatableNodeRequest:l,onAddGeneratorOperatableNodeRequest:I,onAddFromFileLoaderNodeRequest:c,onAddFromUrlLoaderNodeRequest:_,onAddCombinerOperatableNodeRequest:p})};Q(it,C=>{h(s)!==null&&h(s).name==="addingNode"&&C(Z)})}var B=m(it,2),V=d(B);It(V,17,()=>h(o),C=>C.id,(C,P)=>{var $=Eo(),vt=dt($),Rt=d(vt);nn(Rt,()=>h(P).displayer,(A,S)=>{S(A,{onDeleteRequest:b,onMouseLeftButtonDown:D,onMouseLeftButtonUp:N,onSetInputRequest:y,onSetOutputRequest:k,get boardMode(){return h(s)}})}),u(vt);var R=m(vt,2);It(R,17,()=>h(P).outputEdges,A=>A.id,(A,S)=>{var L=Co(),z=d(L);xa(z,{get edge(){return h(S)}}),u(L),E(A,L)}),E(C,$)});var ut=m(V,2);{var ft=C=>{var P=de(),$=dt(P);{var vt=R=>{var A=Ro(),S=d(A);ue(S,{get sourcePosition(){return h(s).data.input.position},get targetPosition(){return h(s).data.mouseCursorInBoardPosition}}),u(A),E(R,A)},Rt=(R,A)=>{{var S=L=>{var z=Mo(),tt=d(z);ue(tt,{get sourcePosition(){return h(s).data.mouseCursorInBoardPosition},get targetPosition(){return h(s).data.output.position}}),u(z),E(L,z)};Q(R,L=>{h(s).name==="settingEdgeInput"&&L(S)},A)}};Q($,R=>{h(s).name==="settingEdgeOutput"?R(vt):R(Rt,!1)})}E(C,P)};Q(ut,C=>{h(s)!==null&&C(ft)})}u(B),u(T),u(f),en(f,C=>e=C,()=>e),Y(()=>{F=kt(f,"",F,{"background-position":`calc(50% + ${-h(n).x}px) calc(50% + ${-h(n).y}px)`}),q=kt(T,"",q,{top:`calc(50% + ${-h(n).y}px)`,left:`calc(50% + ${-h(n).x}px)`})}),Jn("mouseleave",f,x),E(a,f),ot()}gt(["contextmenu","mousemove","mousedown","mouseup"]);var ko=M('<main class="svelte-i0vbmk"><!></main>');function Lo(a){var t=ko(),e=d(t);yo(e,{}),u(t),E(a,t)}export{Lo as component};
