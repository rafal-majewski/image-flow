var _n=Object.defineProperty;var qe=a=>{throw TypeError(a)};var xn=(a,t,e)=>t in a?_n(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var v=(a,t,e)=>xn(a,typeof t!="symbol"?t+"":t,e),Cn=(a,t,e)=>t.has(a)||qe("Cannot "+e);var Et=(a,t,e)=>(Cn(a,t,"read from private field"),e?e.call(a):t.get(a)),Dt=(a,t,e)=>t.has(a)?qe("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);import{t as M,a as E,n as En,c as de,d as Be}from"../chunks/7jJxD1YU.js";import"../chunks/v4DbhfZw.js";import{b as Rn,h as lt,o as Mn,z as h,a8 as Sn,j as yn,r as Pe,s as re,k as oe,c as Ft,X as kn,m as Ze,a as je,p as An,an as se,$ as $e,N as De,ao as Fe,ad as On,ap as Le,aq as ce,ar as Nn,_ as qn,as as Bn,d as Pn,at as he,au as Dn,V as Fn,Q as Ln,T as zn,a1 as Un,av as tn,v as Tn,aw as Gn,ax as Wn,ay as Yn,az as Xn,aA as Kn,aB as Hn,C as $,I as l,J as u,D as p,F as T,G as tt,am as ze,ak as St,ac as O,f as ct,u as Vn,aC as j,ab as Jn}from"../chunks/B2bjRoan.js";import{d as dt,s as en,e as Qn}from"../chunks/Sbfvohkh.js";import{i as Q,b as nn,c as an}from"../chunks/BzIaRVEm.js";import{s as Zn}from"../chunks/B8KPF8bS.js";import{o as jn}from"../chunks/91qYvWjJ.js";let Ue=!1;function $n(){Ue||(Ue=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var t;if(!a.defaultPrevented)for(const e of a.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function Ot(a,t){return t}function ta(a,t,e,n){for(var r=[],o=t.length,s=0;s<o;s++)Nn(t[s].e,r,!0);var i=o>0&&r.length===0&&e!==null;if(i){var d=e.parentNode;qn(d),d.append(e),n.clear(),Mt(a,t[0].prev,t[o-1].next)}Bn(r,()=>{for(var I=0;I<o;I++){var c=t[I];i||(n.delete(c.k),Mt(a,c.prev,c.next)),Pn(c.e,!i)}})}function wt(a,t,e,n,r,o=null){var s=a,i={flags:t,items:new Map,first:null},d=(t&tn)!==0;if(d){var I=a;s=lt?re(zn(I)):I.appendChild(Un())}lt&&Mn();var c=null,_=!1,m=Sn(()=>{var w=e();return Ln(w)?w:w==null?[]:$e(w)});Rn(()=>{var w=h(m),g=w.length;if(_&&g===0)return;_=g===0;let x=!1;if(lt){var k=s.data===yn;k!==(g===0)&&(s=Pe(),re(s),oe(!1),x=!0)}if(lt){for(var y=null,N,q=0;q<g;q++){if(Ft.nodeType===8&&Ft.data===kn){s=Ft,x=!0,oe(!1);break}var b=w[q],f=n(b,q);N=rn(Ft,i,y,null,b,f,q,r,t,e),i.items.set(f,N),y=N}g>0&&re(Pe())}lt||ea(w,i,s,r,t,n,e),o!==null&&(g===0?c?Ze(c):c=je(()=>o(s)):c!==null&&An(c,()=>{c=null})),x&&oe(!0),h(m)}),lt&&(s=Ft)}function ea(a,t,e,n,r,o,s){var It,C,D,et;var i=(r&Gn)!==0,d=(r&(he|ce))!==0,I=a.length,c=t.items,_=t.first,m=_,w,g=null,x,k=[],y=[],N,q,b,f;if(i)for(f=0;f<I;f+=1)N=a[f],q=o(N,f),b=c.get(q),b!==void 0&&((It=b.a)==null||It.measure(),(x??(x=new Set)).add(b));for(f=0;f<I;f+=1){if(N=a[f],q=o(N,f),b=c.get(q),b===void 0){var F=m?m.e.nodes_start:e;g=rn(F,t,g,g===null?t.first:g.next,N,q,f,n,r,s),c.set(q,g),k=[],y=[],m=g.next;continue}if(d&&na(b,N,f,r),(b.e.f&se)!==0&&(Ze(b.e),i&&((C=b.a)==null||C.unfix(),(x??(x=new Set)).delete(b))),b!==m){if(w!==void 0&&w.has(b)){if(k.length<y.length){var W=y[0],B;g=W.prev;var it=k[0],Z=k[k.length-1];for(B=0;B<k.length;B+=1)Te(k[B],W,e);for(B=0;B<y.length;B+=1)w.delete(y[B]);Mt(t,it.prev,Z.next),Mt(t,g,it),Mt(t,Z,W),m=W,g=Z,f-=1,k=[],y=[]}else w.delete(b),Te(b,m,e),Mt(t,b.prev,b.next),Mt(t,b,g===null?t.first:g.next),Mt(t,g,b),g=b;continue}for(k=[],y=[];m!==null&&m.k!==q;)(m.e.f&se)===0&&(w??(w=new Set)).add(m),y.push(m),m=m.next;if(m===null)continue;b=m}k.push(b),g=b,m=b.next}if(m!==null||w!==void 0){for(var P=w===void 0?[]:$e(w);m!==null;)(m.e.f&se)===0&&P.push(m),m=m.next;var V=P.length;if(V>0){var ut=(r&tn)!==0&&I===0?e:null;if(i){for(f=0;f<V;f+=1)(D=P[f].a)==null||D.measure();for(f=0;f<V;f+=1)(et=P[f].a)==null||et.fix()}ta(t,P,ut,c)}}i&&Tn(()=>{var pt;if(x!==void 0)for(b of x)(pt=b.a)==null||pt.apply()}),De.first=t.first&&t.first.e,De.last=g&&g.e}function na(a,t,e,n){(n&he)!==0&&Fe(a.v,t),(n&ce)!==0?Fe(a.i,e):a.i=e}function rn(a,t,e,n,r,o,s,i,d,I){var c=(d&he)!==0,_=(d&Dn)===0,m=c?_?On(r):Le(r):r,w=(d&ce)===0?s:Le(s),g={i:w,v:m,k:o,a:null,e:null,prev:e,next:n};try{return g.e=je(()=>i(a,m,w,I),lt),g.e.prev=e&&e.e,g.e.next=n&&n.e,e===null?t.first=g:(e.next=g,e.e.next=g.e),n!==null&&(n.prev=g,n.e.prev=g.e),g}finally{}}function Te(a,t,e){for(var n=a.next?a.next.e.nodes_start:e,r=t?t.e.nodes_start:e,o=a.e.nodes_start;o!==n;){var s=Fn(o);r.before(o),o=s}}function Mt(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const Ge=[...` 	
\r\f¬†\v\uFEFF`];function aa(a,t,e){var n=""+a;if(e){for(var r in e)if(e[r])n=n?n+" "+r:r;else if(n.length)for(var o=r.length,s=0;(s=n.indexOf(r,s))>=0;){var i=s+o;(s===0||Ge.includes(n[s-1]))&&(i===n.length||Ge.includes(n[i]))?n=(s===0?"":n.substring(0,s))+n.substring(i+1):s=i}}return n===""?null:n}function We(a,t=!1){var e=t?" !important;":";",n="";for(var r in a){var o=a[r];o!=null&&o!==""&&(n+=" "+r+": "+o+e)}return n}function ra(a,t){if(t){var e="",n,r;return Array.isArray(t)?(n=t[0],r=t[1]):n=t,n&&(e+=We(n)),r&&(e+=We(r,!0)),e=e.trim(),e===""?null:e}return String(a)}function oa(a,t,e,n,r,o){var s=a.__className;if(lt||s!==e){var i=aa(e,n,o);(!lt||i!==a.getAttribute("class"))&&(i==null?a.removeAttribute("class"):a.className=i),a.__className=e}else if(o&&r!==o)for(var d in o){var I=!!o[d];(r==null||I!==!!r[d])&&a.classList.toggle(d,I)}return o}function ie(a,t={},e,n){for(var r in e){var o=e[r];t[r]!==o&&(e[r]==null?a.style.removeProperty(r):a.style.setProperty(r,o,n))}}function kt(a,t,e,n){var r=a.__style;if(lt||r!==t){var o=ra(t,n);(!lt||o!==a.getAttribute("style"))&&(o==null?a.removeAttribute("style"):a.style.cssText=o),a.__style=t}else n&&(Array.isArray(n)?(ie(a,e==null?void 0:e[0],n[0]),ie(a,e==null?void 0:e[1],n[1],"important")):ie(a,e,n));return n}const sa=Symbol("is custom element"),ia=Symbol("is html");function G(a){if(lt){var t=!1,e=()=>{if(!t){if(t=!0,a.hasAttribute("value")){var n=a.value;J(a,"value",null),a.value=n}if(a.hasAttribute("checked")){var r=a.checked;J(a,"checked",null),a.checked=r}}};a.__on_r=e,Wn(e),$n()}}function vt(a,t){var e=ge(a);e.value===(e.value=t??void 0)||a.value===t&&(t!==0||a.nodeName!=="PROGRESS")||(a.value=t??"")}function yt(a,t){var e=ge(a);e.checked!==(e.checked=t??void 0)&&(a.checked=t)}function Ye(a,t){t?a.hasAttribute("selected")||a.setAttribute("selected",""):a.removeAttribute("selected")}function J(a,t,e,n){var r=ge(a);lt&&(r[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||r[t]!==(r[t]=e)&&(t==="loading"&&(a[Xn]=e),e==null?a.removeAttribute(t):typeof e!="string"&&ua(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function ge(a){return a.__attributes??(a.__attributes={[sa]:a.nodeName.includes("-"),[ia]:a.namespaceURI===Yn})}var Xe=new Map;function ua(a){var t=Xe.get(a.nodeName);if(t)return t;Xe.set(a.nodeName,t=[]);for(var e,n=a,r=Element.prototype;r!==n;){e=Hn(n);for(var o in e)e[o].set&&t.push(o);n=Kn(n)}return t}function la(a,t){t.onAddGeneratorOperatableNodeRequest()}function da(a,t){t.onAddMapperOperatableNodeRequest()}function ca(a,t){t.onAddFromFileLoaderNodeRequest()}function ha(a,t){t.onAddFromUrlLoaderNodeRequest()}function ga(a,t){t.onAddCombinerOperatableNodeRequest()}var va=M('<dialog open class="svelte-1ui4dgg"><menu><li><button>Add a from file loader</button></li> <li><button>Add a from URL loader</button></li> <li><ul><li><button>Add a generator operatable</button></li> <li><button>Add a mapper operatable</button></li> <li><button>Add a combiner operatable</button></li></ul></li></menu></dialog>');function pa(a,t){$(t,!0);var e=va();let n;var r=l(e),o=l(r),s=l(o);s.__click=[ca,t],u(o);var i=p(o,2),d=l(i);d.__click=[ha,t],u(i);var I=p(i,2),c=l(I),_=l(c),m=l(_);m.__click=[la,t],u(_);var w=p(_,2),g=l(w);g.__click=[da,t],u(w);var x=p(w,2),k=l(x);k.__click=[ga,t],u(x),u(c),u(I),u(r),u(e),T(()=>n=kt(e,"",n,{top:`calc(${t.position.y??""}px + 50%)`,left:`calc(${t.position.x??""}px + 50%)`})),E(a,e),tt()}dt(["click"]);var ma=En('<svg xmlns="http://www.w3.org/2000/svg" class="svelte-vva1zu"><line stroke="black" stroke-width="2"></line></svg>');function ue(a,t){$(t,!0);const e=ze(()=>((t.sourcePosition.x-t.targetPosition.x)**2+(t.sourcePosition.y-t.targetPosition.y)**2)**.5),n=ze(()=>Math.atan2(t.targetPosition.y-t.sourcePosition.y,t.targetPosition.x-t.sourcePosition.x));var r=ma();J(r,"height",2);let o;var s=l(r);J(s,"x1",0),J(s,"y1",1),J(s,"y2",1),u(r),T(()=>{J(r,"viewBox",`0 0 ${h(e)??""} 2`),J(r,"width",h(e)),o=kt(r,"",o,{rotate:`${h(n)??""}rad`,top:`${t.sourcePosition.y??""}px`,left:`${t.sourcePosition.x??""}px`}),J(s,"x2",h(e))}),E(a,r),tt()}class on{constructor(t){v(this,"name");this.name=t}}const fa="movingCamera";class Ia extends on{constructor(){super(fa)}}const wa=new Ia;function ba(a,t,e){return{x:a.x-t.x-t.width/2+e.x,y:a.y-t.y-t.height/2+e.y}}function _a(a,t){t.edge.delete()}var xa=M('<div><!> <button class="svelte-x0wqt4">üóëÔ∏è</button></div>');function Ca(a,t){$(t,!0);var e=xa(),n=l(e);ue(n,{get sourcePosition(){return t.edge.input.position},get targetPosition(){return t.edge.output.position}});var r=p(n,2);r.__click=[_a,t];let o;u(e),T(()=>o=kt(r,"",o,{top:`${(t.edge.input.position.y+t.edge.output.position.y)/2}px`,left:`${(t.edge.input.position.x+t.edge.output.position.x)/2}px`})),E(a,e),tt()}dt(["click"]);class Qt extends on{constructor(e,n){super(n);v(this,"data");this.data=e}}const Ea="movingNode";class Ra extends Qt{constructor(t){super({node:t},Ea)}}const Ma="addingNode";class Sa extends Qt{constructor(t){super({position:t},Ma)}}const ya="settingEdgeInput";class sn extends Qt{constructor(t,e,n){super({index:t,mouseCursorInBoardPosition:e,output:n},ya)}}const ka="settingEdgeOutput";class un extends Qt{constructor(t,e){super({input:t,mouseCursorInBoardPosition:e},ka)}}function Aa(){return Math.random().toString(36).substring(2,15)}class Ke{constructor(t,e,n,r,o){v(this,"id");v(this,"image");v(this,"index");v(this,"input");v(this,"output");this.id=t,this.image=e,this.index=n,this.input=r,this.output=o}delete(){this.input.deleteOutputEdge(this),this.output.unsetInputEdge(this.index),this.output.invalidateInputImages()}deleteLeft(){this.input.deleteOutputEdge(this)}setImage(t){this.image=t,this.output.validateInputEdges()}unsetImage(){this.image=null,this.output.invalidateInputImages()}}var Lt,zt,Ut;class Oa{constructor(t,e,n,r){v(this,"displayer");v(this,"id");Dt(this,Lt,St());v(this,"name");Dt(this,zt,St());Dt(this,Ut,St());this.displayer=(...o)=>(o[1].node=this,t(...o)),this.id=Aa(),this.inputEdges=new Array(e).fill(null),this.name=n,this.outputEdges=[],this.position=r}get inputEdges(){return h(Et(this,Lt))}set inputEdges(t){O(Et(this,Lt),t)}get outputEdges(){return h(Et(this,zt))}set outputEdges(t){O(Et(this,zt),t)}deleteOutputEdge(t){this.outputEdges=this.outputEdges.filter(e=>e!==t)}get position(){return h(Et(this,Ut))}set position(t){O(Et(this,Ut),t)}clearInputEdgeLeft(t){this.inputEdges[t]!==void 0&&this.inputEdges[t]!==null&&this.inputEdges[t].deleteLeft()}setInputEdge(t,e){this.inputEdges=this.inputEdges.with(t,e)}unsetInputEdge(t){this.inputEdges=this.inputEdges.with(t,null)}validateInputEdges(){if(this.inputEdges.every(t=>t!==null)){const t=this.inputEdges.map(e=>e.image);t.every(e=>e!==null)&&this.validateInputImages(t)}}addOutputEdge(t){this.outputEdges=[...this.outputEdges,t]}handleEdgeBuilder(t){this.useEdgeBuilder(t.handleInput(this))}delete(){for(const t of this.outputEdges)t.delete();for(const t of this.inputEdges)t!==null&&t.delete()}}Lt=new WeakMap,zt=new WeakMap,Ut=new WeakMap;var Tt;class ve extends Oa{constructor(e,n,r,o,s){super(e,n,r,o);Dt(this,Tt,St());this.state=s}get state(){return h(Et(this,Tt))}set state(e){O(Et(this,Tt),e)}useEdgeBuilder(e){this.state.useEdgeBuilder(e)}}Tt=new WeakMap;class pe{constructor(t){v(this,"status");this.status=t}}function Na(a,t){t.node.delete(),t.onDeleteRequest(t.node)}function qa(a,t){a.button===0&&t.onMouseLeftButtonDown(t.node,{x:a.clientX,y:a.clientY})}function Ba(a,t){a.button===0&&t.onMouseLeftButtonUp(t.node)}function Pa(a,t){t.onSetOutputRequest(t.node,{x:a.clientX,y:a.clientY})}var Da=M("<li><button>üîå</button> <!></li>"),Fa=M('<section role="none"><div class="svelte-1vplcxm"><header> </header> <button>üóëÔ∏è</button></div> <ol></ol> <!> <div class="svelte-1vplcxm"><button>üîå</button></div></section>');function me(a,t){$(t,!0);function e(g,x){t.onSetInputRequest(g,t.node,x)}var n=Fa();n.__mousedown=[qa,t],n.__mouseup=[Ba,t];let r,o;var s=l(n),i=l(s),d=l(i,!0);u(i);var I=p(i,2);I.__click=[Na,t],u(s);var c=p(s,2);wt(c,21,()=>t.node.inputEdges,Ot,(g,x,k)=>{var y=Da(),N=l(y);N.__click=f=>{e(k,{x:f.clientX,y:f.clientY})};var q=p(N,2);{var b=f=>{var F=de(),W=ct(F);{var B=Z=>{var P=Be("‚åõ");E(Z,P)},it=Z=>{var P=Be("üñºÔ∏è");E(Z,P)};Q(W,Z=>{h(x).image===null?Z(B):Z(it,!1)})}E(f,F)};Q(q,f=>{h(x)!==null&&f(b)})}u(y),T(()=>N.disabled=t.boardMode!==null&&t.boardMode.name==="settingEdgeInput"),E(g,y)}),u(c);var _=p(c,2);Zn(_,()=>t.children);var m=p(_,2),w=l(m);w.__click=[Pa,t],u(m),u(n),T(g=>{r=oa(n,1,"svelte-1vplcxm",null,r,g),o=kt(n,"",o,{top:`${t.node.position.y??""}px`,left:`${t.node.position.x??""}px`}),en(d,t.node.name),w.disabled=t.boardMode!==null&&t.boardMode.name==="settingEdgeOutput"},[()=>({started:t.node.state.status==="started",doned:t.node.state.status==="doned",unconfigured:t.node.state.status==="unconfigured"})]),E(a,n),tt()}dt(["mousedown","mouseup","click"]);function La(a,t,e){O(t,h(t)*e)}function za(a,t,e){O(t,h(t)/e)}function Ua(a,t){O(t,a.currentTarget.valueAsNumber,!0)}var Ta=M('<section><div><canvas class="svelte-qio82b"></canvas></div> <div><button>+</button> <button>-</button> <input type="number" min="0"></div></section>');function fe(a,t){$(t,!0);let e;jn(()=>{const g=e.getContext("2d");Vn(()=>{e.width=t.image.width,e.height=t.image.height,g.putImageData(t.image,0,0)})});let n=St(1);const r=1.1;var o=Ta(),s=l(o);let i;var d=l(s);let I;nn(d,g=>e=g,()=>e),u(s);var c=p(s,2),_=l(c);_.__click=[La,n,r];var m=p(_,2);m.__click=[za,n,r];var w=p(m,2);G(w),w.__change=[Ua,n],u(c),u(o),T((g,x)=>{i=kt(s,"",i,{width:`${g??""}px`,height:`${x??""}px`}),I=kt(d,"",I,{scale:h(n)}),vt(w,h(n))},[()=>Math.round(t.image.width*h(n)),()=>Math.round(t.image.height*h(n))]),E(a,o),tt()}dt(["click","change"]);class Ie extends pe{constructor(t){super(t)}}class Zt extends Ie{invalidateInputImages(t){return this}validateInputImages(t,e){return this}constructor(){super("started")}startLoading(t){return new Zt}doneLoading(t,e){for(const n of e)n.setImage(t);return new ln(t)}useEdgeBuilder(t){t.buildWithoutImage()}}class ln extends Ie{constructor(e){super("doned");v(this,"image");this.image=e}invalidateInputImages(e){return this}startLoading(e){for(const n of e)n.unsetImage();return new Zt}validateInputImages(e){return this}useEdgeBuilder(e){e.buildWithImage(this.image)}}function Ga(a,t){const e=a.currentTarget.files[0];t.node.setFile(e)}var Wa=M('<input type="file" accept="image/*"> <!>',1);function Ya(a,t){$(t,!0),me(a,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetInputRequest(){return t.onSetInputRequest},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(e,n)=>{var r=Wa(),o=ct(r);o.__change=[Ga,t];var s=p(o,2);{var i=d=>{fe(d,{get image(){return t.node.state.image}})};Q(s,d=>{t.node.state instanceof ln&&d(i)})}E(e,r)},$$slots:{default:!0}}),tt()}dt(["change"]);async function Xa(a){const t=new FileReader;await new Promise((s,i)=>{t.onload=s,t.onerror=i,t.readAsDataURL(a)});const e=new Image;e.src=t.result,await new Promise((s,i)=>{e.onload=s,e.onerror=i});const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)}class Ka extends Ie{constructor(){super("unconfigured")}invalidateInputImages(t){return this}startLoading(t){return new Zt}validateInputImages(t){return this}useEdgeBuilder(t){t.buildWithoutImage()}}class Ha extends ve{invalidateInputImages(){}validateInputImages(t){}constructor(t){super(Ya,0,"From file loader",t,new Ka)}async setFile(t){const e=this.state.startLoading(this.outputEdges);this.state=e;const n=await Xa(t);this.state===e&&(this.state=e.doneLoading(n,this.outputEdges))}}class st extends pe{constructor(t){super(t)}}class K extends st{constructor(e,n,r,o,s){super("started");v(this,"generator");v(this,"inputImages");v(this,"operator");v(this,"outputImage");v(this,"stepCount");this.generator=e,this.inputImages=n,this.operator=r,this.outputImage=o,this.stepCount=s}doAnimatedStep(e){const n=this.generator.next();if(n.done){for(const r of e)r.setImage(n.value);return new Y(this.inputImages,this.operator,n.value,this.stepCount)}else return new K(this.generator,this.inputImages,this.operator,n.value,this.stepCount)}doManualSteps(e){return this}invalidateInputImages(e){return new at(this.operator,this.stepCount)}makeAnimated(e,n){return new H(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}useEdgeBuilder(e){e.buildWithoutImage()}makeInstant(e){let n=this.generator.next();for(;!n.done;)n=this.generator.next();for(const r of e)r.setImage(n.value);return new ot(this.inputImages,this.operator,n.value)}makeManual(e){return this}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new Y(this.inputImages,this.operator,r.value,this.stepCount)}else return new K(n,this.inputImages,this.operator,r.value,this.stepCount)}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new Y(this.inputImages,e,o.value,this.stepCount)}else return new K(r,this.inputImages,e,o.value,this.stepCount)}setStepCount(e){return new K(this.generator,this.inputImages,this.operator,this.outputImage,e)}unsetOperator(e){return new ht(this.inputImages,this.stepCount)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new Y(e,this.operator,o.value,this.stepCount)}else return new K(r,e,this.operator,o.value,this.stepCount)}}class at extends st{constructor(e,n){super("unconfigured");v(this,"operator");v(this,"stepCount");this.operator=e,this.stepCount=n}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new rt(e,n,this.operator)}makeInstant(e){return new bt(this.operator)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new at(e,this.stepCount)}setStepCount(e){return new at(this.operator,e)}unsetOperator(e){return new ft(this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new Y(e,this.operator,o.value,this.stepCount)}else return new K(r,e,this.operator,o.value,this.stepCount)}}class Y extends st{constructor(e,n,r,o){super("doned");v(this,"inputImages");v(this,"operator");v(this,"outputImage");v(this,"stepCount");this.inputImages=e,this.operator=n,this.outputImage=r,this.stepCount=o}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new at(this.operator,this.stepCount)}makeAnimated(e,n){return new X(this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e){return new ot(this.inputImages,this.operator,this.outputImage)}makeManual(e){return this}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new Y(this.inputImages,this.operator,r.value,this.stepCount)}else{for(const o of e)o.unsetImage();return new K(n,this.inputImages,this.operator,r.value,this.stepCount)}}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new Y(this.inputImages,e,o.value,this.stepCount)}else{for(const s of n)s.unsetImage();return new K(r,this.inputImages,e,o.value,this.stepCount)}}setStepCount(e){return new Y(this.inputImages,this.operator,this.outputImage,e)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}unsetOperator(e){for(const n of e)n.unsetImage();return new ht(this.inputImages,this.stepCount)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new Y(e,this.operator,o.value,this.stepCount)}else{for(const s of n)s.unsetImage();return new K(r,e,this.operator,o.value,this.stepCount)}}}class ht extends st{constructor(e,n){super("unconfigured");v(this,"inputImages");v(this,"stepCount");this.inputImages=e,this.stepCount=n}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new ft(this.stepCount)}makeAnimated(e,n){return new gt(this.inputImages,e,n)}makeInstant(e){return new At(this.inputImages)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new Y(this.inputImages,e,o.value,this.stepCount)}else return new K(r,this.inputImages,e,o.value,this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}setStepCount(e){return new ht(this.inputImages,e)}unsetOperator(e){return this}validateInputImages(e,n){return new ht(e,this.stepCount)}}class At extends st{constructor(e){super("unconfigured");v(this,"inputImages");this.inputImages=e}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new qt}makeAnimated(e,n){return new gt(this.inputImages,e,n)}makeInstant(e){return this}makeManual(e){return new ht(this.inputImages,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}useEdgeBuilder(e){e.buildWithoutImage()}setOperator(e,n){const r=e.operate(this.inputImages);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new ot(this.inputImages,e,o.value)}setStepCount(e){return this}unsetOperator(e){return this}validateInputImages(e,n){return new At(e)}}class qt extends st{constructor(){super("unconfigured")}useEdgeBuilder(t){t.buildWithoutImage()}doAnimatedStep(t){return this}doManualSteps(t){return this}invalidateInputImages(t){return this}makeAnimated(t,e){return new _t(t,e)}makeInstant(t){return this}makeManual(t){return new ft(t)}resetOutputImage(t){return this}setIntervalInterval(t,e){return this}setOperator(t,e){return new bt(t)}setStepCount(t){return this}unsetOperator(t){return this}validateInputImages(t,e){return new At(t)}}class bt extends st{constructor(e){super("unconfigured");v(this,"operator");this.operator=e}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new rt(e,n,this.operator)}makeInstant(e){return this}makeManual(e){return new at(this.operator,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new bt(e)}setStepCount(e){return this}unsetOperator(e){return new qt}validateInputImages(e,n){const r=this.operator.operate(e);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new ot(e,this.operator,o.value)}useEdgeBuilder(e){e.buildWithoutImage()}}class ot extends st{constructor(e,n,r){super("doned");v(this,"inputImages");v(this,"operator");v(this,"outputImage");this.inputImages=e,this.operator=n,this.outputImage=r}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new bt(this.operator)}makeAnimated(e,n){return new X(this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e){return this}makeManual(e){return new Y(this.inputImages,this.operator,this.outputImage,e)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}resetOutputImage(e){const n=this.operator.operate(this.inputImages);let r=n.next();for(;!r.done;)r=n.next();for(const o of e)o.setImage(r.value);return new ot(this.inputImages,this.operator,r.value)}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new ot(this.inputImages,e,o.value)}setStepCount(e){return this}unsetOperator(e){for(const n of e)n.unsetImage();return new At(this.inputImages)}validateInputImages(e,n){const r=this.operator.operate(e);let o=r.next();for(;!o.done;)o=r.next();for(const s of n)s.setImage(o.value);return new ot(e,this.operator,o.value)}}class H extends st{constructor(e,n,r,o,s,i){super("started");v(this,"generator");v(this,"inputImages");v(this,"intervalId");v(this,"intervalIntervalSeconds");v(this,"operator");v(this,"outputImage");this.generator=e,this.inputImages=n,this.intervalId=r,this.intervalIntervalSeconds=o,this.operator=s,this.outputImage=i}doAnimatedStep(e){const n=this.generator.next();if(n.done){for(const r of e)r.setImage(n.value);return new X(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,n.value)}else return new H(this.generator,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,n.value)}doManualSteps(e){return this}invalidateInputImages(e){return new rt(this.intervalId,this.intervalIntervalSeconds,this.operator)}makeAnimated(e,n){return this}useEdgeBuilder(e){e.buildWithoutImage()}makeInstant(e){let n=this.generator.next();for(;!n.done;)n=this.generator.next();for(const r of e)r.setImage(n.value);return new ot(this.inputImages,this.operator,n.value)}makeManual(e){return new K(this.generator,this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new X(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}else return new H(n,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}setIntervalInterval(e,n){return clearInterval(this.intervalId),new H(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new X(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}else return new H(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}setStepCount(e){return this}unsetOperator(e){return new gt(this.inputImages,this.intervalId,this.intervalIntervalSeconds)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new X(e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}else return new H(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}}class gt extends st{constructor(e,n,r){super("unconfigured");v(this,"inputImages");v(this,"intervalId");v(this,"intervalIntervalSeconds");this.inputImages=e,this.intervalId=n,this.intervalIntervalSeconds=r}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new _t(this.intervalId,this.intervalIntervalSeconds)}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new At(this.inputImages)}makeManual(e){return clearInterval(this.intervalId),new ht(this.inputImages,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new gt(this.inputImages,e,n)}useEdgeBuilder(e){e.buildWithoutImage()}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new X(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}else return new H(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}setStepCount(e){return this}unsetOperator(e){return this}validateInputImages(e,n){return new gt(e,this.intervalId,this.intervalIntervalSeconds)}}class X extends st{constructor(e,n,r,o,s){super("doned");v(this,"inputImages");v(this,"intervalId");v(this,"intervalIntervalSeconds");v(this,"operator");v(this,"outputImage");this.inputImages=e,this.intervalId=n,this.intervalIntervalSeconds=r,this.operator=o,this.outputImage=s}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new rt(this.intervalId,this.intervalIntervalSeconds,this.operator)}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new ot(this.inputImages,this.operator,this.outputImage)}makeManual(e){return clearInterval(this.intervalId),new Y(this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const o of e)o.setImage(r.value);return new X(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}else{for(const o of e)o.unsetImage();return new H(n,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}}setIntervalInterval(e,n){return clearInterval(this.intervalId),new X(this.inputImages,e,n,this.operator,this.outputImage)}setOperator(e,n){const r=e.operate(this.inputImages),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new X(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}else{for(const s of n)s.unsetImage();return new H(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,o.value)}}setStepCount(e){return this}unsetOperator(e){for(const n of e)n.unsetImage();return new gt(this.inputImages,this.intervalId,this.intervalIntervalSeconds)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new X(e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}else{for(const s of n)s.unsetImage();return new H(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}}}class rt extends st{constructor(e,n,r){super("unconfigured");v(this,"intervalId");v(this,"intervalIntervalSeconds");v(this,"operator");this.intervalId=e,this.intervalIntervalSeconds=n,this.operator=r}useEdgeBuilder(e){e.buildWithoutImage()}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new bt(this.operator)}makeManual(e){return new at(this.operator,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new rt(e,n,this.operator)}setOperator(e,n){return new rt(this.intervalId,this.intervalIntervalSeconds,e)}setStepCount(e){return this}unsetOperator(e){return new _t(this.intervalId,this.intervalIntervalSeconds)}validateInputImages(e,n){const r=this.operator.operate(e),o=r.next();if(o.done){for(const s of n)s.setImage(o.value);return new X(e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}else return new H(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,o.value)}}class _t extends st{constructor(e,n){super("unconfigured");v(this,"intervalId");v(this,"intervalIntervalSeconds");this.intervalId=e,this.intervalIntervalSeconds=n}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return this}makeInstant(e){return clearInterval(this.intervalId),new qt}makeManual(e){return new ft(e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new _t(e,n)}setOperator(e,n){return new rt(this.intervalId,this.intervalIntervalSeconds,e)}setStepCount(e){return this}unsetOperator(e){return this}validateInputImages(e,n){return new gt(e,this.intervalId,this.intervalIntervalSeconds)}useEdgeBuilder(e){e.buildWithoutImage()}}class ft extends st{constructor(e){super("unconfigured");v(this,"stepCount");this.stepCount=e}doAnimatedStep(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new _t(e,n)}makeInstant(e){return new qt}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new at(e,this.stepCount)}setStepCount(e){return new ft(e)}unsetOperator(e){return this}validateInputImages(e,n){return new ht(e,this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}}function Va(a,t){if(a.currentTarget.value==="none")t.onUnsetOperatorRequest();else{const e=t.operators.find(n=>n.id===a.currentTarget.value);t.onSetOperatorRequest(e)}}function Ja(a,t){t.onDoManualStepsRequest()}function Qa(a,t){t.onSetStepCountRequest(Number.parseInt(a.currentTarget.value,10))}function Za(a,t){t.onSetIntervalIntervalRequest(Number.parseFloat(a.currentTarget.value))}function ja(a,t){t.onResetOutputImageRequest()}var $a=M("<option> </option>"),tr=M('<label>Step count: <input type="number" min="1" step="1"></label> <button>Do steps</button>',1),er=M('<label>Interval (seconds): <input type="number" min="0.0001" step="0.0001"></label>'),nr=M("<div><!> <!> <button>Reset</button></div>"),ar=M('<section><select><option>No operator</option><!></select> <!> <!> <fieldset><legend>Mode</legend> <div><label><input type="radio" value="manual"> Manual</label> <label><input type="radio" value="animated"> Animated</label> <label><input type="radio" value="instant"> Instant</label></div> <!></fieldset></section>');function rr(a,t){$(t,!0);var e=ar(),n=l(e);n.__change=[Va,t];var r=l(n);r.value=(r.__value="none")==null?"":"none";var o=p(r);wt(o,17,()=>t.operators,b=>b.id,(b,f)=>{var F=$a(),W={},B=l(F,!0);u(F),T(()=>{W!==(W=h(f).id)&&(F.value=(F.__value=h(f).id)==null?"":h(f).id),Ye(F,(t.state instanceof H||t.state instanceof X||t.state instanceof rt||t.state instanceof ot||t.state instanceof bt||t.state instanceof K||t.state instanceof Y||t.state instanceof at)&&t.state.operator.id===h(f).id),en(B,h(f).name)}),E(b,F)}),u(n);var s=p(n,2);{var i=b=>{var f=de(),F=ct(f);an(F,()=>t.state.operator.displayer,(W,B)=>{B(W,{get onSetOperatorRequest(){return t.onSetOperatorRequest},get nodeId(){return t.nodeId}})}),E(b,f)};Q(s,b=>{(t.state instanceof H||t.state instanceof X||t.state instanceof rt||t.state instanceof rt||t.state instanceof ot||t.state instanceof bt||t.state instanceof bt||t.state instanceof K||t.state instanceof Y||t.state instanceof at||t.state instanceof at)&&b(i)})}var d=p(s,2);{var I=b=>{fe(b,{get image(){return t.state.outputImage}})};Q(d,b=>{(t.state instanceof H||t.state instanceof X||t.state instanceof ot||t.state instanceof K||t.state instanceof Y)&&b(I)})}var c=p(d,2),_=p(l(c),2),m=l(_),w=l(m);G(w),w.__change=function(...b){var f;(f=t.onMakeManualRequest)==null||f.apply(this,b)},j(),u(m);var g=p(m,2),x=l(g);G(x),x.__change=function(...b){var f;(f=t.onMakeAnimatedRequest)==null||f.apply(this,b)},j(),u(g);var k=p(g,2),y=l(k);G(y),y.__change=function(...b){var f;(f=t.onMakeInstantRequest)==null||f.apply(this,b)},j(),u(k),u(_);var N=p(_,2);{var q=b=>{var f=nr(),F=l(f);{var W=P=>{var V=tr(),ut=ct(V),It=p(l(ut));G(It),It.__change=[Qa,t],u(ut);var C=p(ut,2);C.__click=[Ja,t],T(()=>vt(It,t.state.stepCount)),E(P,V)};Q(F,P=>{(t.state instanceof K||t.state instanceof Y||t.state instanceof ft||t.state instanceof at||t.state instanceof ht)&&P(W)})}var B=p(F,2);{var it=P=>{var V=er(),ut=p(l(V));G(ut),ut.__change=[Za,t],u(V),T(()=>vt(ut,t.state.intervalIntervalSeconds)),E(P,V)};Q(B,P=>{(t.state instanceof H||t.state instanceof X||t.state instanceof _t||t.state instanceof rt||t.state instanceof gt)&&P(it)})}var Z=p(B,2);Z.__click=[ja,t],u(f),E(b,f)};Q(N,b=>{(t.state instanceof K||t.state instanceof Y||t.state instanceof ft||t.state instanceof at||t.state instanceof ht||t.state instanceof H||t.state instanceof X||t.state instanceof _t||t.state instanceof rt||t.state instanceof gt)&&b(q)})}u(c),u(e),T(()=>{Ye(r,t.state instanceof _t||t.state instanceof gt||t.state instanceof qt||t.state instanceof At||t.state instanceof ft||t.state instanceof ht),J(w,"name",`${t.nodeId??""}-mode`),yt(w,t.state instanceof K||t.state instanceof Y||t.state instanceof ft||t.state instanceof at||t.state instanceof ht),J(x,"name",`${t.nodeId??""}-mode`),yt(x,t.state instanceof H||t.state instanceof X||t.state instanceof _t||t.state instanceof rt||t.state instanceof gt),J(y,"name",`${t.nodeId??""}-mode`),yt(y,t.state instanceof ot||t.state instanceof qt||t.state instanceof bt||t.state instanceof At)}),E(a,e),tt()}dt(["change","click"]);function or(a,t){$(t,!0);function e(){t.node.makeManual()}function n(){t.node.makeAnimated()}function r(){t.node.makeInstant()}function o(_){t.node.setOperator(_)}function s(){t.node.resetOutputImage()}function i(){t.node.doManualSteps()}function d(){t.node.unsetOperator()}function I(_){t.node.setStepCount(_)}function c(_){t.node.setIntervalInterval(_)}me(a,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetInputRequest(){return t.onSetInputRequest},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(_,m)=>{rr(_,{get state(){return t.node.state},get operators(){return t.node.operators},get nodeId(){return t.node.id},onMakeManualRequest:e,onMakeAnimatedRequest:n,onMakeInstantRequest:r,onSetOperatorRequest:o,onResetOutputImageRequest:s,onDoManualStepsRequest:i,onUnsetOperatorRequest:d,onSetStepCountRequest:I,onSetIntervalIntervalRequest:c})},$$slots:{default:!0}}),tt()}class we extends ve{constructor(e,n,r,o){super(or,e,n,o,new ft(1));v(this,"operators");this.operators=r}doManualSteps(){this.state=this.state.doManualSteps(this.outputEdges)}makeAnimated(){const n=setInterval(()=>{this.state=this.state.doAnimatedStep(this.outputEdges)},1);this.state=this.state.makeAnimated(n,.001)}makeInstant(){this.state=this.state.makeInstant(this.outputEdges)}makeManual(){this.state=this.state.makeManual(1)}resetOutputImage(){this.state=this.state.resetOutputImage(this.outputEdges)}setIntervalInterval(e){const n=setInterval(()=>{this.state=this.state.doAnimatedStep(this.outputEdges)},e*1e3);this.state=this.state.setIntervalInterval(n,e)}setOperator(e){this.state=this.state.setOperator(e,this.outputEdges)}setStepCount(e){this.state=this.state.setStepCount(e)}unsetOperator(){this.state=this.state.unsetOperator(this.outputEdges)}invalidateInputImages(){this.state=this.state.invalidateInputImages(this.outputEdges)}validateInputImages(e){this.state=this.state.validateInputImages(e,this.outputEdges)}}const sr=[];class ir extends we{constructor(t){super(0,"Generator",sr,t)}}function ur(a){return{red:a,green:a,blue:a}}function Kt(a,t){return{red:a.data[t],green:a.data[t+1],blue:a.data[t+2]}}function be(a,t){return{red:a.data[t],green:a.data[t+1],blue:a.data[t+2],alpha:a.data[t+3]}}class dn{constructor(t,e,n){v(this,"displayer");v(this,"id");v(this,"name");this.displayer=(...r)=>(r[1].operator=this,t(...r)),this.id=e,this.name=n}}class Bt extends dn{constructor(t,e,n){super(t,e,n)}}function lr(a,t){t.onSetOperatorRequest(t.operator.withNewMixFactor(a.currentTarget.valueAsNumber))}function dr(a,t){t.onSetOperatorRequest(t.operator.withNewRadius(a.currentTarget.valueAsNumber))}var cr=M('<section><label>Mix factor <input type="number" min="0" max="1" step="0.01"></label> <label>Radius <input type="number" min="0" max="100" step="0.1"></label></section>');function hr(a,t){$(t,!0);var e=cr(),n=l(e),r=p(l(n));G(r),r.__change=[lr,t],u(n);var o=p(n,2),s=p(l(o));G(s),s.__change=[dr,t],u(o),u(e),T(()=>{vt(r,t.operator.mixFactor),vt(s,t.operator.radius)}),E(a,e),tt()}dt(["change"]);class Ht extends Bt{constructor(e,n){super(hr,"average-blurring","Average blurring");v(this,"mixFactor");v(this,"radius");this.mixFactor=e,this.radius=n}*operate(e){const n=new ImageData(e[0].width,e[0].height);for(let r=0;r<e[0].data.length;r+=4){yield n;const o=be(e[0],r);let s=ur(0);const i={x:r/4%e[0].width,y:Math.floor(r/4/e[0].width)};let d=0;for(let I=Math.floor(i.y-this.radius);I<=Math.ceil(i.y+this.radius);I+=1)if(I>=0&&I<e[0].height){for(let c=Math.floor(i.x-this.radius);c<=Math.ceil(i.x+this.radius);c+=1)if(c>=0&&c<e[0].width&&((c-i.x)**2+(I-i.y)**2)**.5<=this.radius){const _=(I*e[0].width+c)*4,m=Kt(e[0],_);s={red:s.red+m.red,green:s.green+m.green,blue:s.blue+m.blue},d+=1}}s={red:s.red/d,green:s.green/d,blue:s.blue/d},n.data[r]=s.red*this.mixFactor+o.red*(1-this.mixFactor),n.data[r+1]=s.green*this.mixFactor+o.green*(1-this.mixFactor),n.data[r+2]=s.blue*this.mixFactor+o.blue*(1-this.mixFactor),n.data[r+3]=o.alpha}return n}withNewMixFactor(e){return new Ht(e,this.radius)}withNewRadius(e){return new Ht(this.mixFactor,e)}}function gr(){return{red:0,green:0,blue:0}}function vr(a,t,e){return{red:a,green:t,blue:e}}function pr(a,t){return{...a,alpha:t}}function Vt(a,t,e){a.data[t]=e.red,a.data[t+1]=e.green,a.data[t+2]=e.blue,a.data[t+3]=e.alpha}class cn{constructor(t,e){v(this,"id");v(this,"name");this.id=t,this.name=e}}function He(a){return a.toReversed().map(t=>t.toReversed())}class mr extends cn{constructor(){super("convoluting","Convoluting")}applyRotation(t){return console.log(t,He(t)),He(t)}}const Ve=new mr;class fr extends cn{constructor(){super("correlating","Correlating")}applyRotation(t){return t}}const le=new fr;var Ir=(a,t)=>{t(0)},wr=M('<td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td> <td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td>',1),br=(a,t)=>{t(0)},_r=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td> <td colspan="1" rowspan="1" class="svelte-ztduc8"></td>',1),xr=M('<td colspan="2" rowspan="1" class="svelte-ztduc8"></td>'),Cr=M('<!> <td colspan="2" rowspan="1" class="svelte-ztduc8"></td>',1),Er=(a,t)=>{t(0)},Rr=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td>'),Mr=M('<td colspan="4" rowspan="4" class="kernel-cell svelte-ztduc8"><input type="number" class="svelte-ztduc8"> <input type="radio" class="svelte-ztduc8"></td>'),Sr=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td>'),yr=M('<tr class="svelte-ztduc8"><!><!><!></tr> <tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td><td colspan="1" rowspan="2" class="svelte-ztduc8"></td><td colspan="1" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td></tr> <tr class="svelte-ztduc8"></tr> <tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><td colspan="1" class="svelte-ztduc8"></td><td colspan="1" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td></tr>',1),kr=M('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td> <td colspan="1" rowspan="1" class="svelte-ztduc8"></td>',1),Ar=M('<td colspan="2" rowspan="1" class="svelte-ztduc8"></td>'),Or=M('<!> <td colspan="2" rowspan="1" class="svelte-ztduc8"></td>',1),Nr=(a,t,e)=>{t(e.operator.kernel.length)},qr=M('<td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td> <td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td>',1),Br=(a,t)=>{t()},Pr=(a,t)=>{t()},Dr=M('<section><fieldset><legend>Kernel</legend> <table class="svelte-ztduc8"><tbody><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="2" rowspan="2" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"></tr><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td></tr><!><tr class="svelte-ztduc8"><!><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="1" rowspan="1" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="2" rowspan="2" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"></tr></tbody></table></fieldset> <fieldset><legend>Kernel interpretation</legend> <label><input type="radio" value="correlating"> Correlating</label> <label><input type="radio" value="convoluting"> Convoluting</label></fieldset></section>');function Fr(a,t){$(t,!0);function e(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x,y:t.operator.anchorPosition.y+(R>t.operator.anchorPosition.y?0:1)},[...t.operator.kernel.slice(0,R),t.operator.kernel[0].map(()=>0),...t.operator.kernel.slice(R,t.operator.kernel.length)]))}function n(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x+(R>t.operator.anchorPosition.x?0:1),y:t.operator.anchorPosition.y},t.operator.kernel.map(A=>[...A.slice(0,R),0,...A.slice(R,A.length)])))}function r(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x,y:t.operator.anchorPosition.y-(R>t.operator.anchorPosition.y?0:1)},[...t.operator.kernel.slice(0,R),...t.operator.kernel.slice(R+1,t.operator.kernel.length)]))}function o(R){t.onSetOperatorRequest(t.operator.withNewAnchorPositionAndNewKernel({x:t.operator.anchorPosition.x-(R>t.operator.anchorPosition.x?0:1),y:t.operator.anchorPosition.y},t.operator.kernel.map(A=>[...A.slice(0,R),...A.slice(R+1,A.length)])))}function s(R,A){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.with(R.y,t.operator.kernel[R.y].with(R.x,A))))}function i(R){t.onSetOperatorRequest(t.operator.withNewAnchorPosition(R))}function d(){t.onSetOperatorRequest(t.operator.withNewRotationApplier(le))}function I(){t.onSetOperatorRequest(t.operator.withNewRotationApplier(Ve))}var c=Dr(),_=l(c),m=p(l(_),2),w=l(m),g=l(w),x=p(l(g)),k=l(x);k.__click=[Ir,n],u(x);var y=p(x);wt(y,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=wr(),z=ct(L),nt=l(z);nt.__click=()=>{o(S)},u(z);var mt=p(z,2),U=l(mt);U.__click=()=>{n(S+1)},u(mt),T(()=>nt.disabled=t.operator.kernel[0].length===1),E(R,L)}),j(),u(g);var N=p(g,2),q=l(N),b=l(q);b.__click=[br,e],u(q);var f=p(q);wt(f,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=Cr(),z=ct(L);{var nt=U=>{var xt=_r();j(2),E(U,xt)},mt=U=>{var xt=xr();E(U,xt)};Q(z,U=>{S===0?U(nt):U(mt,!1)})}j(2),E(R,L)});var F=p(f,3),W=l(F);W.__click=[Er,e],u(F),u(N);var B=p(N);wt(B,17,()=>t.operator.kernel,Ot,(R,A,S)=>{var L=yr(),z=ct(L),nt=l(z);{var mt=Ct=>{var Pt=Rr();E(Ct,Pt)};Q(nt,Ct=>{S===0&&Ct(mt)})}var U=p(nt);wt(U,17,()=>h(A),Ot,(Ct,Pt,ne)=>{var ae=Mr(),Gt=l(ae);G(Gt),Gt.__change=bn=>{s({x:ne,y:S},bn.currentTarget.valueAsNumber)};var Wt=p(Gt,2);G(Wt),Wt.__change=()=>{i({x:ne,y:S})},u(ae),T(()=>{vt(Gt,h(Pt)),J(Wt,"name",`${t.nodeId??""}-anchor`),yt(Wt,t.operator.anchorPosition.x===ne&&t.operator.anchorPosition.y===S)}),E(Ct,ae)});var xt=p(U);{var fn=Ct=>{var Pt=Sr();E(Ct,Pt)};Q(xt,Ct=>{S===0&&Ct(fn)})}u(z);var $t=p(z,2),te=l($t),Me=l(te);Me.__click=()=>{r(S)},u(te);var Se=p(te,3),ye=l(Se);ye.__click=()=>{r(S)},u(Se),u($t);var ke=p($t,4),ee=l(ke),In=l(ee);In.__click=()=>{e(S+1)},u(ee);var Ae=p(ee),Oe=p(Ae),Ne=p(Oe),wn=l(Ne);wn.__click=()=>{e(S+1)},u(Ne),u(ke),T(()=>{Me.disabled=t.operator.kernel.length===1,ye.disabled=t.operator.kernel.length===1,J(Ae,"rowspan",S===t.operator.kernel.length-1?1:2),J(Oe,"rowspan",S===t.operator.kernel.length-1?1:2)}),E(R,L)});var it=p(B),Z=l(it);wt(Z,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=Or(),z=ct(L);{var nt=U=>{var xt=kr();j(2),E(U,xt)},mt=U=>{var xt=Ar();E(U,xt)};Q(z,U=>{S===0?U(nt):U(mt,!1)})}j(2),E(R,L)}),j(2),u(it);var P=p(it),V=p(l(P)),ut=l(V);ut.__click=[Nr,e,t],u(V);var It=p(V);wt(It,17,()=>t.operator.kernel[0],Ot,(R,A,S)=>{var L=qr(),z=ct(L),nt=l(z);nt.__click=()=>{o(S)},u(z);var mt=p(z,2),U=l(mt);U.__click=()=>{n(S+1)},u(mt),T(()=>nt.disabled=t.operator.kernel[0].length===1),E(R,L)}),j(),u(P),j(),u(w),u(m),u(_);var C=p(_,2),D=p(l(C),2),et=l(D);G(et),et.__change=[Br,d],j(),u(D);var pt=p(D,2),Rt=l(pt);G(Rt),Rt.__change=[Pr,I],j(),u(pt),u(C),u(c),T(()=>{J(et,"name",`${t.nodeId??""}-kernel-interpretation`),yt(et,t.operator.rotationApplier===le),J(Rt,"name",`${t.nodeId??""}-kernel-interpretation`),yt(Rt,t.operator.rotationApplier===Ve)}),E(a,c),tt()}dt(["click","change"]);function Lr(a){return{red:Math.max(0,Math.min(a.red,255)),green:Math.max(0,Math.min(a.green,255)),blue:Math.max(0,Math.min(a.blue,255))}}class Nt extends Bt{constructor(e,n,r){super(Fr,"convoluting-or-correlating","Convoluting / Correlating");v(this,"rotationApplier");v(this,"anchorPosition");v(this,"kernel");this.anchorPosition=e,this.kernel=n,this.rotationApplier=r}*operate(e){const n=this.rotationApplier.applyRotation(this.kernel),r=new ImageData(e[0].width-(n[0].length-1),e[0].height-(n.length-1));for(let o=this.anchorPosition.y;o<e[0].height+1-n.length+this.anchorPosition.y;o+=1)for(let s=this.anchorPosition.x;s<e[0].width+1-n[0].length+this.anchorPosition.x;s+=1){yield r;let i=gr();const d={x:s-this.anchorPosition.x,y:o-this.anchorPosition.y};for(let c=-this.anchorPosition.y;c<n.length-this.anchorPosition.y;c+=1)for(let _=-this.anchorPosition.x;_<n[0].length-this.anchorPosition.x;_+=1){const m={x:s+_,y:o+c},w=(m.y*e[0].width+m.x)*4,g=Kt(e[0],w),x={x:_+this.anchorPosition.x,y:c+this.anchorPosition.y};i=vr(i.red+g.red*n[x.y][x.x],i.green+g.green*n[x.y][x.x],i.blue+g.blue*n[x.y][x.x])}const I=(d.y*r.width+d.x)*4;Vt(r,I,pr(Lr(i),255))}return r}withNewAnchorPositionAndNewKernel(e,n){return new Nt(e,n,this.rotationApplier)}withNewAnchorPosition(e){return new Nt(e,this.kernel,this.rotationApplier)}withNewKernel(e){return new Nt(this.anchorPosition,e,this.rotationApplier)}withNewRotationApplier(e){return new Nt(this.anchorPosition,this.kernel,e)}}class hn{constructor(t,e){v(this,"id");v(this,"name");this.id=t,this.name=e}}class _e extends hn{constructor(){super("classic","Classic")}compute(t,e){return e<2+(1-t)?0:e<=3?255:0}}function zr(a){return{red:a,green:a,blue:a}}function Je(a,t){return(a%t+t)%t}class gn extends hn{constructor(){super("fuzzy","Fuzzy")}compute(t,e){return e<2+(1-t)?255*Math.max(0,1-(2+(1-t)-e)):e<=3?255:255*Math.max(0,1-(e-3))}}function Ur(a,t){t.onSetOperatorRequest(t.operator.withNewColorComponentComputer(new _e))}function Tr(a,t){t.onSetOperatorRequest(t.operator.withNewColorComponentComputer(new gn))}function Gr(a,t){t.onSetOperatorRequest(t.operator.withNewMixFactor(a.currentTarget.valueAsNumber))}var Wr=M('<section><fieldset><legend>Color component computer</legend> <div><label><input type="radio" name="component-computer" value="classic"> Classic</label> <label><input type="radio" name="component-computer" value="fuzzy"> Fuzzy</label></div></fieldset> <label>Mix factor <input type="number" min="0" max="1" step="0.01"></label></section>');function Yr(a,t){$(t,!0);var e=Wr(),n=l(e),r=p(l(n),2),o=l(r),s=l(o);G(s),s.__change=[Ur,t],j(),u(o);var i=p(o,2),d=l(i);G(d),d.__change=[Tr,t],j(),u(i),u(r),u(n);var I=p(n,2),c=p(l(I));G(c),c.__change=[Gr,t],u(I),u(e),T(()=>{yt(s,t.operator.componentComputer instanceof _e),yt(d,t.operator.componentComputer instanceof gn),vt(c,t.operator.mixFactor)}),E(a,e),tt()}dt(["change"]);class Jt extends Bt{constructor(e,n){super(Yr,"game-of-life","Game of Life");v(this,"componentComputer");v(this,"mixFactor");this.componentComputer=e,this.mixFactor=n}*operate(e){let n=new ImageData(e[0].data,e[0].width,e[0].height);for(;;){yield n;const r=new ImageData(e[0].width,e[0].height);for(let o=0;o<r.data.length;o+=4){const s={x:o/4%r.width,y:Math.floor(o/4/r.width)};let i=zr(0);for(let c=-1;c<=1;c+=1)for(let _=-1;_<=1;_+=1){if(_===0&&c===0)continue;const m={x:Je(s.x+_,r.width),y:Je(s.y+c,r.height)},w=(m.x+m.y*r.width)*4,g=Kt(n,w);i={red:i.red+g.red/255,green:i.green+g.green/255,blue:i.blue+g.blue/255}}const d=Kt(n,o),I={red:this.componentComputer.compute(d.red/255,i.red),green:this.componentComputer.compute(d.green/255,i.green),blue:this.componentComputer.compute(d.blue/255,i.blue)};r.data[o]=n.data[o]*(1-this.mixFactor)+I.red*this.mixFactor,r.data[o+1]=n.data[o+1]*(1-this.mixFactor)+I.green*this.mixFactor,r.data[o+2]=n.data[o+2]*(1-this.mixFactor)+I.blue*this.mixFactor,r.data[o+3]=n.data[o+3]}n=r}}withNewColorComponentComputer(e){return new Jt(e,this.mixFactor)}withNewMixFactor(e){return new Jt(this.componentComputer,e)}}function Xr(a,t){return a.red*t.red+a.green*t.green+a.blue*t.blue}function Kr(a,t){return{red:a,green:a,blue:a,alpha:t}}function xe(a,t,e){return{red:a,green:t,blue:e}}function Hr(a,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(xe(a.currentTarget.valueAsNumber,t.operator.multiplier.green,t.operator.multiplier.blue)))}function Vr(a,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(xe(t.operator.multiplier.red,a.currentTarget.valueAsNumber,t.operator.multiplier.blue)))}function Jr(a,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(xe(t.operator.multiplier.red,t.operator.multiplier.green,a.currentTarget.valueAsNumber)))}var Qr=M('<section><fieldset><legend>Multiplier components</legend> <div class="svelte-gtjobo"><label>Red <input type="number" min="0" max="1" step="0.01"></label> <label>Green <input type="number" min="0" max="1" step="0.01"></label> <label>Blue <input type="number" min="0" max="1" step="0.01"></label></div></fieldset></section>');function Zr(a,t){$(t,!0);var e=Qr(),n=l(e),r=p(l(n),2),o=l(r),s=p(l(o));G(s),s.__change=[Hr,t],u(o);var i=p(o,2),d=p(l(i));G(d),d.__change=[Vr,t],u(i);var I=p(i,2),c=p(l(I));G(c),c.__change=[Jr,t],u(I),u(r),u(n),u(e),T(()=>{vt(s,t.operator.multiplier.red),vt(d,t.operator.multiplier.green),vt(c,t.operator.multiplier.blue)}),E(a,e),tt()}dt(["change"]);class Ce extends Bt{constructor(e){super(Zr,"grayscaling","Grayscaling");v(this,"multiplier");this.multiplier=e}*operate(e){const n=new ImageData(e[0].width,e[0].height);for(let r=0;r<e[0].data.length;r+=4){yield n;const o=be(e[0],r),s=Xr(o,this.multiplier);Vt(n,r,Kr(s,o.alpha))}return n}withNewMultiplier(e){return new Ce(e)}}function jr(a,t){t.onSetOperatorRequest(t.operator.withNewOutputImageDimensions({width:a.currentTarget.valueAsNumber,height:t.operator.outputImageDimensions.height}))}function $r(a,t){t.onSetOperatorRequest(t.operator.withNewOutputImageDimensions({width:t.operator.outputImageDimensions.width,height:a.currentTarget.valueAsNumber}))}var to=M('<section><fieldset><legend>Output image dimensions</legend> <div><label>Width <input type="number" min="1" step="1"></label> <label>Height <input type="number" min="1" step="1"></label></div></fieldset></section>');function eo(a,t){$(t,!0);var e=to(),n=l(e),r=p(l(n),2),o=l(r),s=p(l(o));G(s),s.__change=[jr,t],u(o);var i=p(o,2),d=p(l(i));G(d),d.__change=[$r,t],u(i),u(r),u(n),u(e),T(()=>{vt(s,t.operator.outputImageDimensions.width),vt(d,t.operator.outputImageDimensions.height)}),E(a,e),tt()}dt(["change"]);class Ee extends Bt{constructor(e){super(eo,"nearest-neighbor-scaling","Nearest neighbor scaling");v(this,"outputImageDimensions");this.outputImageDimensions=e}*operate(e){const n=new ImageData(this.outputImageDimensions.width,this.outputImageDimensions.height),r={x:this.outputImageDimensions.width/e[0].width,y:this.outputImageDimensions.height/e[0].height};for(let o=0;o<n.data.length;o+=4){yield n;const s=o/4,i={x:s%n.width,y:Math.floor(s/n.width)},d={x:Math.round((i.x-(r.x-1)/2)/r.x),y:Math.round((i.y-(r.y-1)/2)/r.y)},c=(d.y*e[0].width+d.x)*4;n.data[o]=e[0].data[c],n.data[o+1]=e[0].data[c+1],n.data[o+2]=e[0].data[c+2],n.data[o+3]=e[0].data[c+3]}return n}withNewOutputImageDimensions(e){return new Ee(e)}}function Yt(a){return Math.max(0,Math.min(255,a))}function Xt(a,t,e,n){return{red:a,green:t,blue:e,alpha:n}}var no=M("<section></section>");function ao(a,t){var e=no();E(a,e)}class ro extends Bt{constructor(){super(ao,"dithering","Dithering ")}*operate(t){const e=new Array(t[0].height).fill(null).map((o,s)=>new Array(t[0].width).fill(null).map((i,d)=>be(t[0],4*(s*t[0].width+d)))),n=new ImageData(t[0].data,t[0].width,t[0].height),r=[[0,0,7/16],[3/16,5/16,1/16]];for(let o=0;o<t[0].height;o+=1)for(let s=0;s<t[0].width;s+=1){yield n;const i=e[o][s],d=Xt(Math.round(Yt(i.red)/255)*255,Math.round(Yt(i.green)/255)*255,Math.round(Yt(i.blue)/255)*255,Yt(i.alpha)),I=Xt(i.red-d.red,i.green-d.green,i.blue-d.blue,i.alpha-d.alpha);Vt(n,4*(o*t[0].width+s),d),e[o][s]=d;for(let c=0;c<r.length;c+=1)for(let _=-1;_<r[c].length-1;_+=1){const m={y:c,x:_+1},w={y:o+c,x:s+_};if(w.y>=0&&w.y<t[0].height&&w.x>=0&&w.x<t[0].width){const g=e[w.y][w.x],x=Xt(g.red+I.red*r[m.y][m.x],g.green+I.green*r[m.y][m.x],g.blue+I.blue*r[m.y][m.x],g.alpha+I.alpha*r[m.y][m.x]);e[w.y][w.x]=x,Vt(n,4*(w.y*t[0].width+w.x),Xt(Math.max(0,Math.min(Math.round(x.red),255)),Math.max(0,Math.min(Math.round(x.green),255)),Math.max(0,Math.min(Math.round(x.blue),255)),Math.max(0,Math.min(Math.round(x.alpha),255))))}}}return n}}const oo=[new Ce({red:.21,green:.72,blue:.07}),new Ee({width:300,height:300}),new Jt(new _e,.5),new Ht(1,10),new Nt({x:0,y:0},[[1]],le),new ro];class so extends we{constructor(t){super(1,"Mapper",oo,t)}}class vn{constructor(t,e){v(this,"index");v(this,"output");this.index=t,this.output=e}}class io extends vn{constructor(e,n,r){super(e,r);v(this,"input");this.input=n}buildWithImage(e){const n=new Ke(`${this.input.id}-${this.index}-${this.output.id}`,e,this.index,this.input,this.output);this.input.addOutputEdge(n),this.output.clearInputEdgeLeft(this.index),this.output.setInputEdge(this.index,n),this.output.validateInputEdges()}buildWithoutImage(){const e=new Ke(`${this.input.id}-${this.index}-${this.output.id}`,null,this.index,this.input,this.output);this.input.addOutputEdge(e),this.output.clearInputEdgeLeft(this.index),this.output.setInputEdge(this.index,e),this.output.invalidateInputImages()}}class Qe extends vn{constructor(t,e){super(t,e)}handleInput(t){return new io(this.index,t,this.output)}}class Re extends pe{constructor(t){super(t)}}class jt extends Re{invalidateInputImages(t){return this}validateInputImages(t,e){return this}constructor(){super("started")}startLoading(t){return new jt}doneLoading(t,e){for(const n of e)n.setImage(t);return new pn(t)}useEdgeBuilder(t){t.buildWithoutImage()}}class pn extends Re{constructor(e){super("doned");v(this,"image");this.image=e}invalidateInputImages(e){return this}startLoading(e){for(const n of e)n.unsetImage();return new jt}validateInputImages(e){return this}useEdgeBuilder(e){e.buildWithImage(this.image)}}function uo(a,t){t.node.setUrl(a.currentTarget.value)}var lo=M('<input type="url" placeholder="Image URL"> <!>',1);function co(a,t){$(t,!0),me(a,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetInputRequest(){return t.onSetInputRequest},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(e,n)=>{var r=lo(),o=ct(r);o.__change=[uo,t];var s=p(o,2);{var i=d=>{fe(d,{get image(){return t.node.state.image}})};Q(s,d=>{t.node.state instanceof pn&&d(i)})}E(e,r)},$$slots:{default:!0}}),tt()}dt(["change"]);async function ho(a){const t=new Image;t.crossOrigin="Anonymous",t.src=a,await new Promise((o,s)=>{t.onload=o,t.onerror=s});const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)}class go extends Re{constructor(){super("unconfigured")}invalidateInputImages(t){return this}startLoading(t){return new jt}validateInputImages(t){return this}useEdgeBuilder(t){t.buildWithoutImage()}}class vo extends ve{invalidateInputImages(){}validateInputImages(t){}constructor(t){super(co,0,"From URL loader",t,new go)}async setUrl(t){const e=this.state.startLoading(this.outputEdges);this.state=e;const n=await ho(t);this.state===e&&(this.state=e.doneLoading(n,this.outputEdges))}}class mn extends dn{constructor(t,e,n){super(t,e,n)}}var po=M("<section></section>");function mo(a){var t=po();E(a,t)}class fo extends mn{constructor(){super(mo,"add","Add")}*operate(t){const e=new ImageData(Math.max(t[0].width,t[1].width),Math.max(t[0].height,t[1].height));for(let n=0;n<e.height;n+=1)for(let r=0;r<e.width;r+=1){yield e;const o=r<t[0].width&&n<t[0].height,s=r<t[1].width&&n<t[1].height,i=4*(n*t[0].width+r),d=4*(n*t[1].width+r),I=4*(n*e.width+r),c=o?t[0].data[i]:0,_=o?t[0].data[i+1]:0,m=o?t[0].data[i+2]:0,w=o?t[0].data[i+3]:0,g=s?t[1].data[d]:0,x=s?t[1].data[d+1]:0,k=s?t[1].data[d+2]:0,y=s?t[1].data[d+3]:0;e.data[I]=Math.min(c+g,255),e.data[I+1]=Math.min(_+x,255),e.data[I+2]=Math.min(m+k,255),e.data[I+3]=Math.min(w+y,255)}return e}}var Io=M("<section></section>");function wo(a){var t=Io();E(a,t)}class bo extends mn{constructor(e){super(wo,"subtract","Subtract");v(this,"alphaChannelPolicy");this.alphaChannelPolicy=e}*operate(e){const n=new ImageData(Math.max(e[0].width,e[1].width),Math.max(e[0].height,e[1].height));for(let r=0;r<n.height;r+=1)for(let o=0;o<n.width;o+=1){yield n;const s=o<e[0].width&&r<e[0].height,i=o<e[1].width&&r<e[1].height,d=4*(r*e[0].width+o),I=4*(r*e[1].width+o),c=4*(r*n.width+o),_=s?e[0].data[d]:0,m=s?e[0].data[d+1]:0,w=s?e[0].data[d+2]:0,g=s?e[0].data[d+3]:0,x=i?e[1].data[I]:0,k=i?e[1].data[I+1]:0,y=i?e[1].data[I+2]:0,N=i?e[1].data[I+3]:0;n.data[c]=Math.max(0,_-x),n.data[c+1]=Math.max(0,m-k),n.data[c+2]=Math.max(0,w-y),n.data[c+3]=this.alphaChannelPolicy==="subtract"?Math.max(0,g-N):this.alphaChannelPolicy==="keepFrom1"?g:this.alphaChannelPolicy==="keepFrom2"?N:255}return n}}const _o=[new fo,new bo("ignore")];class xo extends we{constructor(t){super(2,"Combiner",_o,t)}}function Co(a,t,e,n){if(h(t)!==null)switch(h(t).name){case"movingCamera":{O(e,{x:h(e).x-a.movementX/window.devicePixelRatio,y:h(e).y-a.movementY/window.devicePixelRatio},!0);break}case"movingNode":{h(t).data.node.position={x:h(t).data.node.position.x+a.movementX/window.devicePixelRatio,y:h(t).data.node.position.y+a.movementY/window.devicePixelRatio};break}case"settingEdgeOutput":{O(t,new un(h(t).data.input,n({x:a.clientX,y:a.clientY})));break}case"settingEdgeInput":{O(t,new sn(h(t).data.index,n({x:a.clientX,y:a.clientY}),h(t).data.output));break}}}function Eo(a,t){if(h(t)!==null&&a.button===0)switch(h(t).name){case"movingNode":{O(t,null);break}case"movingCamera":{O(t,null);break}}}var Ro=M("<li><!></li>"),Mo=M("<li><!></li> <!>",1),So=M("<li><!></li>"),yo=M("<li><!></li>"),ko=M('<section role="none" class="svelte-1knjshy"><div class="svelte-1knjshy"><!> <ul class="svelte-1knjshy"><!> <!></ul></div></section>');function Ao(a,t){$(t,!0);let e,n=St(Jn({x:0,y:0}));function r(C){const D=e.getBoundingClientRect();return ba(C,D,h(n))}let o=St([]),s=St(null);function i(C){if(h(s)!==null&&h(s).name==="addingNode"){const D=new C(h(s).data.position);O(o,[...h(o),D]),O(s,null)}}function d(){i(so)}function I(){i(ir)}function c(){i(Ha)}function _(){i(vo)}function m(){i(xo)}function w(C){C.target===e&&h(s)===null&&(C.preventDefault(),O(s,new Sa(r({x:C.clientX,y:C.clientY}))))}function g(C){C.target===e&&C.button===0&&O(s,wa)}function x(){h(s)!==null&&O(s,null)}function k(C,D){h(s)===null?O(s,new un(C,r(D))):h(s).name==="settingEdgeInput"&&(C.handleEdgeBuilder(new Qe(h(s).data.index,h(s).data.output)),O(s,null))}function y(C,D,et){h(s)===null?O(s,new sn(C,r(et),D)):h(s).name==="settingEdgeOutput"&&(h(s).data.input.handleEdgeBuilder(new Qe(C,D)),O(s,null))}function N(C){h(s)===null&&O(s,new Ra(C))}function q(){}function b(C){if(O(o,h(o).filter(D=>D!==C)),h(s)!==null)switch(h(s).name){case"settingEdgeOutput":{h(s).data.input===C&&O(s,null);break}case"settingEdgeInput":{h(s).data.output===C&&O(s,null);break}case"movingNode":{h(s).data.node===C&&O(s,null);break}}}var f=ko();f.__contextmenu=w,f.__mousemove=[Co,s,n,r],f.__mousedown=g,f.__mouseup=[Eo,s];let F;var W=l(f);let B;var it=l(W);{var Z=C=>{pa(C,{get position(){return h(s).data.position},onAddMapperOperatableNodeRequest:d,onAddGeneratorOperatableNodeRequest:I,onAddFromFileLoaderNodeRequest:c,onAddFromUrlLoaderNodeRequest:_,onAddCombinerOperatableNodeRequest:m})};Q(it,C=>{h(s)!==null&&h(s).name==="addingNode"&&C(Z)})}var P=p(it,2),V=l(P);wt(V,17,()=>h(o),C=>C.id,(C,D)=>{var et=Mo(),pt=ct(et),Rt=l(pt);an(Rt,()=>h(D).displayer,(A,S)=>{S(A,{onDeleteRequest:b,onMouseLeftButtonDown:N,onMouseLeftButtonUp:q,onSetInputRequest:y,onSetOutputRequest:k,get boardMode(){return h(s)}})}),u(pt);var R=p(pt,2);wt(R,17,()=>h(D).outputEdges,A=>A.id,(A,S)=>{var L=Ro(),z=l(L);Ca(z,{get edge(){return h(S)}}),u(L),E(A,L)}),E(C,et)});var ut=p(V,2);{var It=C=>{var D=de(),et=ct(D);{var pt=R=>{var A=So(),S=l(A);ue(S,{get sourcePosition(){return h(s).data.input.position},get targetPosition(){return h(s).data.mouseCursorInBoardPosition}}),u(A),E(R,A)},Rt=(R,A)=>{{var S=L=>{var z=yo(),nt=l(z);ue(nt,{get sourcePosition(){return h(s).data.mouseCursorInBoardPosition},get targetPosition(){return h(s).data.output.position}}),u(z),E(L,z)};Q(R,L=>{h(s).name==="settingEdgeInput"&&L(S)},A)}};Q(et,R=>{h(s).name==="settingEdgeOutput"?R(pt):R(Rt,!1)})}E(C,D)};Q(ut,C=>{h(s)!==null&&C(It)})}u(P),u(W),u(f),nn(f,C=>e=C,()=>e),T(()=>{F=kt(f,"",F,{"background-position":`calc(50% + ${-h(n).x}px) calc(50% + ${-h(n).y}px)`}),B=kt(W,"",B,{top:`calc(50% + ${-h(n).y}px)`,left:`calc(50% + ${-h(n).x}px)`})}),Qn("mouseleave",f,x),E(a,f),tt()}dt(["contextmenu","mousemove","mousedown","mouseup"]);var Oo=M('<main class="svelte-i0vbmk"><!></main>');function Uo(a){var t=Oo(),e=l(t);Ao(e,{}),u(t),E(a,t)}export{Uo as component};
