var Nn=Object.defineProperty;var Ve=o=>{throw TypeError(o)};var Tn=(o,t,e)=>t in o?Nn(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var i=(o,t,e)=>Tn(o,typeof t!="symbol"?t+"":t,e),Ke=(o,t,e)=>t.has(o)||Ve("Cannot "+e);var kt=(o,t,e)=>(Ke(o,t,"read from private field"),e?e.call(o):t.get(o)),jt=(o,t,e)=>t.has(o)?Ve("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),$t=(o,t,e,n)=>(Ke(o,t,"write to private field"),n?n.call(o,e):t.set(o,e),e);import{d as Ln,a as C,f as E,c as Ee,t as Qe}from"../chunks/ZSIfpG4K.js";import{b as zn,s as fe,h as ht,F as Fn,Q as Un,o as Wn,a0 as v,ab as Gn,r as Yn,i as Xn,j as Je,k as Ie,c as te,G as Hn,K as Vn,m as mn,a as gn,p as Kn,aq as we,O as vn,v as Qn,z as Ze,ar as xe,as as je,at as Se,ag as Jn,au as $e,av as fn,aw as Zn,ax as jn,N as $n,ay as to,d as eo,az as no,I as oo,C as ro,aA as ao,aB as so,aC as io,aD as uo,aE as lo,R as j,a6 as h,a7 as d,a5 as Y,ap as tn,T as $,a4 as c,an as At,af as N,f as ct,u as ho,aF as et,ae as co}from"../chunks/o6UChuPi.js";import{d as dt,e as po,s as In}from"../chunks/Ce_vvehV.js";import{i as Z,b as wn,c as Cn}from"../chunks/DTiqF_Uc.js";import{s as mo}from"../chunks/C9JFRWNe.js";import{o as go}from"../chunks/BvjyQk6M.js";let en=!1;function vo(){en||(en=!0,document.addEventListener("reset",o=>{Promise.resolve().then(()=>{var t;if(!o.defaultPrevented)for(const e of o.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function Nt(o,t){return t}function fo(o,t,e,n){for(var r=[],a=t.length,s=0;s<a;s++)jn(t[s].e,r,!0);var u=a>0&&r.length===0&&e!==null;if(u){var p=e.parentNode;$n(p),p.append(e),n.clear(),yt(o,t[0].prev,t[a-1].next)}to(r,()=>{for(var w=0;w<a;w++){var I=t[w];u||(n.delete(I.k),yt(o,I.prev,I.next)),eo(I.e,!u)}})}function _t(o,t,e,n,r,a=null){var s=o,u={flags:t,items:new Map,first:null},p=(t&fn)!==0;if(p){var w=o;s=ht?fe(Fn(w)):w.appendChild(Un())}ht&&Wn();var I=null,x=!1,m=Gn(()=>{var _=e();return ro(_)?_:_==null?[]:vn(_)});zn(()=>{var _=v(m),f=_.length;if(x&&f===0)return;x=f===0;let R=!1;if(ht){var P=Yn(s)===Xn;P!==(f===0)&&(s=Je(),fe(s),Ie(!1),R=!0)}if(ht){for(var y=null,B,T=0;T<f;T++){if(te.nodeType===Hn&&te.data===Vn){s=te,R=!0,Ie(!1);break}var l=_[T],g=n(l,T);B=bn(te,u,y,null,l,g,T,r,t,e),u.items.set(g,B),y=B}f>0&&fe(Je())}ht||Io(_,u,s,r,t,n,e),a!==null&&(f===0?I?mn(I):I=gn(()=>a(s)):I!==null&&Kn(I,()=>{I=null})),R&&Ie(!0),v(m)}),ht&&(s=te)}function Io(o,t,e,n,r,a,s){var ut,Dt,Wt,Ot;var u=(r&Zn)!==0,p=(r&(xe|Se))!==0,w=o.length,I=t.items,x=t.first,m=x,_,f=null,R,P=[],y=[],B,T,l,g;if(u)for(g=0;g<w;g+=1)B=o[g],T=a(B,g),l=I.get(T),l!==void 0&&((ut=l.a)==null||ut.measure(),(R??(R=new Set)).add(l));for(g=0;g<w;g+=1){if(B=o[g],T=a(B,g),l=I.get(T),l===void 0){var A=m?m.e.nodes_start:e;f=bn(A,t,f,f===null?t.first:f.next,B,T,g,n,r,s),I.set(T,f),P=[],y=[],m=f.next;continue}if(p&&wo(l,B,g,r),(l.e.f&we)!==0&&(mn(l.e),u&&((Dt=l.a)==null||Dt.unfix(),(R??(R=new Set)).delete(l))),l!==m){if(_!==void 0&&_.has(l)){if(P.length<y.length){var z=y[0],S;f=z.prev;var U=P[0],D=P[P.length-1];for(S=0;S<P.length;S+=1)nn(P[S],z,e);for(S=0;S<y.length;S+=1)_.delete(y[S]);yt(t,U.prev,D.next),yt(t,f,U),yt(t,D,z),m=z,f=D,g-=1,P=[],y=[]}else _.delete(l),nn(l,m,e),yt(t,l.prev,l.next),yt(t,l,f===null?t.first:f.next),yt(t,f,l),f=l;continue}for(P=[],y=[];m!==null&&m.k!==T;)(m.e.f&we)===0&&(_??(_=new Set)).add(m),y.push(m),m=m.next;if(m===null)continue;l=m}P.push(l),f=l,m=l.next}if(m!==null||_!==void 0){for(var k=_===void 0?[]:vn(_);m!==null;)(m.e.f&we)===0&&k.push(m),m=m.next;var O=k.length;if(O>0){var q=(r&fn)!==0&&w===0?e:null;if(u){for(g=0;g<O;g+=1)(Wt=k[g].a)==null||Wt.measure();for(g=0;g<O;g+=1)(Ot=k[g].a)==null||Ot.fix()}fo(t,k,q,I)}}u&&Qn(()=>{var Qt;if(R!==void 0)for(l of R)(Qt=l.a)==null||Qt.apply()}),Ze.first=t.first&&t.first.e,Ze.last=f&&f.e}function wo(o,t,e,n){(n&xe)!==0&&je(o.v,t),(n&Se)!==0?je(o.i,e):o.i=e}function bn(o,t,e,n,r,a,s,u,p,w){var I=(p&xe)!==0,x=(p&no)===0,m=I?x?Jn(r,!1,!1):$e(r):r,_=(p&Se)===0?s:$e(s),f={i:_,v:m,k:a,a:null,e:null,prev:e,next:n};try{return f.e=gn(()=>u(o,m,_,w),ht),f.e.prev=e&&e.e,f.e.next=n&&n.e,e===null?t.first=f:(e.next=f,e.e.next=f.e),n!==null&&(n.prev=f,n.e.prev=f.e),f}finally{}}function nn(o,t,e){for(var n=o.next?o.next.e.nodes_start:e,r=t?t.e.nodes_start:e,a=o.e.nodes_start;a!==n;){var s=oo(a);r.before(a),a=s}}function yt(o,t,e){t===null?o.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const on=[...` 	
\r\f¬†\v\uFEFF`];function Co(o,t,e){var n=""+o;if(e){for(var r in e)if(e[r])n=n?n+" "+r:r;else if(n.length)for(var a=r.length,s=0;(s=n.indexOf(r,s))>=0;){var u=s+a;(s===0||on.includes(n[s-1]))&&(u===n.length||on.includes(n[u]))?n=(s===0?"":n.substring(0,s))+n.substring(u+1):s=u}}return n===""?null:n}function rn(o,t=!1){var e=t?" !important;":";",n="";for(var r in o){var a=o[r];a!=null&&a!==""&&(n+=" "+r+": "+a+e)}return n}function bo(o,t){if(t){var e="",n,r;return Array.isArray(t)?(n=t[0],r=t[1]):n=t,n&&(e+=rn(n)),r&&(e+=rn(r,!0)),e=e.trim(),e===""?null:e}return String(o)}function _o(o,t,e,n,r,a){var s=o.__className;if(ht||s!==e||s===void 0){var u=Co(e,n,a);(!ht||u!==o.getAttribute("class"))&&(u==null?o.removeAttribute("class"):o.className=u),o.__className=e}else if(a&&r!==a)for(var p in a){var w=!!a[p];(r==null||w!==!!r[p])&&o.classList.toggle(p,w)}return a}function Ce(o,t={},e,n){for(var r in e){var a=e[r];t[r]!==a&&(e[r]==null?o.style.removeProperty(r):o.style.setProperty(r,a,n))}}function zt(o,t,e,n){var r=o.__style;if(ht||r!==t){var a=bo(t,n);(!ht||a!==o.getAttribute("style"))&&(a==null?o.removeAttribute("style"):o.style.cssText=a),o.__style=t}else n&&(Array.isArray(n)?(Ce(o,e==null?void 0:e[0],n[0]),Ce(o,e==null?void 0:e[1],n[1],"important")):Ce(o,e,n));return n}const Eo=Symbol("is custom element"),xo=Symbol("is html");function X(o){if(ht){var t=!1,e=()=>{if(!t){if(t=!0,o.hasAttribute("value")){var n=o.value;Q(o,"value",null),o.value=n}if(o.hasAttribute("checked")){var r=o.checked;Q(o,"checked",null),o.checked=r}}};o.__on_r=e,ao(e),vo()}}function It(o,t){var e=Me(o);e.value===(e.value=t??void 0)||o.value===t&&(t!==0||o.nodeName!=="PROGRESS")||(o.value=t??"")}function Pt(o,t){var e=Me(o);e.checked!==(e.checked=t??void 0)&&(o.checked=t)}function an(o,t){t?o.hasAttribute("selected")||o.setAttribute("selected",""):o.removeAttribute("selected")}function Q(o,t,e,n){var r=Me(o);ht&&(r[t]=o.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&o.nodeName==="LINK")||r[t]!==(r[t]=e)&&(t==="loading"&&(o[io]=e),e==null?o.removeAttribute(t):typeof e!="string"&&So(o).includes(t)?o[t]=e:o.setAttribute(t,e))}function Me(o){return o.__attributes??(o.__attributes={[Eo]:o.nodeName.includes("-"),[xo]:o.namespaceURI===so})}var sn=new Map;function So(o){var t=sn.get(o.nodeName);if(t)return t;sn.set(o.nodeName,t=[]);for(var e,n=o,r=Element.prototype;r!==n;){e=lo(n);for(var a in e)e[a].set&&t.push(a);n=uo(n)}return t}class M{constructor(t,e){i(this,"x");i(this,"y");this.x=t,this.y=e}add(t){return new M(this.x+t.x,this.y+t.y)}divideBy(t){return new M(this.x/t,this.y/t)}multiplyBy(t){return new M(this.x*t,this.y*t)}subtract(t){return new M(this.x-t.x,this.y-t.y)}}var Mo=Ln('<svg xmlns="http://www.w3.org/2000/svg" class="svelte-vva1zu"><line stroke="black" stroke-width="2"></line></svg>');function be(o,t){j(t,!0);const e=tn(()=>((t.sourcePosition.x-t.targetPosition.x)**2+(t.sourcePosition.y-t.targetPosition.y)**2)**.5),n=tn(()=>Math.atan2(t.targetPosition.y-t.sourcePosition.y,t.targetPosition.x-t.sourcePosition.x));var r=Mo();Q(r,"height",2);let a;var s=h(r);Q(s,"x1",0),Q(s,"y1",1),Q(s,"y2",1),d(r),Y(()=>{Q(r,"viewBox",`0 0 ${v(e)??""} 2`),Q(r,"width",v(e)),a=zt(r,"",a,{rotate:`${v(n)??""}rad`,top:`${t.sourcePosition.y??""}px`,left:`${t.sourcePosition.x??""}px`}),Q(s,"x2",v(e))}),C(o,r),$()}class _n{constructor(t){i(this,"name");this.name=t}}const Ro="movingCamera";class ko extends _n{constructor(){super(Ro)}}const yo=new ko;function ie(o,t,e){return o.subtract(new M(t.x+t.width/2,t.y+t.height/2)).add(e)}function Ao(o,t){t.edge.delete()}var Po=E('<div><!> <button class="svelte-x0wqt4">üóëÔ∏è</button></div>');function Bo(o,t){j(t,!0);var e=Po(),n=h(e);be(n,{get sourcePosition(){return t.edge.input.position},get targetPosition(){return t.edge.output.position}});var r=c(n,2);r.__click=[Ao,t];let a;d(e),Y(()=>a=zt(r,"",a,{top:`${(t.edge.input.position.y+t.edge.output.position.y)/2}px`,left:`${(t.edge.input.position.x+t.edge.output.position.x)/2}px`})),C(o,e),$()}dt(["click"]);class Re extends _n{constructor(e,n){super(n);i(this,"data");this.data=e}}const Do="movingNode";class Oo extends Re{constructor(t){super({node:t},Do)}}const qo="settingEdgeInput";class un extends Re{constructor(t,e,n){super({index:t,mouseCursorInBoardPosition:e,output:n},qo)}}const No="settingEdgeOutput";class ln extends Re{constructor(t,e){super({input:t,mouseCursorInBoardPosition:e},No)}}class En{constructor(t,e){i(this,"output");i(this,"outputInputIndex");this.output=t,this.outputInputIndex=e}}class dn{constructor(t,e,n,r){i(this,"image");i(this,"input");i(this,"output");i(this,"outputInputIndex");this.image=t,this.input=e,this.output=n,this.outputInputIndex=r}delete(){this.input.deleteOutputEdge(this),this.output.unsetInputEdge(this.outputInputIndex),this.output.invalidateInputImages()}setImage(t){this.image=t,this.output.tryToValidateInputEdges()}unsetImage(){this.image=null,this.output.invalidateInputImages()}}class To extends En{constructor(e,n,r){super(n,r);i(this,"input");this.input=e}buildWithImage(e){const n=new dn(e,this.input,this.output,this.outputInputIndex);this.input.addOutputEdge(n),this.output.deleteInputEdge(this.outputInputIndex),this.output.setInputEdge(n,this.outputInputIndex),this.output.tryToValidateInputEdges()}buildWithoutImage(){const e=new dn(null,this.input,this.output,this.outputInputIndex);this.input.addOutputEdge(e),this.output.deleteInputEdge(this.outputInputIndex),this.output.setInputEdge(e,this.outputInputIndex),this.output.invalidateInputImages()}}class hn extends En{constructor(t,e){super(t,e)}handleInput(t){return new To(t,this.output,this.outputInputIndex)}}function Lo(o,t){if(v(t)!==null&&o.button===0)switch(v(t).name){case"movingNode":{N(t,null);break}case"movingCamera":{N(t,null);break}}}var zo=E("<li><!></li>"),Fo=E("<li><!></li> <!>",1),Uo=E("<li><!></li>"),Wo=E("<li><!></li>"),Go=E('<section role="none" class="svelte-1knjshy"><div class="svelte-1knjshy"><ul class="svelte-1knjshy"><!> <!></ul></div></section>');function Yo(o,t){j(t,!0);let e,n=At(null);function r(l){if(v(n)!==null)switch(v(n).name){case"movingCamera":{t.onSetCameraPositionRequest(t.cameraPosition.subtract(new M(l.movementX,l.movementY).divideBy(window.devicePixelRatio)));break}case"movingNode":{v(n).data.node.position=v(n).data.node.position.add(new M(l.movementX,l.movementY).divideBy(window.devicePixelRatio));break}case"settingEdgeOutput":{N(n,new ln(v(n).data.input,ie(new M(l.clientX,l.clientY),e.getBoundingClientRect(),t.cameraPosition)));break}case"settingEdgeInput":{N(n,new un(v(n).data.index,ie(new M(l.clientX,l.clientY),e.getBoundingClientRect(),t.cameraPosition),v(n).data.output));break}}}function a(l){l.target===e&&l.button===0&&N(n,yo)}function s(){v(n)!==null&&N(n,null)}function u(l,g){v(n)===null?N(n,new ln(l,ie(g,e.getBoundingClientRect(),t.cameraPosition))):v(n).name==="settingEdgeInput"&&(l.useEdgeBuilder(new hn(v(n).data.output,v(n).data.index)),N(n,null))}function p(l,g,A){v(n)===null?N(n,new un(g,ie(A,e.getBoundingClientRect(),t.cameraPosition),l)):v(n).name==="settingEdgeOutput"&&(v(n).data.input.useEdgeBuilder(new hn(l,g)),N(n,null))}function w(l){v(n)===null&&N(n,new Oo(l))}function I(){}function x(l){if(t.onDeleteNodeRequest(l),v(n)!==null)switch(v(n).name){case"settingEdgeOutput":{v(n).data.input===l&&N(n,null);break}case"settingEdgeInput":{v(n).data.output===l&&N(n,null);break}case"movingNode":{v(n).data.node===l&&N(n,null);break}}}var m=Go();m.__mousemove=r,m.__mousedown=a,m.__mouseup=[Lo,n];let _;var f=h(m);let R;var P=h(f),y=h(P);_t(y,17,()=>t.nodes,l=>l.id,(l,g)=>{var A=Fo(),z=ct(A),S=h(z);Cn(S,()=>v(g).displayer,(D,k)=>{k(D,{onDeleteRequest:x,onMouseLeftButtonDown:w,onMouseLeftButtonUp:I,onSetInputRequest:p,onSetOutputRequest:u,get boardMode(){return v(n)}})}),d(z);var U=c(z,2);_t(U,17,()=>v(g).outputEdges,D=>`${D.input.id}-${D.outputInputIndex}-${D.output.id}`,(D,k)=>{var O=zo(),q=h(O);Bo(q,{get edge(){return v(k)}}),d(O),C(D,O)}),C(l,A)});var B=c(y,2);{var T=l=>{var g=Ee(),A=ct(g);{var z=U=>{var D=Uo(),k=h(D);be(k,{get sourcePosition(){return v(n).data.input.position},get targetPosition(){return v(n).data.mouseCursorInBoardPosition}}),d(D),C(U,D)},S=(U,D)=>{{var k=O=>{var q=Wo(),ut=h(q);be(ut,{get sourcePosition(){return v(n).data.mouseCursorInBoardPosition},get targetPosition(){return v(n).data.output.position}}),d(q),C(O,q)};Z(U,O=>{v(n).name==="settingEdgeInput"&&O(k)},D)}};Z(A,U=>{v(n).name==="settingEdgeOutput"?U(z):U(S,!1)})}C(l,g)};Z(B,l=>{v(n)!==null&&l(T)})}d(P),d(f),d(m),wn(m,l=>e=l,()=>e),Y(()=>{_=zt(m,"",_,{"background-position":`calc(50% + ${-t.cameraPosition.x}px) calc(50% + ${-t.cameraPosition.y}px)`}),R=zt(f,"",R,{top:`calc(50% + ${-t.cameraPosition.y}px)`,left:`calc(50% + ${-t.cameraPosition.x}px)`})}),po("mouseleave",m,s),C(o,m),$()}dt(["mousemove","mousedown","mouseup"]);function Xo(){return Math.random().toString(36).substring(2,15)}var Gt,Yt,Xt;class ke{constructor(t,e,n,r){jt(this,Gt);jt(this,Yt);jt(this,Xt);i(this,"displayer");i(this,"id");i(this,"name");this.displayer=t,this.id=Xo(),this.name=e,$t(this,Gt,At([])),$t(this,Yt,At(n)),$t(this,Xt,At(r))}get outputEdges(){return v(kt(this,Gt))}set outputEdges(t){N(kt(this,Gt),t)}get position(){return v(kt(this,Yt))}set position(t){N(kt(this,Yt),t)}get state(){return v(kt(this,Xt))}set state(t){N(kt(this,Xt),t)}addOutputEdge(t){this.outputEdges=[...this.outputEdges,t]}deleteOutputEdge(t){this.outputEdges=this.outputEdges.filter(e=>e!==e)}disconnect(){this.disconnectOutputEdges(),this.disconnectInputEdges()}disconnectOutputEdges(){for(const t of this.outputEdges)t.delete()}useEdgeBuilder(t){this.state.useEdgeBuilder(t.handleInput(this))}}Gt=new WeakMap,Yt=new WeakMap,Xt=new WeakMap;class ye{constructor(t){i(this,"status");this.status=t}}class it extends ye{constructor(t){super(t)}}class st extends it{constructor(e,n,r,a,s){super("started");i(this,"generator");i(this,"inputImages");i(this,"intervalId");i(this,"operator");i(this,"outputImage");this.intervalId=e,this.generator=n,this.inputImages=r,this.operator=a,this.outputImage=s}doAnimatedSteps(e){return this}doInstantSteps(e){const n=new Date;let r=this.generator.next();for(;!r.done&&(new Date().getTime()-n.getTime())/1e3<.1;)r=this.generator.next();if(r.done){for(const a of e)a.setImage(r.value);return new J(this.intervalId,this.inputImages,this.operator,r.value)}else return new st(this.intervalId,this.generator,this.inputImages,this.operator,r.value)}doManualSteps(e){return this}invalidateInputImages(e){return new ft(this.intervalId,this.operator)}makeAnimated(e,n){return clearInterval(this.intervalId),new V(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e,n){return clearInterval(this.intervalId),new st(e,this.generator,this.inputImages,this.operator,this.outputImage)}makeManual(e){return clearInterval(this.intervalId),new H(this.generator,this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){const r=new Date,a=e.operate(this.inputImages);let s=a.next();for(;!s.done&&(new Date().getTime()-r.getTime())/1e3<.1;)s=a.next();if(s.done){for(const u of n)u.setImage(s.value);return new J(this.intervalId,this.inputImages,e,s.value)}else return new st(this.intervalId,a,this.inputImages,e,s.value)}setStepCount(e){return this}unsetOperator(e){return new St(this.intervalId,this.inputImages)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=new Date,a=this.operator.operate(e);let s=a.next();for(;!s.done&&(new Date().getTime()-r.getTime())/1e3<.1;)s=a.next();if(s.done){for(const u of n)u.setImage(s.value);return new J(this.intervalId,e,this.operator,s.value)}else return new st(this.intervalId,a,e,this.operator,s.value)}}class ot extends it{constructor(e,n){super("unconfigured");i(this,"operator");i(this,"stepCount");this.operator=e,this.stepCount=n}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new rt(e,n,this.operator)}makeInstant(e,n){return new ft(e,this.operator)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new ot(e,this.stepCount)}setStepCount(e){return new ot(this.operator,e)}unsetOperator(e){return new vt(this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=this.operator.operate(e),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new G(e,this.operator,a.value,this.stepCount)}else return new H(r,e,this.operator,a.value,this.stepCount)}}class G extends it{constructor(e,n,r,a){super("doned");i(this,"inputImages");i(this,"operator");i(this,"outputImage");i(this,"stepCount");this.inputImages=e,this.operator=n,this.outputImage=r,this.stepCount=a}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new ot(this.operator,this.stepCount)}makeAnimated(e,n){return new K(this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e,n){return new J(e,this.inputImages,this.operator,this.outputImage)}makeManual(e){return this}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const a of e)a.setImage(r.value);return new G(this.inputImages,this.operator,r.value,this.stepCount)}else{for(const a of e)a.unsetImage();return new H(n,this.inputImages,this.operator,r.value,this.stepCount)}}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new G(this.inputImages,e,a.value,this.stepCount)}else{for(const s of n)s.unsetImage();return new H(r,this.inputImages,e,a.value,this.stepCount)}}setStepCount(e){return new G(this.inputImages,this.operator,this.outputImage,e)}unsetOperator(e){for(const n of e)n.unsetImage();return new pt(this.inputImages,this.stepCount)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}validateInputImages(e,n){const r=this.operator.operate(e),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new G(e,this.operator,a.value,this.stepCount)}else{for(const s of n)s.unsetImage();return new H(r,e,this.operator,a.value,this.stepCount)}}}class pt extends it{constructor(e,n){super("unconfigured");i(this,"inputImages");i(this,"stepCount");this.inputImages=e,this.stepCount=n}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new vt(this.stepCount)}makeAnimated(e,n){return new mt(this.inputImages,e,n)}makeInstant(e,n){return new St(e,this.inputImages)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new G(this.inputImages,e,a.value,this.stepCount)}else return new H(r,this.inputImages,e,a.value,this.stepCount)}setStepCount(e){return new pt(this.inputImages,e)}unsetOperator(e){return this}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){return new pt(e,this.stepCount)}}class St extends it{constructor(e,n){super("unconfigured");i(this,"inputImages");i(this,"intervalId");this.intervalId=e,this.inputImages=n}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new Bt(this.intervalId)}makeAnimated(e,n){return clearInterval(this.intervalId),new mt(this.inputImages,e,n)}makeInstant(e,n){return clearInterval(this.intervalId),new St(e,this.inputImages)}makeManual(e){return clearInterval(this.intervalId),new pt(this.inputImages,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){const r=new Date,a=e.operate(this.inputImages);let s=a.next();for(;!s.done&&(new Date().getTime()-r.getTime())/1e3<.1;)s=a.next();if(s.done){for(const u of n)u.setImage(s.value);return new J(this.intervalId,this.inputImages,e,s.value)}else return new st(this.intervalId,a,this.inputImages,e,s.value)}setStepCount(e){return this}unsetOperator(e){return this}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){return new St(this.intervalId,e)}}class Bt extends it{constructor(e){super("unconfigured");i(this,"intervalId");this.intervalId=e}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return clearInterval(this.intervalId),new Ct(e,n)}makeInstant(e,n){return clearInterval(this.intervalId),new Bt(e)}makeManual(e){return clearInterval(this.intervalId),new vt(e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new ft(this.intervalId,e)}setStepCount(e){return this}unsetOperator(e){return this}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){return new St(this.intervalId,e)}}class ft extends it{constructor(e,n){super("unconfigured");i(this,"intervalId");i(this,"operator");this.intervalId=e,this.operator=n}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return clearInterval(this.intervalId),new rt(e,n,this.operator)}makeInstant(e,n){return clearInterval(this.intervalId),new ft(e,this.operator)}makeManual(e){return clearInterval(this.intervalId),new ot(this.operator,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new ft(this.intervalId,e)}setStepCount(e){return this}unsetOperator(e){return new Bt(this.intervalId)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=new Date,a=this.operator.operate(e);let s=a.next();for(;!s.done&&(new Date().getTime()-r.getTime())/1e3<.1;)s=a.next();if(s.done){for(const u of n)u.setImage(s.value);return new J(this.intervalId,e,this.operator,s.value)}else return new st(this.intervalId,a,e,this.operator,s.value)}}class J extends it{constructor(e,n,r,a){super("doned");i(this,"inputImages");i(this,"intervalId");i(this,"operator");i(this,"outputImage");this.intervalId=e,this.inputImages=n,this.operator=r,this.outputImage=a}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new ft(this.intervalId,this.operator)}makeAnimated(e,n){return clearInterval(this.intervalId),new K(this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e,n){return clearInterval(this.intervalId),new J(e,this.inputImages,this.operator,this.outputImage)}makeManual(e){return clearInterval(this.intervalId),new G(this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){const r=new Date,a=e.operate(this.inputImages);let s=a.next();for(;!s.done&&(new Date().getTime()-r.getTime())/1e3<.1;)s=a.next();if(s.done){for(const u of n)u.setImage(s.value);return new J(this.intervalId,this.inputImages,e,s.value)}else{for(const u of n)u.unsetImage();return new st(this.intervalId,a,this.inputImages,e,s.value)}}setStepCount(e){return this}unsetOperator(e){for(const n of e)n.unsetImage();return new St(this.intervalId,this.inputImages)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}validateInputImages(e,n){const r=new Date,a=this.operator.operate(e);let s=a.next();for(;!s.done&&(new Date().getTime()-r.getTime())/1e3<.1;)s=a.next();if(s.done){for(const u of n)u.setImage(s.value);return new J(this.intervalId,e,this.operator,s.value)}else{for(const u of n)u.unsetImage();return new st(this.intervalId,a,e,this.operator,s.value)}}}class H extends it{constructor(e,n,r,a,s){super("started");i(this,"generator");i(this,"inputImages");i(this,"operator");i(this,"outputImage");i(this,"stepCount");this.generator=e,this.inputImages=n,this.operator=r,this.outputImage=a,this.stepCount=s}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){let n=this.generator.next();if(n.done){for(const r of e)r.setImage(n.value);return new G(this.inputImages,this.operator,n.value,this.stepCount)}else{for(let r=1;r<this.stepCount;r=r+1)if(n=this.generator.next(),n.done){for(const a of e)a.setImage(n.value);return new G(this.inputImages,this.operator,n.value,this.stepCount)}return new H(this.generator,this.inputImages,this.operator,n.value,this.stepCount)}}invalidateInputImages(e){return new ot(this.operator,this.stepCount)}makeAnimated(e,n){return new V(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}makeInstant(e,n){const r=new Date;let a=this.generator.next();for(;!a.done&&(new Date().getTime()-r.getTime())/1e3<.1;)a=this.generator.next();if(a.done){for(const s of n)s.setImage(a.value);return new J(e,this.inputImages,this.operator,a.value)}else return new st(e,this.generator,this.inputImages,this.operator,this.outputImage)}makeManual(e){return this}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const a of e)a.setImage(r.value);return new G(this.inputImages,this.operator,r.value,this.stepCount)}else return new H(n,this.inputImages,this.operator,r.value,this.stepCount)}setIntervalInterval(e,n){return this}setOperator(e,n){const r=e.operate(this.inputImages),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new G(this.inputImages,e,a.value,this.stepCount)}else return new H(r,this.inputImages,e,a.value,this.stepCount)}setStepCount(e){return new H(this.generator,this.inputImages,this.operator,this.outputImage,e)}unsetOperator(e){return new pt(this.inputImages,this.stepCount)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=this.operator.operate(e),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new G(e,this.operator,a.value,this.stepCount)}else return new H(r,e,this.operator,a.value,this.stepCount)}}class V extends it{constructor(e,n,r,a,s,u){super("started");i(this,"generator");i(this,"inputImages");i(this,"intervalId");i(this,"intervalIntervalSeconds");i(this,"operator");i(this,"outputImage");this.generator=e,this.inputImages=n,this.intervalId=r,this.intervalIntervalSeconds=a,this.operator=s,this.outputImage=u}doAnimatedSteps(e){const n=this.generator.next();if(n.done){for(const r of e)r.setImage(n.value);return new K(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,n.value)}else return new V(this.generator,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,n.value)}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new rt(this.intervalId,this.intervalIntervalSeconds,this.operator)}makeAnimated(e,n){return this}makeInstant(e,n){const r=new Date;clearInterval(this.intervalId);let a=this.generator.next();for(;!a.done&&(new Date().getTime()-r.getTime())/1e3<.1;)a=this.generator.next();if(a.done){for(const s of n)s.setImage(a.value);return new J(e,this.inputImages,this.operator,a.value)}else return new st(e,this.generator,this.inputImages,this.operator,a.value)}makeManual(e){return clearInterval(this.intervalId),new H(this.generator,this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const a of e)a.setImage(r.value);return new K(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}else return new V(n,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}setIntervalInterval(e,n){return clearInterval(this.intervalId),new V(this.generator,this.inputImages,e,n,this.operator,this.outputImage)}setOperator(e,n){const r=e.operate(this.inputImages),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new K(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,a.value)}else return new V(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,a.value)}setStepCount(e){return this}unsetOperator(e){return new mt(this.inputImages,this.intervalId,this.intervalIntervalSeconds)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=this.operator.operate(e),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new K(e,this.intervalId,this.intervalIntervalSeconds,this.operator,a.value)}else return new V(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,a.value)}}class mt extends it{constructor(e,n,r){super("unconfigured");i(this,"inputImages");i(this,"intervalId");i(this,"intervalIntervalSeconds");this.inputImages=e,this.intervalId=n,this.intervalIntervalSeconds=r}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return new Ct(this.intervalId,this.intervalIntervalSeconds)}makeAnimated(e,n){return this}makeInstant(e,n){return clearInterval(this.intervalId),new St(e,this.inputImages)}makeManual(e){return clearInterval(this.intervalId),new pt(this.inputImages,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new mt(this.inputImages,e,n)}setOperator(e,n){const r=e.operate(this.inputImages),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new K(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,a.value)}else return new V(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,a.value)}setStepCount(e){return this}unsetOperator(e){return this}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){return new mt(e,this.intervalId,this.intervalIntervalSeconds)}}class K extends it{constructor(e,n,r,a,s){super("doned");i(this,"inputImages");i(this,"intervalId");i(this,"intervalIntervalSeconds");i(this,"operator");i(this,"outputImage");this.inputImages=e,this.intervalId=n,this.intervalIntervalSeconds=r,this.operator=a,this.outputImage=s}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){for(const n of e)n.unsetImage();return new rt(this.intervalId,this.intervalIntervalSeconds,this.operator)}makeAnimated(e,n){return this}makeInstant(e,n){return clearInterval(this.intervalId),new J(e,this.inputImages,this.operator,this.outputImage)}makeManual(e){return clearInterval(this.intervalId),new G(this.inputImages,this.operator,this.outputImage,e)}resetOutputImage(e){const n=this.operator.operate(this.inputImages),r=n.next();if(r.done){for(const a of e)a.setImage(r.value);return new K(this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}else{for(const a of e)a.unsetImage();return new V(n,this.inputImages,this.intervalId,this.intervalIntervalSeconds,this.operator,r.value)}}setIntervalInterval(e,n){return clearInterval(this.intervalId),new K(this.inputImages,e,n,this.operator,this.outputImage)}setOperator(e,n){const r=e.operate(this.inputImages),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new K(this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,a.value)}else{for(const s of n)s.unsetImage();return new V(r,this.inputImages,this.intervalId,this.intervalIntervalSeconds,e,a.value)}}setStepCount(e){return this}unsetOperator(e){for(const n of e)n.unsetImage();return new mt(this.inputImages,this.intervalId,this.intervalIntervalSeconds)}useEdgeBuilder(e){e.buildWithImage(this.outputImage)}validateInputImages(e,n){const r=this.operator.operate(e),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new K(e,this.intervalId,this.intervalIntervalSeconds,this.operator,a.value)}else{for(const s of n)s.unsetImage();return new V(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,a.value)}}}class rt extends it{constructor(e,n,r){super("unconfigured");i(this,"intervalId");i(this,"intervalIntervalSeconds");i(this,"operator");this.intervalId=e,this.intervalIntervalSeconds=n,this.operator=r}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return this}makeInstant(e,n){return clearInterval(this.intervalId),new ft(e,this.operator)}makeManual(e){return clearInterval(this.intervalId),new ot(this.operator,e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new rt(e,n,this.operator)}setOperator(e,n){return new rt(this.intervalId,this.intervalIntervalSeconds,e)}setStepCount(e){return this}unsetOperator(e){return new Ct(this.intervalId,this.intervalIntervalSeconds)}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){const r=this.operator.operate(e),a=r.next();if(a.done){for(const s of n)s.setImage(a.value);return new K(e,this.intervalId,this.intervalIntervalSeconds,this.operator,a.value)}else return new V(r,e,this.intervalId,this.intervalIntervalSeconds,this.operator,a.value)}}class Ct extends it{constructor(e,n){super("unconfigured");i(this,"intervalId");i(this,"intervalIntervalSeconds");this.intervalId=e,this.intervalIntervalSeconds=n}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return this}makeInstant(e,n){return clearInterval(this.intervalId),new Bt(e)}makeManual(e){return clearInterval(this.intervalId),new vt(e)}resetOutputImage(e){return this}setIntervalInterval(e,n){return clearInterval(this.intervalId),new Ct(e,n)}setOperator(e,n){return new rt(this.intervalId,this.intervalIntervalSeconds,e)}setStepCount(e){return this}unsetOperator(e){return this}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){return new mt(e,this.intervalId,this.intervalIntervalSeconds)}}class vt extends it{constructor(e){super("unconfigured");i(this,"stepCount");this.stepCount=e}doAnimatedSteps(e){return this}doInstantSteps(e){return this}doManualSteps(e){return this}invalidateInputImages(e){return this}makeAnimated(e,n){return new Ct(e,n)}makeInstant(e,n){return new Bt(e)}makeManual(e){return this}resetOutputImage(e){return this}setIntervalInterval(e,n){return this}setOperator(e,n){return new ot(e,this.stepCount)}setStepCount(e){return new vt(e)}unsetOperator(e){return this}useEdgeBuilder(e){e.buildWithoutImage()}validateInputImages(e,n){return new pt(e,this.stepCount)}}function Ho(o,t){t.node.disconnect(),t.onDeleteRequest(t.node)}function Vo(o,t){o.button===0&&t.onMouseLeftButtonDown(t.node,new M(o.clientX,o.clientY))}function Ko(o,t){o.button===0&&t.onMouseLeftButtonUp(t.node)}function Qo(o,t){t.onSetOutputRequest(t.node,new M(o.clientX,o.clientY))}var Jo=E('<section role="none"><div class="svelte-1vplcxm"><header> </header> <button>üóëÔ∏è</button></div> <!> <div class="svelte-1vplcxm"><button>üîå</button></div></section>');function Ae(o,t){j(t,!0);var e=Jo();e.__mousedown=[Vo,t],e.__mouseup=[Ko,t];let n,r;var a=h(e),s=h(a),u=h(s,!0);d(s);var p=c(s,2);p.__click=[Ho,t],d(a);var w=c(a,2);mo(w,()=>t.children);var I=c(w,2),x=h(I);x.__click=[Qo,t],d(I),d(e),Y(m=>{n=_o(e,1,"svelte-1vplcxm",null,n,m),r=zt(e,"",r,{top:`${t.node.position.y??""}px`,left:`${t.node.position.x??""}px`}),In(u,t.node.name),x.disabled=t.boardMode!==null&&t.boardMode.name==="settingEdgeOutput"},[()=>({started:t.node.state.status==="started",doned:t.node.state.status==="doned",unconfigured:t.node.state.status==="unconfigured"})]),C(o,e),$()}dt(["mousedown","mouseup","click"]);function Zo(o,t,e){N(t,v(t)*e)}function jo(o,t,e){N(t,v(t)/e)}function $o(o,t){N(t,o.currentTarget.valueAsNumber,!0)}var tr=E('<section><div><canvas class="svelte-qio82b"></canvas></div> <div><button>+</button> <button>-</button> <input type="number" min="0"/></div></section>');function Pe(o,t){j(t,!0);let e;go(()=>{const f=e.getContext("2d");ho(()=>{e.height=t.image.height,e.width=t.image.width,f.putImageData(t.image,0,0)})});let n=At(1);const r=1.1;var a=tr(),s=h(a);let u;var p=h(s);let w;wn(p,f=>e=f,()=>e),d(s);var I=c(s,2),x=h(I);x.__click=[Zo,n,r];var m=c(x,2);m.__click=[jo,n,r];var _=c(m,2);X(_),_.__change=[$o,n],d(I),d(a),Y((f,R)=>{u=zt(s,"",u,{width:`${f??""}px`,height:`${R??""}px`}),w=zt(p,"",w,{scale:v(n)}),It(_,v(n))},[()=>Math.round(t.image.width*v(n)),()=>Math.round(t.image.height*v(n))]),C(o,a),$()}dt(["click","change"]);function er(o,t){if(o.currentTarget.value==="none")t.onUnsetOperatorRequest();else{const e=t.availableOperators.find(n=>n.id===o.currentTarget.value);t.onSetOperatorRequest(e)}}function nr(o,t){t.onDoManualStepsRequest()}function or(o,t){t.onSetStepCountRequest(o.currentTarget.valueAsNumber)}function rr(o,t){t.onSetIntervalIntervalRequest(o.currentTarget.valueAsNumber)}function ar(o,t){t.onResetOutputImageRequest()}var sr=E("<option> </option>"),ir=E('<label>Step count: <input type="number" min="1" step="1"/></label> <button>Do steps</button>',1),ur=E('<label>Interval (seconds): <input type="number" min="0.0001" step="0.0001"/></label>'),lr=E("<div><!> <!> <button>Reset</button></div>"),dr=E('<section><select><option>No operator</option><!></select> <!> <!> <fieldset><legend>Mode</legend> <div><label><input type="radio" value="manual"/> Manual</label> <label><input type="radio" value="animated"/> Animated</label> <label><input type="radio" value="instant"/> Instant</label></div> <!></fieldset></section>');function hr(o,t){j(t,!0);var e=dr(),n=h(e);n.__change=[er,t];var r=h(n);r.value=r.__value="none";var a=c(r);_t(a,17,()=>t.availableOperators,l=>l.id,(l,g)=>{var A=sr(),z={},S=h(A,!0);d(A),Y(()=>{z!==(z=v(g).id)&&(A.value=(A.__value=v(g).id)??""),an(A,(t.state instanceof V||t.state instanceof K||t.state instanceof rt||t.state instanceof st||t.state instanceof J||t.state instanceof ft||t.state instanceof H||t.state instanceof G||t.state instanceof ot)&&t.state.operator.id===v(g).id),In(S,v(g).name)}),C(l,A)}),d(n);var s=c(n,2);{var u=l=>{var g=Ee(),A=ct(g);Cn(A,()=>t.state.operator.displayer,(z,S)=>{S(z,{get onSetOperatorRequest(){return t.onSetOperatorRequest},get nodeId(){return t.nodeId}})}),C(l,g)};Z(s,l=>{(t.state instanceof V||t.state instanceof K||t.state instanceof rt||t.state instanceof rt||t.state instanceof st||t.state instanceof J||t.state instanceof ft||t.state instanceof ft||t.state instanceof H||t.state instanceof G||t.state instanceof ot||t.state instanceof ot)&&l(u)})}var p=c(s,2);{var w=l=>{Pe(l,{get image(){return t.state.outputImage}})};Z(p,l=>{(t.state instanceof V||t.state instanceof K||t.state instanceof st||t.state instanceof J||t.state instanceof H||t.state instanceof G)&&l(w)})}var I=c(p,2),x=c(h(I),2),m=h(x),_=h(m);X(_),_.__change=function(...l){var g;(g=t.onMakeManualRequest)==null||g.apply(this,l)},et(),d(m);var f=c(m,2),R=h(f);X(R),R.__change=function(...l){var g;(g=t.onMakeAnimatedRequest)==null||g.apply(this,l)},et(),d(f);var P=c(f,2),y=h(P);X(y),y.__change=function(...l){var g;(g=t.onMakeInstantRequest)==null||g.apply(this,l)},et(),d(P),d(x);var B=c(x,2);{var T=l=>{var g=lr(),A=h(g);{var z=k=>{var O=ir(),q=ct(O),ut=c(h(q));X(ut),ut.__change=[or,t],d(q);var Dt=c(q,2);Dt.__click=[nr,t],Y(()=>It(ut,t.state.stepCount)),C(k,O)};Z(A,k=>{(t.state instanceof H||t.state instanceof G||t.state instanceof vt||t.state instanceof ot||t.state instanceof pt)&&k(z)})}var S=c(A,2);{var U=k=>{var O=ur(),q=c(h(O));X(q),q.__change=[rr,t],d(O),Y(()=>It(q,t.state.intervalIntervalSeconds)),C(k,O)};Z(S,k=>{(t.state instanceof V||t.state instanceof K||t.state instanceof Ct||t.state instanceof rt||t.state instanceof mt)&&k(U)})}var D=c(S,2);D.__click=[ar,t],d(g),Y(()=>D.disabled=t.state instanceof mt||t.state instanceof Ct||t.state instanceof rt||t.state instanceof pt||t.state instanceof vt||t.state instanceof ot),C(l,g)};Z(B,l=>{(t.state instanceof H||t.state instanceof G||t.state instanceof vt||t.state instanceof ot||t.state instanceof pt||t.state instanceof V||t.state instanceof K||t.state instanceof Ct||t.state instanceof rt||t.state instanceof mt)&&l(T)})}d(I),d(e),Y(()=>{an(r,t.state instanceof Ct||t.state instanceof mt||t.state instanceof Bt||t.state instanceof St||t.state instanceof vt||t.state instanceof pt),Q(_,"name",`${t.nodeId??""}-mode`),Pt(_,t.state instanceof H||t.state instanceof G||t.state instanceof vt||t.state instanceof ot||t.state instanceof pt),Q(R,"name",`${t.nodeId??""}-mode`),Pt(R,t.state instanceof V||t.state instanceof K||t.state instanceof Ct||t.state instanceof rt||t.state instanceof mt),Q(y,"name",`${t.nodeId??""}-mode`),Pt(y,t.state instanceof st||t.state instanceof J||t.state instanceof Bt||t.state instanceof ft||t.state instanceof St)}),C(o,e),$()}dt(["change","click"]);var cr=E("<li><button>üîå</button> <!></li>"),pr=E("<ol></ol> <!>",1);function mr(o,t){j(t,!0);function e(){t.node.makeManual()}function n(){t.node.makeAnimated()}function r(){t.node.makeInstant()}function a(m){t.node.setOperator(m)}function s(){t.node.resetOutputImage()}function u(){t.node.doManualSteps()}function p(){t.node.unsetOperator()}function w(m){t.node.setStepCount(m)}function I(m){t.node.setIntervalInterval(m)}function x(m,_){t.onSetInputRequest(t.node,m,_)}Ae(o,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(m,_)=>{var f=pr(),R=ct(f);_t(R,21,()=>t.node.inputEdges,Nt,(y,B,T)=>{var l=cr(),g=h(l);g.__click=S=>{x(T,new M(S.clientX,S.clientY))};var A=c(g,2);{var z=S=>{var U=Ee(),D=ct(U);{var k=q=>{var ut=Qe("‚åõ");C(q,ut)},O=q=>{var ut=Qe("üñºÔ∏è");C(q,ut)};Z(D,q=>{v(B).image===null?q(k):q(O,!1)})}C(S,U)};Z(A,S=>{v(B)!==null&&S(z)})}d(l),Y(()=>g.disabled=t.boardMode!==null&&t.boardMode.name==="settingEdgeInput"),C(y,l)}),d(R);var P=c(R,2);hr(P,{get state(){return t.node.state},get availableOperators(){return t.node.availableOperators},get nodeId(){return t.node.id},onMakeManualRequest:e,onMakeAnimatedRequest:n,onMakeInstantRequest:r,onSetOperatorRequest:a,onResetOutputImageRequest:s,onDoManualStepsRequest:u,onUnsetOperatorRequest:p,onSetStepCountRequest:w,onSetIntervalIntervalRequest:I}),C(m,f)},$$slots:{default:!0}}),$()}dt(["click"]);var Ht;class Be extends ke{constructor(e,n,r,a){super((...u)=>{const p=[u[0],{...u[1],node:this}];return mr(...p)},n,a,new vt(1));jt(this,Ht);i(this,"availableOperators");this.availableOperators=r,$t(this,Ht,At(new Array(e).fill(null))),this.tryToValidateInputEdges()}get inputEdges(){return v(kt(this,Ht))}set inputEdges(e){N(kt(this,Ht),e)}deleteInputEdge(e){this.inputEdges=this.inputEdges.with(e,null)}disconnectInputEdges(){for(const e of this.inputEdges)e!==null&&e.delete()}doManualSteps(){this.state=this.state.doManualSteps(this.outputEdges)}invalidateInputImages(){this.state=this.state.invalidateInputImages(this.outputEdges)}makeAnimated(){const n=setInterval(()=>{this.state=this.state.doAnimatedSteps(this.outputEdges)},1);this.state=this.state.makeAnimated(n,.001)}makeInstant(){const e=setInterval(()=>{this.state=this.state.doInstantSteps(this.outputEdges)},0);this.state=this.state.makeInstant(e,this.outputEdges)}makeManual(){this.state=this.state.makeManual(1)}resetOutputImage(){this.state=this.state.resetOutputImage(this.outputEdges)}setInputEdge(e,n){this.inputEdges=this.inputEdges.with(n,e)}setIntervalInterval(e){const n=setInterval(()=>{this.state=this.state.doAnimatedSteps(this.outputEdges)},e*1e3);this.state=this.state.setIntervalInterval(n,e)}setOperator(e){this.state=this.state.setOperator(e,this.outputEdges)}setStepCount(e){this.state=this.state.setStepCount(e)}tryToValidateInputEdges(){this.inputEdges.every(e=>e!==null&&e.image!==null)&&(this.state=this.state.validateInputImages(this.inputEdges.map(e=>e.image),this.outputEdges))}unsetInputEdge(e){this.inputEdges=this.inputEdges.with(e,null)}unsetOperator(){this.state=this.state.unsetOperator(this.outputEdges)}}Ht=new WeakMap;function De(o,t){return(o.y*t+o.x)*4}function b(o){return Math.max(0,Math.min(o,1))}class xt{constructor(t,e,n){i(this,"blueComponent");i(this,"greenComponent");i(this,"redComponent");this.redComponent=t,this.greenComponent=e,this.blueComponent=n}addBuilder(t){return new xt(this.redComponent+t.redComponent,this.greenComponent+t.greenComponent,this.blueComponent+t.blueComponent)}addColor(t){return new xt(this.redComponent+t.redComponent,this.greenComponent+t.greenComponent,this.blueComponent+t.blueComponent)}build(){return new at(b(this.redComponent),b(this.greenComponent),b(this.blueComponent))}combineWith(t,e){return new xt(t(this.redComponent,e.redComponent),t(this.greenComponent,e.greenComponent),t(this.blueComponent,e.blueComponent))}mixWith(t,e){return this.combineWith((n,r)=>n*(1-t)+r*t,e)}multiplyBy(t){return new xt(this.redComponent*t,this.greenComponent*t,this.blueComponent*t)}subtractColor(t){return new xt(this.redComponent-t.redComponent,this.greenComponent-t.greenComponent,this.blueComponent-t.blueComponent)}}function Tt(o){return Math.round(o*255)}function Lt(o){return o/255}function nt(o){return Math.max(0,Math.min(o,255))}class Vt{constructor(t,e,n){i(this,"blueComponent");i(this,"greenComponent");i(this,"redComponent");this.redComponent=t,this.greenComponent=e,this.blueComponent=n}add(t){return new Vt(nt(this.redComponent+t.redComponent),nt(this.greenComponent+t.greenComponent),nt(this.blueComponent+t.blueComponent))}convertToContinuous(){return new at(Lt(this.redComponent),Lt(this.greenComponent),Lt(this.blueComponent))}subtract(t){return new Vt(nt(this.redComponent-t.redComponent),nt(this.greenComponent-t.greenComponent),nt(this.blueComponent-t.blueComponent))}}class at{constructor(t,e,n){i(this,"blueComponent");i(this,"greenComponent");i(this,"redComponent");this.redComponent=t,this.greenComponent=e,this.blueComponent=n}add(t){return new at(b(this.redComponent+t.redComponent),b(this.greenComponent+t.greenComponent),b(this.blueComponent+t.blueComponent))}combineWithBuilderResultingInBuilder(t,e){return new xt(t(this.redComponent,e.redComponent),t(this.greenComponent,e.greenComponent),t(this.blueComponent,e.blueComponent))}combineWithBuilderResultingInColor(t,e){return new at(t(this.redComponent,e.redComponent),t(this.greenComponent,e.greenComponent),t(this.blueComponent,e.blueComponent))}combineWithColor(t,e){return new at(t(this.redComponent,e.redComponent),t(this.greenComponent,e.greenComponent),t(this.blueComponent,e.blueComponent))}computeDotProduct(t){return this.redComponent*t.redComponent+this.greenComponent*t.greenComponent+this.blueComponent*t.blueComponent}convertToBuilder(){return new xt(this.redComponent,this.greenComponent,this.blueComponent)}convertToDiscrete(){return new Vt(Tt(this.redComponent),Tt(this.greenComponent),Tt(this.blueComponent))}divideByScalar(t){return new at(b(this.redComponent/t),b(this.greenComponent/t),b(this.blueComponent/t))}mixWithColor(t,e){return this.combineWithColor((n,r)=>n*(1-t)+r*t,e)}multiplyByColor(t){return new at(b(this.redComponent*t.redComponent),b(this.greenComponent*t.greenComponent),b(this.blueComponent*t.blueComponent))}multiplyByScalar(t){return new at(b(this.redComponent*t),b(this.greenComponent*t),b(this.blueComponent*t))}subtract(t){return new at(b(this.redComponent-t.redComponent),b(this.greenComponent-t.greenComponent),b(this.blueComponent-t.blueComponent))}withAlphaComponent(t){return new Et(this.redComponent,this.greenComponent,this.blueComponent,t)}}class Et{constructor(t,e,n,r){i(this,"alphaComponent");i(this,"blueComponent");i(this,"greenComponent");i(this,"redComponent");this.redComponent=t,this.greenComponent=e,this.blueComponent=n,this.alphaComponent=r}add(t){return new Et(b(this.redComponent+t.redComponent),b(this.greenComponent+t.greenComponent),b(this.blueComponent+t.blueComponent),b(this.alphaComponent+t.alphaComponent))}combineWithColor(t,e){return new Et(t(this.redComponent,e.redComponent),t(this.greenComponent,e.greenComponent),t(this.blueComponent,e.blueComponent),t(this.alphaComponent,e.alphaComponent))}convertToDiscrete(){return new Kt(Tt(this.redComponent),Tt(this.greenComponent),Tt(this.blueComponent),Tt(this.alphaComponent))}divideByScalar(t){return new Et(b(this.redComponent/t),b(this.greenComponent/t),b(this.blueComponent/t),b(this.alphaComponent/t))}mixWithColor(t,e){return this.combineWithColor((n,r)=>n*(1-t)+r*t,e)}multiplyByColor(t){return new Et(b(this.redComponent*t.redComponent),b(this.greenComponent*t.greenComponent),b(this.blueComponent*t.blueComponent),b(this.alphaComponent*t.alphaComponent))}multiplyByScalar(t){return new Et(b(this.redComponent*t),b(this.greenComponent*t),b(this.blueComponent*t),b(this.alphaComponent*t))}subtract(t){return new Et(b(this.redComponent-t.redComponent),b(this.greenComponent-t.greenComponent),b(this.blueComponent-t.blueComponent),b(this.alphaComponent-t.alphaComponent))}withoutAlphaComponent(){return new at(this.redComponent,this.greenComponent,this.blueComponent)}}class Kt{constructor(t,e,n,r){i(this,"alphaComponent");i(this,"blueComponent");i(this,"greenComponent");i(this,"redComponent");this.redComponent=t,this.greenComponent=e,this.blueComponent=n,this.alphaComponent=r}add(t){return new Kt(nt(this.redComponent+t.redComponent),nt(this.greenComponent+t.greenComponent),nt(this.blueComponent+t.blueComponent),nt(this.alphaComponent+t.alphaComponent))}convertToContinuous(){return new Et(Lt(this.redComponent),Lt(this.greenComponent),Lt(this.blueComponent),Lt(this.alphaComponent))}subtract(t){return new Kt(nt(this.redComponent-t.redComponent),nt(this.greenComponent-t.greenComponent),nt(this.blueComponent-t.blueComponent),nt(this.alphaComponent-t.alphaComponent))}withoutAlpha(){return new Vt(this.redComponent,this.greenComponent,this.blueComponent)}}function gr(o,t){return new Kt(o.data[t],o.data[t+1],o.data[t+2],o.data[t+3])}function Ft(o,t){const e=De(t,o.width);return gr(o,e)}function vr(o,t,e){o.data[t]=e.redComponent,o.data[t+1]=e.greenComponent,o.data[t+2]=e.blueComponent,o.data[t+3]=e.alphaComponent}function xn(o,t,e){const n=De(t,o.width);vr(o,n,e)}function*ne(o,t){for(let e=0;e<o.height;e=e+1)for(let n=0;n<o.width;n=n+1){yield o;const r=new M(n,e);xn(o,r,t(r))}}class Sn{constructor(t,e,n){i(this,"displayer");i(this,"id");i(this,"name");this.displayer=t,this.id=e,this.name=n}}class Mn extends Sn{constructor(t,e,n){super(t,e,n)}}var fr=E("<section></section>");function Ir(o,t){var e=fr();C(o,e)}class wr extends Mn{constructor(){super((...t)=>{const e=[t[0],{...t[1],operator:this}];return Ir(...e)},"add","Add")}*operate(t){const e=new ImageData(Math.min(t[0].width,t[1].width),Math.min(t[0].height,t[1].height));return yield*ne(e,n=>Ft(t[0],n).add(Ft(t[1],n))),e}}var Cr=E("<section></section>");function br(o,t){var e=Cr();C(o,e)}class _r extends Mn{constructor(e){super((...n)=>{const r=[n[0],{...n[1],operator:this}];return br(...r)},"subtract","Subtract");i(this,"alphaChannelPolicy");this.alphaChannelPolicy=e}*operate(e){const n=new ImageData(Math.max(e[0].width,e[1].width),Math.max(e[0].height,e[1].height));for(let r=0;r<n.height;r+=1)for(let a=0;a<n.width;a+=1){yield n;const s=a<e[0].width&&r<e[0].height,u=a<e[1].width&&r<e[1].height,p=4*(r*e[0].width+a),w=4*(r*e[1].width+a),I=4*(r*n.width+a),x=s?e[0].data[p]:0,m=s?e[0].data[p+1]:0,_=s?e[0].data[p+2]:0,f=s?e[0].data[p+3]:0,R=u?e[1].data[w]:0,P=u?e[1].data[w+1]:0,y=u?e[1].data[w+2]:0,B=u?e[1].data[w+3]:0;n.data[I]=Math.max(0,x-R),n.data[I+1]=Math.max(0,m-P),n.data[I+2]=Math.max(0,_-y),n.data[I+3]=this.alphaChannelPolicy==="subtract"?Math.max(0,f-B):this.alphaChannelPolicy==="keepFrom1"?f:this.alphaChannelPolicy==="keepFrom2"?B:255}return n}}const Er=[new wr,new _r("ignore")];class xr extends Be{constructor(t){super(2,"Combiner",Er,t)}}class Oe extends ye{constructor(t){super(t)}}class he extends Oe{constructor(){super("started")}doneLoading(t,e){for(const n of e)n.setImage(t);return new Rn(t)}startLoading(t){return new he}useEdgeBuilder(t){t.buildWithoutImage()}}class Rn extends Oe{constructor(e){super("doned");i(this,"image");this.image=e}startLoading(e){for(const n of e)n.unsetImage();return new he}useEdgeBuilder(e){e.buildWithImage(this.image)}}function Sr(o,t){const e=o.currentTarget.files[0];t.node.setFile(e)}var Mr=E('<input type="file" accept="image/*"/> <!>',1);function Rr(o,t){j(t,!0),Ae(o,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(e,n)=>{var r=Mr(),a=ct(r);a.__change=[Sr,t];var s=c(a,2);{var u=p=>{Pe(p,{get image(){return t.node.state.image}})};Z(s,p=>{t.node.state instanceof Rn&&p(u)})}C(e,r)},$$slots:{default:!0}}),$()}dt(["change"]);async function kr(o){const t=new FileReader;await new Promise((s,u)=>{t.onload=s,t.onerror=u,t.readAsDataURL(o)});const e=new Image;e.src=t.result,await new Promise((s,u)=>{e.onload=s,e.onerror=u});const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)}class yr extends Oe{constructor(){super("unconfigured")}startLoading(t){return new he}useEdgeBuilder(t){t.buildWithoutImage()}}class Ar extends ke{constructor(t){super((...e)=>{const n=[e[0],{...e[1],node:this}];return Rr(...n)},"From file loader",t,new yr)}disconnectInputEdges(){}async setFile(t){const e=this.state.startLoading(this.outputEdges);this.state=e;const n=await kr(t);this.state===e&&(this.state=e.doneLoading(n,this.outputEdges))}}class qe extends ye{constructor(t){super(t)}}class ce extends qe{constructor(){super("started")}doneLoading(t,e){for(const n of e)n.setImage(t);return new kn(t)}startLoading(t){return new ce}useEdgeBuilder(t){t.buildWithoutImage()}}class kn extends qe{constructor(e){super("doned");i(this,"image");this.image=e}startLoading(e){for(const n of e)n.unsetImage();return new ce}useEdgeBuilder(e){e.buildWithImage(this.image)}}function Pr(o,t){t.node.setUrl(o.currentTarget.value)}var Br=E('<input type="url" placeholder="Image URL"/> <!>',1);function Dr(o,t){j(t,!0),Ae(o,{get onDeleteRequest(){return t.onDeleteRequest},get onMouseLeftButtonDown(){return t.onMouseLeftButtonDown},get onMouseLeftButtonUp(){return t.onMouseLeftButtonUp},get onSetOutputRequest(){return t.onSetOutputRequest},get boardMode(){return t.boardMode},get node(){return t.node},children:(e,n)=>{var r=Br(),a=ct(r);a.__change=[Pr,t];var s=c(a,2);{var u=p=>{Pe(p,{get image(){return t.node.state.image}})};Z(s,p=>{t.node.state instanceof kn&&p(u)})}C(e,r)},$$slots:{default:!0}}),$()}dt(["change"]);async function Or(o){const t=new Image;t.crossOrigin="Anonymous",t.src=o,await new Promise((a,s)=>{t.onload=a,t.onerror=s});const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)}class qr extends qe{constructor(){super("unconfigured")}startLoading(t){return new ce}useEdgeBuilder(t){t.buildWithoutImage()}}class Nr extends ke{constructor(t){super((...e)=>{const n=[e[0],{...e[1],node:this}];return Dr(...n)},"From URL loader",t,new qr)}disconnectInputEdges(){}async setUrl(t){const e=this.state.startLoading(this.outputEdges);this.state=e;const n=await Or(t);this.state===e&&(this.state=e.doneLoading(n,this.outputEdges))}}const Tr=[];class Lr extends Be{constructor(t){super(0,"Generator",Tr,t)}}class Ut{constructor(t,e){i(this,"height");i(this,"width");this.width=t,this.height=e}convertToCoordinates(){return new M(this.width,this.height)}divideBy(t){return new Ut(this.width/t,this.height/t)}multiplyBy(t){return new Ut(this.width*t,this.height*t)}}class oe extends Sn{constructor(t,e,n){super(t,e,n)}}class ee{constructor(t,e,n,r){i(this,"alphaComponent");i(this,"blueComponent");i(this,"greenComponent");i(this,"redComponent");this.redComponent=t,this.greenComponent=e,this.blueComponent=n,this.alphaComponent=r}addColor(t){return new ee(this.redComponent+t.redComponent,this.greenComponent+t.greenComponent,this.blueComponent+t.blueComponent,this.alphaComponent+t.alphaComponent)}build(){return new Et(b(this.redComponent),b(this.greenComponent),b(this.blueComponent),b(this.alphaComponent))}divideByFactor(t){return new ee(this.redComponent/t,this.greenComponent/t,this.blueComponent/t,this.alphaComponent/t)}subtractColor(t){return new ee(this.redComponent-t.redComponent,this.greenComponent-t.greenComponent,this.blueComponent-t.blueComponent,this.alphaComponent-t.alphaComponent)}}function*zr(o,t,e){for(let n=Math.floor(o.y-e);n<=Math.ceil(o.y+e);n=n+1)if(n>=0&&n<t.height)for(let r=Math.floor(o.x-e);r<=Math.ceil(o.x+e);r=r+1)r>=0&&r<t.width&&((r-o.x)**2+(n-o.y)**2)**.5<=e&&(yield new M(r,n))}function Fr(o,t,e){let n=new ee(0,0,0,0),r=0;for(const a of zr(o,t,e)){const s=Ft(t,a).convertToContinuous();n=n.addColor(s),r=r+1}return n.divideByFactor(r).build()}function Ur(o,t){t.onSetOperatorRequest(t.operator.withNewMixFactor(o.currentTarget.valueAsNumber))}function Wr(o,t){t.onSetOperatorRequest(t.operator.withNewRadius(o.currentTarget.valueAsNumber))}var Gr=E('<section><label>Mix factor <input type="number" min="0" max="1" step="0.01"/></label> <label>Radius <input type="number" min="0" max="100" step="0.1"/></label></section>');function Yr(o,t){j(t,!0);var e=Gr(),n=h(e),r=c(h(n));X(r),r.__change=[Ur,t],d(n);var a=c(n,2),s=c(h(a));X(s),s.__change=[Wr,t],d(a),d(e),Y(()=>{It(r,t.operator.mixFactor),It(s,t.operator.radius)}),C(o,e),$()}dt(["change"]);class ue extends oe{constructor(e,n){super((...r)=>{const a=[r[0],{...r[1],operator:this}];return Yr(...a)},"average-blurring","Average blurring");i(this,"mixFactor");i(this,"radius");this.mixFactor=e,this.radius=n}*operate(e){const n=new ImageData(e[0].width,e[0].height);return yield*ne(n,r=>{const a=Fr(r,e[0],this.radius);return Ft(e[0],r).convertToContinuous().mixWithColor(this.mixFactor,a).convertToDiscrete()}),n}withNewMixFactor(e){return new ue(e,this.radius)}withNewRadius(e){return new ue(this.mixFactor,e)}}function Xr(o,t){return new Vt(o.data[t],o.data[t+1],o.data[t+2])}function Ne(o,t){const e=De(t,o.width);return Xr(o,e)}function Hr(o,t,e){let n=new xt(0,0,0);for(const{relativeToAnchorPosition:r,multiplier:a}of e){const s=o.add(r),u=Ne(t,s).convertToContinuous();n=n.addBuilder(u.convertToBuilder().multiplyBy(a))}return n.build()}class yn{constructor(t,e){i(this,"id");i(this,"name");this.id=t,this.name=e}}class Vr extends yn{constructor(){super("convoluting","Convoluting")}applyRotation(t){return t.rotateBy180DegreesClockwise()}}const cn=new Vr;class Kr extends yn{constructor(){super("correlating","Correlating")}applyRotation(t){return t}}const _e=new Kr;var Qr=(o,t)=>{t(0)},Jr=E('<td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td> <td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td>',1),Zr=(o,t)=>{t(0)},jr=E('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td> <td colspan="1" rowspan="1" class="svelte-ztduc8"></td>',1),$r=E('<td colspan="2" rowspan="1" class="svelte-ztduc8"></td>'),ta=E('<!> <td colspan="2" rowspan="1" class="svelte-ztduc8"></td>',1),ea=(o,t)=>{t(0)},na=E('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td>'),oa=E('<td colspan="4" rowspan="4" class="kernel-cell svelte-ztduc8"><input type="number" class="svelte-ztduc8"/> <input type="radio" class="svelte-ztduc8"/></td>'),ra=E('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td>'),aa=E('<tr class="svelte-ztduc8"><!><!><!></tr> <tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td><td colspan="1" rowspan="2" class="svelte-ztduc8"></td><td colspan="1" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td></tr> <tr class="svelte-ztduc8"></tr> <tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><td colspan="1" class="svelte-ztduc8"></td><td colspan="1" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td></tr>',1),sa=E('<td colspan="1" rowspan="1" class="svelte-ztduc8"></td> <td colspan="1" rowspan="1" class="svelte-ztduc8"></td>',1),ia=E('<td colspan="2" rowspan="1" class="svelte-ztduc8"></td>'),ua=E('<!> <td colspan="2" rowspan="1" class="svelte-ztduc8"></td>',1),la=(o,t,e)=>{t(e.operator.kernel.dimensions.height)},da=E('<td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">-</button></td> <td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td>',1),ha=(o,t)=>{t()},ca=(o,t)=>{t()},pa=E('<section><fieldset><legend>Kernel</legend> <table class="svelte-ztduc8"><tbody><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="2" rowspan="2" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"></tr><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td></tr><!><tr class="svelte-ztduc8"><!><td colspan="1" rowspan="1" class="svelte-ztduc8"></td><td colspan="1" rowspan="1" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"><td colspan="2" rowspan="2" class="svelte-ztduc8"></td><td colspan="2" rowspan="2" class="svelte-ztduc8"><button type="button">+</button></td><!><td colspan="2" rowspan="2" class="svelte-ztduc8"></td></tr><tr class="svelte-ztduc8"></tr></tbody></table></fieldset> <fieldset><legend>Kernel interpretation</legend> <label><input type="radio" value="correlating"/> Correlating</label> <label><input type="radio" value="convoluting"/> Convoluting</label></fieldset></section>');function ma(o,t){j(t,!0);function e(F){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.withNewMultipliersRow(F)))}function n(F){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.withoutMultipliersRow(F)))}function r(F){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.withNewMultipliersColumn(F)))}function a(F){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.withoutMultipliersColumn(F)))}function s(F,qt){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.withNewMultipliersCell(F,qt)))}function u(F){t.onSetOperatorRequest(t.operator.withNewKernel(t.operator.kernel.withNewAnchorPosition(F)))}function p(){t.onSetOperatorRequest(t.operator.withNewRotationApplier(_e))}function w(){t.onSetOperatorRequest(t.operator.withNewRotationApplier(cn))}var I=pa(),x=h(I),m=c(h(x),2),_=h(m),f=h(_),R=c(h(f)),P=h(R);P.__click=[Qr,r],d(R);var y=c(R);_t(y,17,()=>t.operator.kernel.multipliers[0],Nt,(F,qt,L)=>{var lt=Jr(),tt=ct(lt),gt=h(tt);gt.__click=()=>{a(L)},d(tt);var wt=c(tt,2),W=h(wt);W.__click=()=>{r(L+1)},d(wt),Y(()=>gt.disabled=t.operator.kernel.dimensions.width===1),C(F,lt)}),et(),d(f);var B=c(f,2),T=h(B),l=h(T);l.__click=[Zr,e],d(T);var g=c(T);_t(g,17,()=>t.operator.kernel.multipliers[0],Nt,(F,qt,L)=>{var lt=ta(),tt=ct(lt);{var gt=W=>{var Mt=jr();et(2),C(W,Mt)},wt=W=>{var Mt=$r();C(W,Mt)};Z(tt,W=>{L===0?W(gt):W(wt,!1)})}et(2),C(F,lt)});var A=c(g,3),z=h(A);z.__click=[ea,e],d(A),d(B);var S=c(B);_t(S,17,()=>t.operator.kernel.multipliers,Nt,(F,qt,L)=>{var lt=aa(),tt=ct(lt),gt=h(tt);{var wt=Rt=>{var Jt=na();C(Rt,Jt)};Z(gt,Rt=>{L===0&&Rt(wt)})}var W=c(gt);_t(W,17,()=>v(qt),Nt,(Rt,Jt,ae)=>{var ve=oa(),Zt=h(ve);X(Zt),Zt.__change=qn=>{s(new M(ae,L),qn.currentTarget.valueAsNumber)};var se=c(Zt,2);X(se),se.__change=()=>{u(new M(ae,L))},d(ve),Y(()=>{It(Zt,v(Jt)),Q(Zt,"name",`${t.nodeId}-kernel-cell-${ae}-${L}`),Q(se,"name",`${t.nodeId??""}-anchor`),Pt(se,t.operator.kernel.anchorPosition.x===ae&&t.operator.kernel.anchorPosition.y===L)}),C(Rt,ve)});var Mt=c(W);{var Bn=Rt=>{var Jt=ra();C(Rt,Jt)};Z(Mt,Rt=>{L===0&&Rt(Bn)})}d(tt);var pe=c(tt,2),me=h(pe),Fe=h(me);Fe.__click=()=>{n(L)},d(me);var Ue=c(me,3),We=h(Ue);We.__click=()=>{n(L)},d(Ue),d(pe);var Ge=c(pe,4),ge=h(Ge),Dn=h(ge);Dn.__click=()=>{e(L+1)},d(ge);var Ye=c(ge),Xe=c(Ye),He=c(Xe),On=h(He);On.__click=()=>{e(L+1)},d(He),d(Ge),Y(()=>{Fe.disabled=t.operator.kernel.dimensions.height===1,We.disabled=t.operator.kernel.dimensions.height===1,Q(Ye,"rowspan",L===t.operator.kernel.dimensions.height-1?1:2),Q(Xe,"rowspan",L===t.operator.kernel.dimensions.height-1?1:2)}),C(F,lt)});var U=c(S),D=h(U);_t(D,17,()=>t.operator.kernel.multipliers[0],Nt,(F,qt,L)=>{var lt=ua(),tt=ct(lt);{var gt=W=>{var Mt=sa();et(2),C(W,Mt)},wt=W=>{var Mt=ia();C(W,Mt)};Z(tt,W=>{L===0?W(gt):W(wt,!1)})}et(2),C(F,lt)}),et(2),d(U);var k=c(U),O=c(h(k)),q=h(O);q.__click=[la,e,t],d(O);var ut=c(O);_t(ut,17,()=>t.operator.kernel.multipliers[0],Nt,(F,qt,L)=>{var lt=da(),tt=ct(lt),gt=h(tt);gt.__click=()=>{a(L)},d(tt);var wt=c(tt,2),W=h(wt);W.__click=()=>{r(L+1)},d(wt),Y(()=>gt.disabled=t.operator.kernel.dimensions.width===1),C(F,lt)}),et(),d(k),et(),d(_),d(m),d(x);var Dt=c(x,2),Wt=c(h(Dt),2),Ot=h(Wt);X(Ot),Ot.__change=[ha,p],et(),d(Wt);var Qt=c(Wt,2),re=h(Qt);X(re),re.__change=[ca,w],et(),d(Qt),d(Dt),d(I),Y(()=>{Q(Ot,"name",`${t.nodeId??""}-kernel-interpretation`),Pt(Ot,t.operator.rotationApplier===_e),Q(re,"name",`${t.nodeId??""}-kernel-interpretation`),Pt(re,t.operator.rotationApplier===cn)}),C(o,I),$()}dt(["click","change"]);class le extends oe{constructor(e,n){super((...r)=>{const a=[r[0],{...r[1],operator:this}];return ma(...a)},"convoluting-or-correlating","Convoluting / Correlating");i(this,"kernel");i(this,"rotationApplier");this.kernel=e,this.rotationApplier=n}*operate(e){const n=this.rotationApplier.applyRotation(this.kernel),r=new ImageData(e[0].width-(n.dimensions.width-1),e[0].height-(n.dimensions.height-1));return yield*ne(r,a=>Hr(a,e[0],n).withAlphaComponent(1).convertToDiscrete()),r}withNewKernel(e){return new le(e,this.rotationApplier)}withNewRotationApplier(e){return new le(this.kernel,e)}}function ga(o){return new Ut(o[0].length,o.length)}function va(o,t){return t.convertToCoordinates().subtract(new M(1,1)).subtract(o)}function fa(o){return o.toReversed().map(t=>t.toReversed())}class bt{constructor(t,e){i(this,"anchorPosition");i(this,"dimensions");i(this,"multipliers");this.anchorPosition=t,this.multipliers=e,this.dimensions=ga(e)}rotateBy180DegreesClockwise(){return new bt(va(this.anchorPosition,this.dimensions),fa(this.multipliers))}*[Symbol.iterator](){for(let t=-this.anchorPosition.y;t<this.multipliers.length-this.anchorPosition.y;t=t+1)for(let e=-this.anchorPosition.x;e<this.multipliers[0].length-this.anchorPosition.x;e=e+1){const n=this.multipliers[t+this.anchorPosition.y][e+this.anchorPosition.x];yield{relativeToAnchorPosition:new M(e,t),multiplier:n}}}withNewAnchorPosition(t){return new bt(t,this.multipliers)}withNewMultipliers(t){return new bt(this.anchorPosition,t)}withNewMultipliersCell(t,e){const n=this.multipliers[t.y].with(t.x,e),r=this.multipliers.with(t.y,n);return new bt(this.anchorPosition,r)}withNewMultipliersColumn(t){const e=this.multipliers.map(r=>[...r.slice(0,t),0,...r.slice(t)]),n=this.anchorPosition.x+(t<=this.anchorPosition.x?1:0);return new bt(new M(n,this.anchorPosition.y),e)}withNewMultipliersRow(t){const e=this.multipliers[0].map(()=>0),n=[...this.multipliers.slice(0,t),e,...this.multipliers.slice(t)],r=this.anchorPosition.y+(t<=this.anchorPosition.y?1:0);return new bt(new M(this.anchorPosition.x,r),n)}withoutMultipliersColumn(t){const e=this.multipliers.map(r=>[...r.slice(0,t),...r.slice(t+1)]),n=this.anchorPosition.x-(t<this.anchorPosition.x?1:0);return new bt(new M(n,this.anchorPosition.y),e)}withoutMultipliersRow(t){const e=[...this.multipliers.slice(0,t),...this.multipliers.slice(t+1)],n=this.anchorPosition.y-(t<this.anchorPosition.y?1:0);return new bt(new M(this.anchorPosition.x,n),e)}}class An{constructor(t,e){i(this,"id");i(this,"name");this.id=t,this.name=e}}class Te extends An{constructor(){super("classic","Classic")}compute(t,e){return e<2+(1-t)?0:e<=3?1:0}}function Ia(o,t){for(let e=0;e<o.height;e=e+1)for(let n=0;n<o.width;n=n+1){const r=new M(n,e);xn(o,r,t(r))}}function pn(o,t){return(o%t+t)%t}function wa(o,t){let e=new xt(0,0,0);for(let n=-1;n<=1;n=n+1)for(let r=-1;r<=1;r=r+1){if(r===0&&n===0)continue;const a=new M(pn(t.x+r,o.width),pn(t.y+n,o.height)),s=Ne(o,a).convertToContinuous();e=e.addColor(s)}return e}function Ca(o,t,e){const n=wa(t,e);return Ne(t,e).convertToContinuous().combineWithBuilderResultingInColor((a,s)=>o.compute(a,s),n)}function ba(o,t,e){const n=new ImageData(t.width,t.height);return Ia(n,r=>{const a=Ca(o,t,r),s=Ft(t,r).convertToContinuous();return s.withoutAlphaComponent().mixWithColor(e,a).withAlphaComponent(s.alphaComponent).convertToDiscrete()}),n}class Pn extends An{constructor(){super("fuzzy","Fuzzy")}compute(t,e){return e<2+(1-t)?Math.max(0,1-(2+(1-t)-e)):e<=3?1:Math.max(0,1-(e-3))}}function _a(o,t){t.onSetOperatorRequest(t.operator.withNewColorComponentComputer(new Te))}function Ea(o,t){t.onSetOperatorRequest(t.operator.withNewColorComponentComputer(new Pn))}function xa(o,t){t.onSetOperatorRequest(t.operator.withNewMixFactor(o.currentTarget.valueAsNumber))}var Sa=E('<section><fieldset><legend>Color component computer</legend> <div><label><input type="radio" name="component-computer" value="classic"/> Classic</label> <label><input type="radio" name="component-computer" value="fuzzy"/> Fuzzy</label></div></fieldset> <label>Mix factor <input type="number" min="0" max="1" step="0.01"/></label></section>');function Ma(o,t){j(t,!0);var e=Sa(),n=h(e),r=c(h(n),2),a=h(r),s=h(a);X(s),s.__change=[_a,t],et(),d(a);var u=c(a,2),p=h(u);X(p),p.__change=[Ea,t],et(),d(u),d(r),d(n);var w=c(n,2),I=c(h(w));X(I),I.__change=[xa,t],d(w),d(e),Y(()=>{Pt(s,t.operator.componentComputer instanceof Te),Pt(p,t.operator.componentComputer instanceof Pn),It(I,t.operator.mixFactor)}),C(o,e),$()}dt(["change"]);class de extends oe{constructor(e,n){super((...r)=>{const a=[r[0],{...r[1],operator:this}];return Ma(...a)},"game-of-life","Game of Life");i(this,"componentComputer");i(this,"mixFactor");this.componentComputer=e,this.mixFactor=n}*operate(e){let n=new ImageData(e[0].data,e[0].width,e[0].height);for(;;)yield n,n=ba(this.componentComputer,n,this.mixFactor)}withNewColorComponentComputer(e){return new de(e,this.mixFactor)}withNewMixFactor(e){return new de(this.componentComputer,e)}}function Ra(o,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(new at(o.currentTarget.valueAsNumber,t.operator.multiplier.greenComponent,t.operator.multiplier.blueComponent)))}function ka(o,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(new at(t.operator.multiplier.redComponent,o.currentTarget.valueAsNumber,t.operator.multiplier.blueComponent)))}function ya(o,t){t.onSetOperatorRequest(t.operator.withNewMultiplier(new at(t.operator.multiplier.redComponent,t.operator.multiplier.greenComponent,o.currentTarget.valueAsNumber)))}var Aa=E('<section><fieldset><legend>Multiplier components</legend> <div class="svelte-gtjobo"><label>Red <input type="number" min="0" max="1" step="0.01"/></label> <label>Green <input type="number" min="0" max="1" step="0.01"/></label> <label>Blue <input type="number" min="0" max="1" step="0.01"/></label></div></fieldset></section>');function Pa(o,t){j(t,!0);var e=Aa(),n=h(e),r=c(h(n),2),a=h(r),s=c(h(a));X(s),s.__change=[Ra,t],d(a);var u=c(a,2),p=c(h(u));X(p),p.__change=[ka,t],d(u);var w=c(u,2),I=c(h(w));X(I),I.__change=[ya,t],d(w),d(r),d(n),d(e),Y(()=>{It(s,t.operator.multiplier.redComponent),It(p,t.operator.multiplier.greenComponent),It(I,t.operator.multiplier.blueComponent)}),C(o,e),$()}dt(["change"]);class Le extends oe{constructor(e){super((...n)=>{const r=[n[0],{...n[1],operator:this}];return Pa(...r)},"grayscaling","Grayscaling");i(this,"multiplier");this.multiplier=e}*operate(e){const n=new ImageData(e[0].width,e[0].height);return yield*ne(n,r=>{const a=Ft(e[0],r),u=a.withoutAlpha().convertToContinuous().computeDotProduct(this.multiplier),p=nt(u*255);return new Kt(p,p,p,a.alphaComponent)}),n}withNewMultiplier(e){return new Le(e)}}function Ba(o,t){t.onSetOperatorRequest(t.operator.withNewOutputImageDimensions(new Ut(o.currentTarget.valueAsNumber,t.operator.outputImageDimensions.height)))}function Da(o,t){t.onSetOperatorRequest(t.operator.withNewOutputImageDimensions(new Ut(t.operator.outputImageDimensions.width,o.currentTarget.valueAsNumber)))}var Oa=E('<section><fieldset><legend>Output image dimensions</legend> <div><label>Width <input type="number" min="1" step="1"/></label> <label>Height <input type="number" min="1" step="1"/></label></div></fieldset></section>');function qa(o,t){j(t,!0);var e=Oa(),n=h(e),r=c(h(n),2),a=h(r),s=c(h(a));X(s),s.__change=[Ba,t],d(a);var u=c(a,2),p=c(h(u));X(p),p.__change=[Da,t],d(u),d(r),d(n),d(e),Y(()=>{It(s,t.operator.outputImageDimensions.width),It(p,t.operator.outputImageDimensions.height)}),C(o,e),$()}dt(["change"]);class ze extends oe{constructor(e){super((...n)=>{const r=[n[0],{...n[1],operator:this}];return qa(...r)},"nearest-neighbor-scaling","Nearest neighbor scaling");i(this,"outputImageDimensions");this.outputImageDimensions=e}*operate(e){const n=new ImageData(this.outputImageDimensions.width,this.outputImageDimensions.height);return yield*ne(n,r=>{const a=new M(Math.floor(r.x*e[0].width/this.outputImageDimensions.width),Math.floor(r.y*e[0].height/this.outputImageDimensions.height));return Ft(e[0],a)}),n}withNewOutputImageDimensions(e){return new ze(e)}}const Na=[new Le(new at(.21,.72,.07)),new ze(new Ut(300,300)),new de(new Te,.5),new ue(1,10),new le(new bt(new M(0,0),[[1]]),_e)];class Ta extends Be{constructor(t){super(1,"Mapper",Na,t)}}function La(o,t){t.onAddNodeRequest(new Lr(t.cameraPosition))}function za(o,t){t.onAddNodeRequest(new Ta(t.cameraPosition))}function Fa(o,t){t.onAddNodeRequest(new Ar(t.cameraPosition))}function Ua(o,t){t.onAddNodeRequest(new Nr(t.cameraPosition))}function Wa(o,t){t.onAddNodeRequest(new xr(t.cameraPosition))}var Ga=E('<menu class="svelte-ntzm9h"><li><button>Add a from file loader</button></li> <li><button>Add a from URL loader</button></li> <li><button>Add a generator operatable</button></li> <li><button>Add a mapper operatable</button></li> <li><button>Add a combiner operatable</button></li></menu>');function Ya(o,t){j(t,!0);var e=Ga(),n=h(e),r=h(n);r.__click=[Fa,t],d(n);var a=c(n,2),s=h(a);s.__click=[Ua,t],d(a);var u=c(a,2),p=h(u);p.__click=[La,t],d(u);var w=c(u,2),I=h(w);I.__click=[za,t],d(w);var x=c(w,2),m=h(x);m.__click=[Wa,t],d(x),d(e),C(o,e),$()}dt(["click"]);var Xa=E('<main class="svelte-1xhgqrb"><!> <!></main>');function $a(o,t){j(t,!0);let e=At(co(new M(0,0)));function n(I){N(r,[...v(r),I])}let r=At([]);function a(I){N(r,v(r).filter(x=>x.id!==I.id))}function s(I){N(e,I,!0)}var u=Xa(),p=h(u);Yo(p,{get nodes(){return v(r)},onDeleteNodeRequest:a,get cameraPosition(){return v(e)},onSetCameraPositionRequest:s});var w=c(p,2);Ya(w,{onAddNodeRequest:n,get cameraPosition(){return v(e)}}),d(u),C(o,u),$()}export{$a as component};
